<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>jenkinsè‡ªåŠ¨éƒ¨ç½²ç‰ˆæœ¬å›æ»š</title>
      <link href="posts/5876.html"/>
      <url>posts/5876.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><table><thead><tr><th>ç³»ç»Ÿç‰ˆæœ¬</th><th>ubuntu 20.4 LTS WSL</th></tr></thead><tbody><tr><td>tomcatç‰ˆæœ¬</td><td>apache-tomcat-8.5.30</td></tr><tr><td>jenkins.warç‰ˆæœ¬</td><td>2.313</td></tr><tr><td>java</td><td>1.8.0</td></tr><tr><td>maven</td><td>3.6.3</td></tr></tbody></table><h1 id="å®‰è£…java-mavenç¯å¢ƒï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ubuntu"><a href="#å®‰è£…java-mavenç¯å¢ƒï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ubuntu" class="headerlink" title="å®‰è£…java,mavenç¯å¢ƒï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ubuntu"></a>å®‰è£…java,mavenç¯å¢ƒï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ubuntu</h1><p>mavenä½¿ç”¨aptå®‰è£…çš„ï¼Œjdkä½¿ç”¨æºç è£…çš„</p><h2 id="å®‰è£…jdk"><a href="#å®‰è£…jdk" class="headerlink" title="å®‰è£…jdk"></a>å®‰è£…jdk</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u221-linux-x64.tar.gz -C &#x2F;usr&#x2F;local&#x2F; #è§£å‹jdkè‡³&#x2F;usr&#x2F;local</span><br></pre></td></tr></table></figure><p>åœ¨/etc/profileæ–‡ä»¶æ–‡ä»¶åº•éƒ¨æ·»åŠ å¦‚ä¸‹å†…å®¹,ä¿å­˜é€€å‡ºå¹¶source /etc/profileä½¿æ”¹åŠ¨ç”Ÿæ•ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;jdk1.8.0_221</span><br><span class="line">export JRE_HOME&#x3D;$&#123;JAVA_HOME&#125;&#x2F;jre</span><br><span class="line">export CLASSPATH&#x3D;.:$&#123;JAVA_HOME&#125;&#x2F;lib:$&#123;JRE_HOME&#125;&#x2F;lib:$CLASSPATH</span><br><span class="line">export JAVA_PATH&#x3D;$&#123;JAVA_HOME&#125;&#x2F;bin:$&#123;JRE_HOME&#125;&#x2F;bin</span><br><span class="line">export PATH&#x3D;$PATH:$&#123;JAVA_PATH&#125;</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…maven"><a href="#å®‰è£…maven" class="headerlink" title="å®‰è£…maven"></a>å®‰è£…maven</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install maven #å®‰è£…maven,é»˜è®¤å®‰è£…è·¯å¾„ä¸º&#x2F;usr&#x2F;share&#x2F;maven</span><br></pre></td></tr></table></figure><p>åœ¨/etc/profileæ–‡ä»¶æ–‡ä»¶åº•éƒ¨æ·»åŠ å¦‚ä¸‹å†…å®¹,ä¿å­˜é€€å‡ºå¹¶source /etc/profileä½¿æ”¹åŠ¨ç”Ÿæ•ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export M2_HOME&#x3D;&#x2F;usr&#x2F;share&#x2F;maven</span><br><span class="line">export MAVEN_HOME&#x3D;&#x2F;usr&#x2F;share&#x2F;maven</span><br><span class="line">export PATH&#x3D;$&#123;M2_HOME&#125;&#x2F;bin:$&#123;PATH&#125;</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…tomcat-jenkins"><a href="#å®‰è£…tomcat-jenkins" class="headerlink" title="å®‰è£…tomcat,jenkins"></a>å®‰è£…tomcat,jenkins</h1><p>é¦–å…ˆè§£å‹tomcat</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-tomcat-8.5.30.tar.gz -C &#x2F;usr&#x2F;local&#x2F; &amp;&amp; mv &#x2F;usr&#x2F;local&#x2F;apache-tomcat-8.5.30 &#x2F;usr&#x2F;local&#x2F;tomcat</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠä¸‹è½½å¥½çš„jenkins.warç§»åŠ¨è‡³ webappsï¼Œå› ä¸ºtomcatæ”¯æŒç›´æ¥ä»¥jar,waråŒ…çš„å½¢å¼æ¥å¯åŠ¨é¡¹ç›®ï¼Œæ‰€ä»¥å¯åŠ¨tomcatä¹Ÿå°±æ˜¯å¯åŠ¨jenkins</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv &#x2F;soft&#x2F;jenkins.war &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨jenkins</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;bin&#x2F;startup.sh</span><br></pre></td></tr></table></figure><p>è®¿é—®<a href="http://172.25.1.74:8080/jenkins%EF%BC%8C%E6%8C%89%E7%85%A7%E6%8F%90%E7%A4%BA%E5%AE%8C%E6%88%90%E5%AE%89%E8%A3%85%E5%8D%B3%E5%8F%AF">http://172.25.1.74:8080/jenkinsï¼ŒæŒ‰ç…§æç¤ºå®Œæˆå®‰è£…å³å¯</a></p><h1 id="åˆ›å»ºprojectè¿›è¡Œæ„å»º"><a href="#åˆ›å»ºprojectè¿›è¡Œæ„å»º" class="headerlink" title="åˆ›å»ºprojectè¿›è¡Œæ„å»º"></a>åˆ›å»ºprojectè¿›è¡Œæ„å»º</h1><p>æ–°å»ºtestï¼Œé€‰æ‹©æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ï¼Œç„¶åç‚¹å‡»ç¡®å®š<br><img src="https://img-blog.csdnimg.cn/71cb3dfad1854f5fbd51d62767746432.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åé€‰æ‹©å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ï¼Œåˆ†åˆ«æ·»åŠ é€‰é¡¹å‚æ•°ï¼Œå­—ç¬¦å‚æ•°<br><img src="https://img-blog.csdnimg.cn/d6e3a5f355164c9588a843fd8e9a6426.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åé€‰æ‹©æºç ç®¡ç†ï¼Œå¡«è‡ªå·±çš„ä»“åº“<br><img src="https://img-blog.csdnimg.cn/6c366eec27fc40db8e4323ad787e667d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>æ„å»ºç¯å¢ƒ é€‰æ‹©Delete workspace before build starts<br><img src="https://img-blog.csdnimg.cn/86df85b7a3374ab9b43adf9bfe828bec.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶ååœ¨æ„å»ºæ­¥éª¤é‡Œæ–°åŠ ä¸€ä¸ªshellï¼Œæˆ‘çº¢æ¡†åœˆä½çš„åœ°æ–¹å·²ç»åšäº†æ³¨é‡Šï¼Œæ­£å¸¸æƒ…å†µæ˜¯å¯ä»¥å¯åŠ¨javaç¨‹åºçš„ï¼Œä½†æ˜¯å†™åœ¨è¿™é‡Œå‘ç°éƒ¨ç½²æˆåŠŸåï¼Œæ²¡æœ‰javaçš„ç¨‹åºï¼Œæ—¥å¿—ä¹Ÿæ˜¯ä¸ºç©ºã€‚æ‰€ä»¥æœ€ååœ¨ä¸»æœºä¸Šå†™äº†ä¸ªshellæ¥ä»£æ›¿ã€‚<br><img src="https://img-blog.csdnimg.cn/c489140c33fc4e13bd3552233b1269be.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">cd $&#123;WORKSPACE&#125;&#x2F; &amp;&amp; mvn install</span><br><span class="line">cd $&#123;WORKSPACE&#125;&#x2F;group-module &amp;&amp;  mvn clean package -Dmaven.test.skip&#x3D;true</span><br><span class="line"></span><br><span class="line">case $Status  in</span><br><span class="line">  Deploy)</span><br><span class="line">    echo &quot;Status:$Status&quot;</span><br><span class="line">    path&#x3D;&quot;&#x2F;opt&#x2F;bak&#x2F;$&#123;BUILD_NUMBER&#125;&quot;      #åˆ›å»ºæ¯æ¬¡è¦å¤‡ä»½çš„ç›®å½•</span><br><span class="line">    if [ -d $path ];</span><br><span class="line">    then</span><br><span class="line">        echo &quot;The files is already  exists &quot;</span><br><span class="line">    else</span><br><span class="line">        mkdir -p  $path</span><br><span class="line">    fi</span><br><span class="line">    #APP_NAME&#x3D;group-module-1.0-SNAPSHOT.jar</span><br><span class="line">    #pid&#x3D;&#96;ps -ef|grep $APP_NAME|grep -v grep|awk &#39;&#123;print $2&#125;&#39; &#96;</span><br><span class="line">#if [ -n &quot;$&#123;pid&#125;&quot; ]; then</span><br><span class="line">#kill -9 $pid</span><br><span class="line">#fi</span><br><span class="line">    \cp -f $&#123;WORKSPACE&#125;&#x2F;group-module&#x2F;target&#x2F;group-module-1.0-SNAPSHOT.jar $path &amp;&amp; cp -f $&#123;WORKSPACE&#125;&#x2F;group-module&#x2F;target&#x2F;group-module-1.0-SNAPSHOT.jar &#x2F;opt&#x2F;group-module&#x2F;  #å°†æ‰“åŒ…å¥½çš„waråŒ…å¤‡ä»½åˆ°ç›¸åº”ç›®å½•,è¦†ç›–å·²å­˜åœ¨çš„ç›®æ ‡</span><br><span class="line">    #nohup java -jar &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.jar &gt; &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.log 2&gt;&amp;1 &amp;      </span><br><span class="line">    echo &quot;Completing!&quot;</span><br><span class="line">    ;;</span><br><span class="line">  Rollback)</span><br><span class="line">      echo &quot;Status:$Status&quot;</span><br><span class="line">      echo &quot;Version:$Version&quot;</span><br><span class="line">      cd &#x2F;opt&#x2F;bak&#x2F;$Version #è¿›å…¥å¤‡ä»½ç›®å½•</span><br><span class="line">      #APP_NAME&#x3D;group-module-1.0-SNAPSHOT.jar</span><br><span class="line">      #pid&#x3D;&#96;ps -ef|grep $APP_NAME|grep -v grep|awk &#39;&#123;print $2&#125;&#39; &#96;</span><br><span class="line">  #if [ -n &quot;$&#123;pid&#125;&quot; ]; then</span><br><span class="line">  #kill -9 $pid</span><br><span class="line">  #fi</span><br><span class="line">      \cp -f group-module-1.0-SNAPSHOT.jar &#x2F;opt&#x2F;group-module&#x2F; #å°†å¤‡ä»½æ‹·è´åˆ°ç¨‹åºæ‰“åŒ…ç›®å½•ä¸­ï¼Œå¹¶è¦†ç›–ä¹‹å‰çš„jaråŒ…</span><br><span class="line">      #nohup java -jar &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.jar &gt; &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.log 2&gt;&amp;1 &amp;       </span><br><span class="line">      ;;</span><br><span class="line">  *)</span><br><span class="line">  exit</span><br><span class="line">      ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬ç»å¸¸æ›´æ–°ä»£ç ï¼Œæäº¤æ„å»ºï¼Œä½¿å¾—å¤‡ä»½ç›®å½•æ—¥ç›Šå˜å¤§ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸€ä¸ªè„šæœ¬æ¥åˆ é™¤è€æ—§çš„ç‰ˆæœ¬ï¼Œå°†ç‰ˆæœ¬æ§åˆ¶åœ¨5ä¸ªï¼Œå†æ„å»ºçš„åœ°æ–¹æ–°å¢ä¸€ä¸ªshell<br><img src="https://img-blog.csdnimg.cn/86bcb31c605c4601aeee8eb15afa003f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">ReservedNum&#x3D;5  #ä¿ç•™æ–‡ä»¶æ•°</span><br><span class="line">FileDir&#x3D;&#x2F;opt&#x2F;bak&#x2F;</span><br><span class="line">date&#x3D;$(date &quot;+%Y%m%d-%H%M%S&quot;)</span><br><span class="line"></span><br><span class="line">cd $FileDir   #è¿›å…¥å¤‡ä»½ç›®å½•</span><br><span class="line">FileNum&#x3D;$(ls -l | grep &#39;^d&#39; | wc -l)   #å½“å‰æœ‰å‡ ä¸ªæ–‡ä»¶å¤¹ï¼Œå³å‡ ä¸ªå¤‡ä»½</span><br><span class="line"></span><br><span class="line">while(( $FileNum &gt; $ReservedNum))</span><br><span class="line">do</span><br><span class="line">    OldFile&#x3D;$(ls -rt | head -1)         #è·å–æœ€æ—§çš„é‚£ä¸ªå¤‡ä»½æ–‡ä»¶å¤¹</span><br><span class="line">    echo  $date &quot;Delete File:&quot;$OldFile</span><br><span class="line">    rm -rf $FileDir&#x2F;$OldFile</span><br><span class="line">    let &quot;FileNum--&quot;</span><br><span class="line">done </span><br></pre></td></tr></table></figure><p>æœ€åæŠŠæˆ‘ä¸Šè¾¹è¯´çš„éƒ¨ç½²æœåŠ¡çš„è„šæœ¬å†™åœ¨æœåŠ¡å™¨ä¸Š<br>æ–°å¢shell<br><img src="https://img-blog.csdnimg.cn/7523566f2b1c44019b0f8a0dccd428eb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœåŠ¡å™¨è„šæœ¬å†…å®¹<br><img src="https://img-blog.csdnimg.cn/bcdd55e99c92409b858f6eafef5b9165.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">APP_NAME&#x3D;group-module-1.0-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line">pid&#x3D;&#96;ps -ef|grep $APP_NAME|grep -v grep|awk &#39;&#123;print $2&#125;&#39; &#96;</span><br><span class="line">if [ -n &quot;$&#123;pid&#125;&quot; ]; then</span><br><span class="line">kill -9 $pid</span><br><span class="line">fi</span><br><span class="line">BUILD_ID&#x3D;DONTKILLME</span><br><span class="line">nohup java -jar &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.jar &gt; &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h1 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h1><h2 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h2><p>ç›®å‰å¹¶æ²¡æœ‰è¿›ç¨‹<br><img src="https://img-blog.csdnimg.cn/f7fc3e661a234e5d9caed5bb46d069a4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬æ‰“å¼€jenkinsæ§åˆ¶å°ï¼Œä¾æ¬¡é€‰æ‹©æˆ‘ä»¬çš„éƒ¨ç½²æ–¹å¼ï¼Œä»¥åŠç‰ˆæœ¬å·ï¼Œç„¶åç‚¹å‡»å¼€å§‹æ„å»º<br><img src="https://img-blog.csdnimg.cn/f18dfc5d24c94fbda7c09fdf17d3eec1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œè¿™é‡Œå·²ç»éƒ¨ç½²æˆåŠŸï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°çŠ¶æ€æ—¶Deploy<br><img src="https://img-blog.csdnimg.cn/fd7568da8b654cf9b0df56130bbd8308.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ°æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹ï¼Œè¿›ç¨‹å·²ç»èµ·æ¥äº†ï¼Œæ—¥å¿—æ˜¾ç¤ºå¯åŠ¨æˆåŠŸ<br><img src="https://img-blog.csdnimg.cn/5bd22f44a3ed462aa7843e3ac381b51a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹ä¸‹æ­¤æ¬¡éƒ¨ç½²å·²å¤‡ä»½è‡³æˆ‘ä»¬æŒ‡å®šçš„ç›®å½•ï¼Œæ²¡æœ‰22çš„åŸå› æ˜¯ï¼Œæˆ‘å½“æ—¶æ„å»º22çš„æ—¶å€™å›æ»šçš„æ˜¯21<br><img src="https://img-blog.csdnimg.cn/7035da9d6a0a41fda3649641d8f71158.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="Rollback"><a href="#Rollback" class="headerlink" title="Rollback"></a>Rollback</h2><p>æˆ‘ä»¬å†æ¥åˆ°æ§åˆ¶å°ï¼Œä¾æ¬¡é€‰æ‹©ä¹‹åç‚¹å‡»æ„å»º<br><img src="https://img-blog.csdnimg.cn/b12fae6baa2a4fe28e308796dc9c839c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16"><br>çœ‹æ§åˆ¶å°æˆ‘ä»¬ï¼Œå¯ä»¥çœ‹å‡ºéƒ¨ç½²çš„æ–¹å¼ï¼ŒåŠå›æ»šçš„ç‰ˆæœ¬<br><img src="https://img-blog.csdnimg.cn/503aea992a3b4d3487d0169135eb97a0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å†æ¥åˆ°æœåŠ¡å™¨æŸ¥çœ‹ï¼Œå‘ç°è¿›ç¨‹å·å·²ç»å˜äº†ï¼Œè¯´æ˜å›æ»šæˆåŠŸ<br><img src="https://img-blog.csdnimg.cn/2177bbdbdf644ee7b8e950b7ccb64c8b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="ä»¥ä¸Šå†™çš„æ˜¯åç«¯ï¼Œè¿™é‡Œå†è¡¥å‘ä¸€ä¸ªå‰ç«¯çš„"><a href="#ä»¥ä¸Šå†™çš„æ˜¯åç«¯ï¼Œè¿™é‡Œå†è¡¥å‘ä¸€ä¸ªå‰ç«¯çš„" class="headerlink" title="ä»¥ä¸Šå†™çš„æ˜¯åç«¯ï¼Œè¿™é‡Œå†è¡¥å‘ä¸€ä¸ªå‰ç«¯çš„"></a>ä»¥ä¸Šå†™çš„æ˜¯åç«¯ï¼Œè¿™é‡Œå†è¡¥å‘ä¸€ä¸ªå‰ç«¯çš„</h1><h2 id="å®‰è£…node"><a href="#å®‰è£…node" class="headerlink" title="å®‰è£…node"></a>å®‰è£…node</h2><p>è¿™é‡Œå°½é‡ä½¿ç”¨æºç æ¥å®‰è£…ä¸ä½ é¡¹ç›®åŒ¹é…çš„nodeç‰ˆæœ¬ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ä¾èµ–é—®é¢˜ï¼Œæˆ–è€…ç‰ˆæœ¬é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ç®€åŒ–å®‰è£…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install nodejs npm</span><br></pre></td></tr></table></figure><h2 id="æ–°å»ºå‰ç«¯é¡¹ç›®"><a href="#æ–°å»ºå‰ç«¯é¡¹ç›®" class="headerlink" title="æ–°å»ºå‰ç«¯é¡¹ç›®"></a>æ–°å»ºå‰ç«¯é¡¹ç›®</h2><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥copyä¹‹å‰åç«¯çš„é…ç½®ï¼Œç„¶åå†è¿›è¡Œæ”¹åŠ¨<img src="https://img-blog.csdnimg.cn/f6454d5d2291484a875f17fbdc9093ea.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æºç ç®¡ç†æ”¹æˆè‡ªå·±å‰ç«¯çš„ä»“åº“åœ°å€<br><img src="https://img-blog.csdnimg.cn/3d7fa1b8189d4ab49cd13118d2c7d71c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ç»¿è‰²æ¡†ä½çš„å†…å®¹éœ€è¦æŒ‰ç…§ä½ è‡ªå·±çš„è·¯å¾„æ¥æ”¹åŠ¨<img src="https://img-blog.csdnimg.cn/19761ad746f74b0eb78098dc90bef13d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">cd $&#123;WORKSPACE&#125;</span><br><span class="line">npm install </span><br><span class="line">npm run build:prod</span><br><span class="line">echo &quot;Version:20&quot; &gt; .&#x2F;dist&#x2F;index.html</span><br><span class="line">zip -r web.zip .&#x2F;dist&#x2F;*</span><br><span class="line">case $Status  in</span><br><span class="line">  Deploy)</span><br><span class="line">    echo &quot;Status:$Status&quot;</span><br><span class="line">    path&#x3D;&quot;&#x2F;opt&#x2F;data-detection&#x2F;bak&#x2F;$&#123;BUILD_NUMBER&#125;&quot;      #åˆ›å»ºæ¯æ¬¡è¦å¤‡ä»½çš„ç›®å½•</span><br><span class="line">    if [ -d $path ];</span><br><span class="line">    then</span><br><span class="line">        echo &quot;The files is already  exists &quot;</span><br><span class="line">    else</span><br><span class="line">        mkdir -p  $path</span><br><span class="line">    fi</span><br><span class="line">    #APP_NAME&#x3D;group-module-1.0-SNAPSHOT.jar</span><br><span class="line">    #pid&#x3D;&#96;ps -ef|grep $APP_NAME|grep -v grep|awk &#39;&#123;print $2&#125;&#39; &#96;</span><br><span class="line">#if [ -n &quot;$&#123;pid&#125;&quot; ]; then</span><br><span class="line">#kill -9 $pid</span><br><span class="line">#fi</span><br><span class="line">    \cp -f $&#123;WORKSPACE&#125;&#x2F;web.zip $path &amp;&amp; cp -f $&#123;WORKSPACE&#125;&#x2F;web.zip &#x2F;opt&#x2F;data-detection&#x2F;  #å°†æ‰“åŒ…å¥½çš„waråŒ…å¤‡ä»½åˆ°ç›¸åº”ç›®å½•,è¦†ç›–å·²å­˜åœ¨çš„ç›®æ ‡</span><br><span class="line">    #nohup java -jar &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.jar &gt; &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.log 2&gt;&amp;1 &amp;      </span><br><span class="line">    echo &quot;Completing!&quot;</span><br><span class="line">    ;;</span><br><span class="line">  Rollback)</span><br><span class="line">      echo &quot;Status:$Status&quot;</span><br><span class="line">      echo &quot;Version:$Version&quot;</span><br><span class="line">      cd &#x2F;opt&#x2F;data-detection&#x2F;bak&#x2F;$Version #è¿›å…¥å¤‡ä»½ç›®å½•</span><br><span class="line">      #APP_NAME&#x3D;group-module-1.0-SNAPSHOT.jar</span><br><span class="line">      #pid&#x3D;&#96;ps -ef|grep $APP_NAME|grep -v grep|awk &#39;&#123;print $2&#125;&#39; &#96;</span><br><span class="line">  #if [ -n &quot;$&#123;pid&#125;&quot; ]; then</span><br><span class="line">  #kill -9 $pid</span><br><span class="line">  #fi</span><br><span class="line">      \cp -f web.zip &#x2F;opt&#x2F;data-detection&#x2F; #å°†å¤‡ä»½æ‹·è´åˆ°ç¨‹åºæ‰“åŒ…ç›®å½•ä¸­ï¼Œå¹¶è¦†ç›–ä¹‹å‰çš„jaråŒ…</span><br><span class="line">      #nohup java -jar &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.jar &gt; &#x2F;opt&#x2F;group-module&#x2F;group-module-1.0-SNAPSHOT.log 2&gt;&amp;1 &amp;       </span><br><span class="line">      ;;</span><br><span class="line">  *)</span><br><span class="line">  exit</span><br><span class="line">      ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶æ•°é‡æ§åˆ¶è„šæœ¬è¿™é‡Œä¹Ÿéœ€è¦æ”¹ä¸‹è·¯å¾„<br><img src="https://img-blog.csdnimg.cn/c02d1dd9b8004551a547e0a44675549e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">ReservedNum&#x3D;5  #ä¿ç•™æ–‡ä»¶æ•°</span><br><span class="line">FileDir&#x3D;&#x2F;opt&#x2F;data-detection&#x2F;bak&#x2F;</span><br><span class="line">date&#x3D;$(date &quot;+%Y%m%d-%H%M%S&quot;)</span><br><span class="line"></span><br><span class="line">cd $FileDir   #è¿›å…¥å¤‡ä»½ç›®å½•</span><br><span class="line">FileNum&#x3D;$(ls -l | grep &#39;^d&#39; | wc -l)   #å½“å‰æœ‰å‡ ä¸ªæ–‡ä»¶å¤¹ï¼Œå³å‡ ä¸ªå¤‡ä»½</span><br><span class="line"></span><br><span class="line">while(( $FileNum &gt; $ReservedNum))</span><br><span class="line">do</span><br><span class="line">    OldFile&#x3D;$(ls -rt | head -1)         #è·å–æœ€æ—§çš„é‚£ä¸ªå¤‡ä»½æ–‡ä»¶å¤¹</span><br><span class="line">    echo  $date &quot;Delete File:&quot;$OldFile</span><br><span class="line">    rm -rf $FileDir&#x2F;$OldFile</span><br><span class="line">    let &quot;FileNum--&quot;</span><br><span class="line">done </span><br></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œéƒ¨ç½²çš„è„šæœ¬éœ€è¦é‡æ–°å†™ï¼Œå‰ç«¯çš„æ¯”è¾ƒç®€å•ï¼Œå†™ä¸ªè§£å‹è·Ÿæƒé™çš„å°±å¥½äº†<br><img src="https://img-blog.csdnimg.cn/44fd0bbee067404abf32bf1a98677150.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16"><br><img src="https://img-blog.csdnimg.cn/38b8268a7dbb4491a7b8d2ab59313ea7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;data-detection&#x2F; &amp;&amp; rm -rf dist&#x2F;*</span><br><span class="line">cd &#x2F;opt&#x2F;data-detection&#x2F; &amp;&amp; unzip web.zip &amp;&amp; rm -rf web.zip</span><br><span class="line">chmod 777 &#x2F;opt&#x2F;data-detection&#x2F;dist&#x2F;*</span><br></pre></td></tr></table></figure><h1 id="å‰ç«¯æ¼”ç¤º"><a href="#å‰ç«¯æ¼”ç¤º" class="headerlink" title="å‰ç«¯æ¼”ç¤º"></a>å‰ç«¯æ¼”ç¤º</h1><h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><p>jenkinsæ§åˆ¶å°ä¾æ¬¡é€‰æ‹©deploy,ç‰ˆæœ¬å·23ï¼Œç„¶åç‚¹å‡»æ„å»º</p><p><img src="https://img-blog.csdnimg.cn/62ce78e8cd52411c85238a97d4b0c188.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åè®¿é—®æµè§ˆå™¨<br><img src="https://img-blog.csdnimg.cn/efee0fa146064e5a9ce7c70bb11b5cc4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="Roolback"><a href="#Roolback" class="headerlink" title="Roolback"></a>Roolback</h2><p><img src="https://img-blog.csdnimg.cn/344c65e41d81449da719bb8620c7c5f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>jenkinsæ§åˆ¶å°ä¾æ¬¡é€‰æ‹©Rollback,ç‰ˆæœ¬å·20ï¼Œç„¶åç‚¹å‡»æ„å»ºï¼Œæˆå…±ä¹‹åè®¿é—®æµè§ˆå™¨</p><p><img src="https://img-blog.csdnimg.cn/8c153922bce34bf3b934360567ae9e4a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> jenkins </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jenkinsè‡ªåŠ¨éƒ¨ç½²ç‰ˆæœ¬å›æ»š </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>win10ä¸‹ä½¿ç”¨linux</title>
      <link href="posts/9424.html"/>
      <url>posts/9424.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="è¿˜åœ¨ç”¨è™šæ‹Ÿæœºå—ï¼Ÿé€šè¿‡WSL2åœ¨Win10ä¸‹æ„‰å¿«çš„ç©è€Linux"><a href="#è¿˜åœ¨ç”¨è™šæ‹Ÿæœºå—ï¼Ÿé€šè¿‡WSL2åœ¨Win10ä¸‹æ„‰å¿«çš„ç©è€Linux" class="headerlink" title="è¿˜åœ¨ç”¨è™šæ‹Ÿæœºå—ï¼Ÿé€šè¿‡WSL2åœ¨Win10ä¸‹æ„‰å¿«çš„ç©è€Linux"></a>è¿˜åœ¨ç”¨è™šæ‹Ÿæœºå—ï¼Ÿé€šè¿‡WSL2åœ¨Win10ä¸‹æ„‰å¿«çš„ç©è€Linux</h1><h2 id="å‡†å¤‡ç¯å¢ƒ"><a href="#å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡ç¯å¢ƒ"></a>å‡†å¤‡ç¯å¢ƒ</h2><p>WSLï¼ˆWindows Subsystem for Linuxï¼‰ï¼Œå³é€‚ç”¨äºLinuxçš„Windowså­ç³»ç»Ÿã€‚</p><p>è‡ªä» Win10 æœ‰äº† Linux å­ç³»ç»Ÿï¼ˆWSLï¼‰ï¼Œæˆ‘å°±ç›´æ¥æŠŠç”µè„‘ä¸Šçš„ VMware è™šæ‹Ÿæœºè½¯ä»¶å¸è½½äº†ã€‚<br>WSL ä½“éªŒä¹‹å¥½ï¼Œè°ç”¨è°çŸ¥é“ï¼ï¼ï¼<br>å†åŠ ä¸Š Windows Terminal è¿™æ¬¾æœ€æ–°çš„ç»ˆç«¯ï¼Œé€šè¿‡ä¸€äº›é…ç½®å¯ä»¥ä½¿å¾—ç»ˆç«¯éå¸¸å¥½ç”¨è€Œä¸”èˆ’é€‚å…»çœ¼ï¼Œæ›´åˆ©äºLinuxç¼–ç¨‹äº†ã€‚<br>è¿™ç¯‡åŒ…å«Win10ä¸‹ä½¿ç”¨Linuxçš„å®Œæ•´æ•™ç¨‹ï¼ˆè‡ªå¤¸ä¸€å¥ï¼šæå…¶å®Œæ•´ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰è¿˜æœ‰æŠ¥é”™è§£å†³æ–¹æ¡ˆï¼‰ï¼ŒåŒ…æ‹¬å®‰è£…å’Œç¯å¢ƒé…ç½®ã€‚<br>æ•™ç¨‹è¶³å¤Ÿè¯¦ç»†ï¼Œå°ç™½ä¹Ÿèƒ½çœ‹æ‡‚ï¼Œå¸Œæœ›èƒ½ç»™ä¸ªèµ ğŸ˜˜ æ”¾ä¸ªæœ€ç»ˆæˆæœï¼š<br><img src="https://img-blog.csdnimg.cn/1cd5f11d5bee4ccc84742f780c673dac.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="WSLå®‰è£…"><a href="#WSLå®‰è£…" class="headerlink" title="WSLå®‰è£…"></a>WSLå®‰è£…</h2><p>win10ç‰ˆæœ¬éœ€è¦åœ¨1903ä»¥ä¸Šï¼Œæˆ‘çš„ç‰ˆæœ¬æ˜¯1904ã€‚</p><p>å¯ä»¥ win + R æ‰“å¼€è¿è¡Œï¼Œè¾“å…¥ winver æŸ¥çœ‹ç‰ˆæœ¬å·ã€‚</p><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell åˆ†åˆ«è¾“å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dism.exe &#x2F;online &#x2F;enable-feature &#x2F;featurename:Microsoft-Windows-Subsystem-Linux &#x2F;all &#x2F;norestart</span><br><span class="line"></span><br><span class="line">dism.exe &#x2F;online &#x2F;enable-feature &#x2F;featurename:VirtualMachinePlatform &#x2F;all &#x2F;norestart</span><br></pre></td></tr></table></figure><p>è¾“å…¥å®Œæˆåé‡å¯ç”µè„‘ï¼Œä»¥å®Œæˆ WSL å®‰è£…å¹¶æ›´æ–°åˆ° WSL 2ã€‚</p><p>é‡å¯å®Œä¸‹è½½é€‚ç”¨äº x64 è®¡ç®—æœºçš„ <a href="https://link.juejin.cn/?target=https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">WSL2 Linux å†…æ ¸æ›´æ–°åŒ…</a>ï¼Œå®‰è£…å³å¯ã€‚</p><p>å°† WSL 2 è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --set-default-version 2</span><br></pre></td></tr></table></figure><p>åœ¨å¾®è½¯å•†åº—å†…ä¸‹è½½Linuxåˆ†å‘ç‰ˆï¼Œè¿™é‡Œæˆ‘ä¸‹è½½çš„æ˜¯<a href="https://link.juejin.cn/?target=https://www.microsoft.com/store/apps/9n6svws3rx71">Ubuntu 20.04 LTS</a>ã€‚</p><p>ä¸‹è½½å®Œæˆåæ‰“å¼€ï¼Œé¦–æ¬¡æ‰“å¼€éœ€è¦ç­‰å¾…ä¸€ä¼šå„¿ï¼Œç„¶åæˆ‘ä»¬è®¾ç½®ä¸€ä¸‹ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2e119a6603414094be7d5c1b7c7c410b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">è‹¥å¯åŠ¨ä¹‹åå‡ºç°æ­¤ç±»æƒ…å†µï¼Œä¸‹è½½ <a href="https://img.alexcld.com/package/WSL/NoLsp.exe">NoLsp.exe</a><br>è¾“å…¥D:\NoLsp.exe C:\windows\system32\wsl.exeï¼ˆè¿™é‡Œæ³¨æ„ä½ è‡ªå·±ä¸‹è½½çš„NoLsp.exeä½ç½®ï¼‰<br>å†æ¬¡å¯åŠ¨Ubuntuï¼Œä¸€åˆ‡æ­£å¸¸<br><img src="https://img-blog.csdnimg.cn/8319e2978f434a75aecfe2a3f7bd8357.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åˆ›å»ºå®Œç”¨æˆ·åå’Œå¯†ç åï¼Œè¯¥å¸æˆ·å°†æ˜¯åˆ†å‘ç‰ˆçš„é»˜è®¤ç”¨æˆ·ï¼Œå¹¶å°†åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨ç™»å½•ã€‚è¢«è§†ä¸º Linux ç®¡ç†å‘˜ï¼Œèƒ½å¤Ÿè¿è¡Œ sudo ç®¡ç†å‘½ä»¤ã€‚</p><h2 id="ubuntué…ç½®"><a href="#ubuntué…ç½®" class="headerlink" title="ubuntué…ç½®"></a>ubuntué…ç½®</h2><p>ä¸ºäº†é¿å…æ¯æ¬¡sudoéƒ½è¦è¾“å…¥å¯†ç ï¼Œè¿™é‡Œé…ç½®ä¸€ä¸‹visudoï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä¸€å¥(æ”¹ä¸ºè‡ªå·±çš„ç”¨æˆ·å)ï¼Œä¿®æ”¹å Ctrl + S ä¿å­˜ï¼ŒCtrl + X é€€å‡ºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username ALL&#x3D;(ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure><h3 id="é…ç½®å›½å†…é•œåƒæº"><a href="#é…ç½®å›½å†…é•œåƒæº" class="headerlink" title="é…ç½®å›½å†…é•œåƒæº"></a>é…ç½®å›½å†…é•œåƒæº</h3><p>ä¸ºäº†æå‡ä¸‹è½½è½¯ä»¶çš„é€Ÿåº¦<br>å¤‡ä»½åŸæ¥çš„æºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..    # ä¸€ç›´é€€åˆ°æ ¹ç›®å½•</span><br><span class="line">cd &#x2F;etc&#x2F;apt&#x2F;</span><br><span class="line">cp sources.list sources.list.bak</span><br><span class="line"></span><br><span class="line"># å¦‚æœä¸èƒ½å¤åˆ¶ï¼Œè¿›å…¥è¶…çº§ç”¨æˆ·å†è¯•</span><br><span class="line">sudo su</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æºçš„å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim sources.list</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å…¨éƒ¨åˆ é™¤åä¿®æ”¹ä¸ºé˜¿é‡Œäº‘çš„é•œåƒï¼š</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-security main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-security main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-updates main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-updates main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-proposed main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-proposed main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-backports main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°è½¯ä»¶åˆ—è¡¨ï¼š"><a href="#æ›´æ–°è½¯ä»¶åˆ—è¡¨ï¼š" class="headerlink" title="æ›´æ–°è½¯ä»¶åˆ—è¡¨ï¼š"></a>æ›´æ–°è½¯ä»¶åˆ—è¡¨ï¼š</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> win10ä¸‹ä½¿ç”¨linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºlvmæ ¼å¼ç£ç›˜åˆ†åŒº</title>
      <link href="posts/43435.html"/>
      <url>posts/43435.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h2 id="æœ€è¿‘é‡åˆ°äº‘æœåŠ¡å™¨æ·»åŠ ç£ç›˜ï¼Œå¹¶åˆ†åŒºä¸ºlvmæ ¼å¼ï¼Œè®°å½•ä¸€ä¸‹"><a href="#æœ€è¿‘é‡åˆ°äº‘æœåŠ¡å™¨æ·»åŠ ç£ç›˜ï¼Œå¹¶åˆ†åŒºä¸ºlvmæ ¼å¼ï¼Œè®°å½•ä¸€ä¸‹" class="headerlink" title="æœ€è¿‘é‡åˆ°äº‘æœåŠ¡å™¨æ·»åŠ ç£ç›˜ï¼Œå¹¶åˆ†åŒºä¸ºlvmæ ¼å¼ï¼Œè®°å½•ä¸€ä¸‹"></a>æœ€è¿‘é‡åˆ°äº‘æœåŠ¡å™¨æ·»åŠ ç£ç›˜ï¼Œå¹¶åˆ†åŒºä¸ºlvmæ ¼å¼ï¼Œè®°å½•ä¸€ä¸‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l </span><br><span class="line">--å¯ä»¥çœ‹åˆ°æ–°ç¡¬ç›˜sdb æˆ–å…¶å®ƒç¡¬ç›˜å</span><br></pre></td></tr></table></figure><p>1.ä¸ºæ–°çš„ç¡¬ç›˜åˆ†åŒº ï¼ˆ è¿™é‡Œè¦æ³¨æ„ä¸‹ä½ è‡ªå·±çš„ç¡¬ç›˜åç§°ï¼Œ æˆ‘è¿™é‡Œæ˜¯ /dev/vdbï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fdisk &#x2F;dev&#x2F;vdb</span><br><span class="line"></span><br><span class="line">command (m for help):   n      n å‘½ä»¤ç”¨äºæ–°å»ºä¸€ä¸ªåˆ†åŒº</span><br><span class="line">e extended</span><br><span class="line">p primary partition(1-4): p      p åˆ›å»ºä¸€ä¸ªä¸»åˆ†åŒº</span><br><span class="line">partition number(1-4): 1             åˆ†åŒºå·ä¸º1</span><br><span class="line">First Cylinder(1-XXXXX,default 1): 1  ç›´æ¥é»˜è®¤æŒ‰å›è½¦</span><br><span class="line">Last Cylinder: XXXXX        ç›´æ¥é»˜è®¤æŒ‰å›è½¦</span><br><span class="line">command (m for help): t          ä¿®æ”¹ç£ç›˜ç±»åˆ«</span><br><span class="line">command (m for help):8e       8eè¡¨ç¤ºLVM åˆ†åŒºæ ¼å¼</span><br><span class="line">command (m for help): w    ä¿®æ”¹å†™å…¥åˆ†åŒºè¡¨åé€€å‡º</span><br></pre></td></tr></table></figure><p>2.åˆ›å»ºPV</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvcreate &#x2F;dev&#x2F;vdb1ï¼ˆå¦‚æ— æ³•åˆ›å»ºæç¤ºæ— å‘½ä»¤ï¼šyum -y install lvm2ï¼‰ </span><br></pre></td></tr></table></figure><p>3.åˆ›å»ºVG</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgcreate VolGroup &#x2F;dev&#x2F;vdb1</span><br></pre></td></tr></table></figure><p>4.æ¿€æ´»VG</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgchange -a y VolGroup</span><br></pre></td></tr></table></figure><p>4.åˆ›å»ºLV</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L 499.99G -n Lv_data VolGroup</span><br></pre></td></tr></table></figure><p>5.æ ¼å¼åŒ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 &#x2F;dev&#x2F;VolGroup&#x2F;Lv_data</span><br></pre></td></tr></table></figure><p>6.åˆ›å»ºéœ€è¦æŒ‚è½½çš„ç›®å½•å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;data</span><br></pre></td></tr></table></figure><p>7ã€åˆ°æŒ‡å®šç›®å½•æŒ‚è½½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4 &#x2F;dev&#x2F;VolGroup&#x2F;Lv_data &#x2F;data</span><br></pre></td></tr></table></figure><p>8.å¼€æœºè‡ªåŠ¨æŒ‚è½½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &gt;&gt; &#x2F;dev&#x2F;VolGroup&#x2F;Lv_data &#x2F;data ext4 defaults 0 0 &#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ›å»ºlvmæ ¼å¼ç£ç›˜åˆ†åŒº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s+jenkinså®ç°CIï¼ŒCD</title>
      <link href="posts/63478.html"/>
      <url>posts/63478.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h3 id="k8s-master-tomcatå¯åŠ¨jenkinsæœåŠ¡"><a href="#k8s-master-tomcatå¯åŠ¨jenkinsæœåŠ¡" class="headerlink" title="k8s-master tomcatå¯åŠ¨jenkinsæœåŠ¡"></a>k8s-master tomcatå¯åŠ¨jenkinsæœåŠ¡</h3><p>1.éªŒè¯javaç¯å¢ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]# java -version</span><br><span class="line">openjdk version &quot;1.8.0_292&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_292-b10)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.292-b10, mixed mode)</span><br></pre></td></tr></table></figure><p>2.ä¸‹è½½tomcatï¼Œjenkinså®‰è£…åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;tomcat&#x2F;tomcat-8&#x2F;v8.5.69&#x2F;bin&#x2F;apache-tomcat-8.5.69.tar.gz</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.jenkins.io&#x2F;war-stable&#x2F;latest&#x2F;jenkins.war</span><br></pre></td></tr></table></figure><p>3.é…ç½®ç¯å¢ƒå˜é‡<br>vim /etc/profile æ‰“å¼€é…ç½®æ–‡ä»¶ï¼ŒæŒ‰ i è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œåœ¨profileæ–‡ä»¶å°¾éƒ¨ unset -f pathmunge åé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">unset i</span><br><span class="line">unset -f pathmunge</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_221</span><br><span class="line">export JRE_HOME&#x3D;$&#123;JAVA_HOME&#125;&#x2F;jre</span><br><span class="line">export CATALINA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;tomcat8</span><br><span class="line">export CLASSPATH&#x3D;.:$&#123;JAVA_HOME&#125;&#x2F;lib:$&#123;JRE_HOME&#125;&#x2F;lib:$CLASSPATH</span><br><span class="line">export JAVA_PATH&#x3D;$&#123;JAVA_HOME&#125;&#x2F;bin:$&#123;JRE_HOME&#125;&#x2F;bin:$&#123;CATALINA_HOME&#125;&#x2F;bin</span><br><span class="line">export PATH&#x3D;$PATH:$&#123;JAVA_PATH&#125;:$PATH</span><br></pre></td></tr></table></figure><p>4.é…ç½®tomcatå¹¶å¯åŠ¨jenkins</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;usr&#x2F;local&#x2F;tomcat8</span><br><span class="line">tar -zxvf apache-tomcat-8.5.37.tar.gz -C &#x2F;usr&#x2F;local&#x2F;tomcat8</span><br><span class="line">mv jenkins.war &#x2F;usr&#x2F;local&#x2F;tomcat8&#x2F;webapps</span><br><span class="line">#å¯åŠ¨tomcat</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;tomcat8&#x2F;bin&#x2F;startup.sh</span><br><span class="line">#åœæ­¢tomcat</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;tomcat8&#x2F;bin&#x2F;shutdown.sh</span><br></pre></td></tr></table></figure><p><a href="http://localhost:8080/">http://localhost:8080</a> è®¿é—®jenkins</p><h3 id="è‡ªåŠ¨åŒ–è„šæœ¬"><a href="#è‡ªåŠ¨åŒ–è„šæœ¬" class="headerlink" title="è‡ªåŠ¨åŒ–è„šæœ¬"></a>è‡ªåŠ¨åŒ–è„šæœ¬</h3><p>åœ¨jenkinsçš„åç«¯å‡†å¤‡å¥½è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬k8s_auto_deploy.shï¼Œäº‹å…ˆåšå¥½å…¬ç§é’¥è®¤è¯ï¼Œä½¿å¾—jenkinsèƒ½å¤Ÿè®¿é—®k8s-master</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">URL&#x3D;http:&#x2F;&#x2F;106.12.189.57&#x2F;root&#x2F;java-demo.git</span><br><span class="line">Starttime&#x3D;&#96;date +&quot;%Y-%m-%d_%H-%M-%S&quot;&#96;</span><br><span class="line">Method&#x3D;$1</span><br><span class="line">Branch&#x3D;$2</span><br><span class="line">t1&#x3D;&#96;date +&quot;%Y-%m-%d %H:%M:%S&quot;&#96;</span><br><span class="line"></span><br><span class="line">     #ä»£ç å…‹éš†è‡³jenkinsåç«¯</span><br><span class="line">clone_code()&#123;</span><br><span class="line">    cd &#x2F;root&#x2F;.jenkins&#x2F;workspace&#x2F;jenkins_project &amp;&amp; git clone -b $Branch $&#123;URL&#125;&amp;&amp; echo &quot;Clone Finished&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> #ä»£ç æ‰“åŒ…å‹ç¼©å¹¶è¿œç¨‹æ¨é€è‡³k8s-master-1çš„nginxé•œåƒåˆ¶ä½œç›®å½•</span><br><span class="line">Pack_scp()&#123;</span><br><span class="line">    cd &#x2F;root&#x2F;.jenkins&#x2F;workspace&#x2F;jenkins_project&#x2F;java-demo&#x2F; &amp;&amp; tar cvzf java-demo.tar.gz * &amp;&amp; echo Package Finished</span><br><span class="line">    cp java-demo.tar.gz &#x2F;data&#x2F;Dockerfile&#x2F;java-demo&#x2F; &amp;&amp; cd &#x2F;data&#x2F;Dockerfile&#x2F;java-demo&#x2F; &amp;&amp; tar xvf java-demo.tar.gz &amp;&amp; rm -f java-demo.tar.gz</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> #è¿œç¨‹æ“ä½œk8s-master-1èŠ‚ç‚¹ï¼Œè¿›è¡Œé•œåƒåˆ¶ä½œå¹¶æ¨é€è‡³harboré•œåƒä»“åº“</span><br><span class="line">build_iamge()&#123;</span><br><span class="line">    cd &#x2F;data&#x2F;Dockerfile&#x2F;java-demo&#x2F; &amp;&amp; .&#x2F;build.sh $&#123;BUILD_NUMBER&#125; &amp;&amp; echo &#39;build_image and push_harbor success!&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    #å¯¹k8sé›†ç¾¤ä¸­çš„nginxçš„podåº”ç”¨è¿›è¡Œå‡çº§</span><br><span class="line">app_update()&#123;</span><br><span class="line">    sed -ri &#39;s@image: .*@image: 106.12.37.109&#x2F;library&#x2F;tomcat-java-demo:$&#123;BUILD_NUMBER&#125;@g&#39;  &#x2F;data&#x2F;mainfest&#x2F;deployment.yaml</span><br><span class="line">    kubectl set image deployment&#x2F;java-demo java-demo&#x3D;106.12.37.109&#x2F;library&#x2F;tomcat-java-demo:$&#123;BUILD_NUMBER&#125; -n default --record&#x3D;true</span><br><span class="line">                t2&#x3D;&#96;date +&quot;%Y-%m-%d %H:%M:%S&quot;&#96;</span><br><span class="line">    start_T&#x3D;&#96;date --date&#x3D;&quot;$&#123;t1&#125;&quot; +%s&#96;</span><br><span class="line">    end_T&#x3D;&#96;date --date&#x3D;&quot;$&#123;t2&#125;&quot; +%s&#96;</span><br><span class="line">    total_time&#x3D;$((end_T-start_T))</span><br><span class="line">    echo &quot;deploy success,it has been spent $&#123;total_time&#125; seconds&quot;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    #k8sé›†ç¾¤ä¸­çš„podåº”ç”¨è¿›è¡Œå›æ»š</span><br><span class="line">app_rollback()&#123;</span><br><span class="line">     kubectl rollout undo deployment&#x2F;java-demo  -n default</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    #è¿›è¡Œk8sé›†ç¾¤è‡ªåŠ¨éƒ¨ç½²çš„ä¸»å‡½æ•°</span><br><span class="line">main()&#123;</span><br><span class="line">    case $Method in </span><br><span class="line">    deploy)</span><br><span class="line">        clone_code</span><br><span class="line">        Pack_scp</span><br><span class="line">        build_iamge</span><br><span class="line">        app_update</span><br><span class="line">    ;;</span><br><span class="line">    rollback)</span><br><span class="line">        app_rollback</span><br><span class="line">    ;;</span><br><span class="line">    esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#æ‰§è¡Œä¸»å‡½æ•°å‘½ä»¤</span><br><span class="line">main $1 $2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ„å»ºé•œåƒä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">#é•œåƒç‰ˆæœ¬å˜é‡</span><br><span class="line">version&#x3D;$1</span><br><span class="line">#ç¼–è¯‘é¡¹ç›®ä»£ç </span><br><span class="line">mvn clean package -Dmaven.test.skip&#x3D;true</span><br><span class="line">#è§£å‹é¡¹ç›®ä»£ç è‡³æ–°æ–‡ä»¶å¤¹</span><br><span class="line">unzip target&#x2F;*.war -d target&#x2F;ROOT</span><br><span class="line">#ç¼–å†™Dockerfile</span><br><span class="line">cat &gt; Dockerfile &lt;&lt;EOF</span><br><span class="line">FROM lizhenliang&#x2F;tomcat   </span><br><span class="line">LABEL maintainer alex</span><br><span class="line">RUN rm -rf &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;*</span><br><span class="line">COPY target&#x2F;ROOT &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;ROOT </span><br><span class="line">EOF</span><br><span class="line">#buildé•œåƒå¹¶æ¨é€</span><br><span class="line">docker build -t 106.12.37.109&#x2F;library&#x2F;tomcat-java-demo:$version .</span><br><span class="line">docker push 106.12.37.109&#x2F;library&#x2F;tomcat-java-demo:$version</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å‚æ•°åŒ–æ„å»º"><a href="#å‚æ•°åŒ–æ„å»º" class="headerlink" title="å‚æ•°åŒ–æ„å»º"></a>å‚æ•°åŒ–æ„å»º</h2><p>webç«¯è®¿é—®jenkins<br><img src="https://img-blog.csdnimg.cn/561f5a71b3aa4a8aa21c8a228c567150.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br>åˆ›å»ºä¸€ä¸ªjenkins_projecté¡¹ç›®ï¼Œå¹¶ç¼–è¾‘é…ç½®<br><img src="https://img-blog.csdnimg.cn/9f4f2c9fc19a4f3fbab8e4c9a20ff14d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/b194cf37cb1c432899651f832f898f59.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br>å°†jenkinsçš„å…¬é’¥é…ç½®åˆ°gitlabæœåŠ¡çš„webç«¯ï¼Œä½¿å¾—jenkinså¯ä»¥ç›´æ¥æ‹‰å–ä»£ç æ— éœ€è®¤è¯<img src="https://img-blog.csdnimg.cn/4e21fcf761fb48bb904d5a1c8e4508bf.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/689145a726d54c6393aaad1f6ff12ff0.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br>æˆ–è€…ä½¿ç”¨httpsæ–¹å¼æ¥å–ä»£ç  ï¼Œæˆ‘æµ‹è¯•ä¸­ç”¨çš„æ˜¯httpsï¼Œç”Ÿäº§ä¸­æœ€å¥½ç”¨ssh<br>åç»­éªŒè¯å°±ä¸å†™äº†</p>]]></content>
      
      
      <categories>
          
          <category> jenkins </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s+jenkinså®ç°CIï¼ŒCD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>alertmanageré’‰é’‰æŠ¥è­¦</title>
      <link href="posts/6543.html"/>
      <url>posts/6543.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="é’‰é’‰æŠ¥è­¦æ’ä»¶å·²æ‰“åŒ…åœ¨é•œåƒï¼Œä¸æƒ³éº»çƒ¦çš„å¯ä»¥ç›´æ¥pull"><a href="#é’‰é’‰æŠ¥è­¦æ’ä»¶å·²æ‰“åŒ…åœ¨é•œåƒï¼Œä¸æƒ³éº»çƒ¦çš„å¯ä»¥ç›´æ¥pull" class="headerlink" title="é’‰é’‰æŠ¥è­¦æ’ä»¶å·²æ‰“åŒ…åœ¨é•œåƒï¼Œä¸æƒ³éº»çƒ¦çš„å¯ä»¥ç›´æ¥pull"></a>é’‰é’‰æŠ¥è­¦æ’ä»¶å·²æ‰“åŒ…åœ¨é•œåƒï¼Œä¸æƒ³éº»çƒ¦çš„å¯ä»¥ç›´æ¥pull</h1><h2 id="å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥"><a href="#å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥" class="headerlink" title="å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥"></a>å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥</h2><ul><li>ä¸ªäººBlogï¼š<a href="https://alexcld.com/">https://alexcld.com</a></li><li>CSDNï¼š<a href="https://blog.csdn.net/weixin_45509582">https://blog.csdn.net/weixin_45509582</a></li></ul><p>åŠ å¯†token</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -n &#39;token&#39; | base64</span><br></pre></td></tr></table></figure><p>alertGo-deployment.yaml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: dd-token</span><br><span class="line">  namespace: ops</span><br><span class="line">type: Opaque</span><br><span class="line">data:</span><br><span class="line">  token: &#39;åŠ å¯†åçš„token&#39;</span><br><span class="line">---</span><br><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: alertgo</span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: alertgo</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: alertgo</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: alertgo</span><br><span class="line">          image: alexcld&#x2F;alertgo:v3</span><br><span class="line">          env:</span><br><span class="line">          - name: token</span><br><span class="line">            valueFrom:</span><br><span class="line">              secretKeyRef:</span><br><span class="line">                name: dd-token</span><br><span class="line">                key: token</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 8088</span><br><span class="line">          livenessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: &#x2F;</span><br><span class="line">              port: 8088</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            periodSeconds: 10</span><br><span class="line">            successThreshold: 1</span><br><span class="line">            failureThreshold: 3</span><br><span class="line">            timeoutSeconds: 1</span><br><span class="line">          readinessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: &#x2F;</span><br><span class="line">              port: 8088</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            periodSeconds: 10</span><br><span class="line">            successThreshold: 1</span><br><span class="line">            failureThreshold: 3</span><br><span class="line">            timeoutSeconds: 1</span><br><span class="line">          lifecycle:</span><br><span class="line">            preStop:</span><br><span class="line">              exec:</span><br><span class="line">                command: [&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-c&quot;,&quot;sleep 20&quot;]</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: alertgo</span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: alertgo</span><br><span class="line">  ports:</span><br><span class="line">    - port: 80</span><br><span class="line">      targetPort: 8088</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>kubectl apply -f alertGo-deployment.yaml</p><h2 id="ä¿®æ”¹alertmanager-configmap-yaml"><a href="#ä¿®æ”¹alertmanager-configmap-yaml" class="headerlink" title="ä¿®æ”¹alertmanager-configmap.yaml"></a>ä¿®æ”¹alertmanager-configmap.yaml</h2><p><img src="https://img-blog.csdnimg.cn/a516c430f9564610aae3e311fb999fd0.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webhook_configs:</span><br><span class="line">      - url: &#39;http:&#x2F;&#x2F;clusterIP&#x2F;Alert&#39;</span><br><span class="line">        send_resolved: true</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å®Œæˆ</p><h1 id="goç¯å¢ƒéƒ¨ç½²åŠæ‰“åŒ…é’‰é’‰æŠ¥è­¦æ’ä»¶"><a href="#goç¯å¢ƒéƒ¨ç½²åŠæ‰“åŒ…é’‰é’‰æŠ¥è­¦æ’ä»¶" class="headerlink" title="goç¯å¢ƒéƒ¨ç½²åŠæ‰“åŒ…é’‰é’‰æŠ¥è­¦æ’ä»¶"></a>goç¯å¢ƒéƒ¨ç½²åŠæ‰“åŒ…é’‰é’‰æŠ¥è­¦æ’ä»¶</h1><h2 id="å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥-1"><a href="#å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥-1" class="headerlink" title="å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥"></a>å…¶ä»–ä¸¤ä¸ªå¹³å°å®æ—¶åŒæ­¥</h2><ul><li>ä¸ªäººBlogï¼š<a href="https://alexcld.com/">https://alexcld.com</a></li><li>CSDNï¼š<a href="https://blog.csdn.net/weixin_45509582">https://blog.csdn.net/weixin_45509582</a><h2 id="linuxå®‰è£…go1-13-10"><a href="#linuxå®‰è£…go1-13-10" class="headerlink" title="linuxå®‰è£…go1.13.10"></a>linuxå®‰è£…go1.13.10</h2></li></ul><p>ä¸‹è½½è§£å‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt &amp;&amp; wget https:&#x2F;&#x2F;golang.org&#x2F;dl&#x2F;go1.13.10.linux-amd64.tar.gz</span><br><span class="line">#è§£å‹è‡³&#x2F;usr&#x2F;local</span><br><span class="line">tar -zxvf go1.13.10.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>åˆ›å»º/opt/gocode/{src,bin,pkg}ï¼Œç”¨äºè®¾ç½®GOPATHä¸º/opt/gocode</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;opt&#x2F;gocode&#x2F;&#123;src,bin,pkg&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;opt&#x2F;gocode&#x2F;</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”œâ”€â”€ pkg</span><br><span class="line">â””â”€â”€ src</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹/etc/profileç³»ç»Ÿç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œå†™å…¥GOPATHä¿¡æ¯ä»¥åŠgo sdkè·¯å¾„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export GOROOT&#x3D;&#x2F;opt&#x2F;go           #Golangæºä»£ç ç›®å½•ï¼Œå®‰è£…ç›®å½•</span><br><span class="line">export GOPATH&#x3D;&#x2F;opt&#x2F;gocode        #Golangé¡¹ç›®ä»£ç ç›®å½•</span><br><span class="line">export PATH&#x3D;$GOROOT&#x2F;bin:$PATH    #Linuxç¯å¢ƒå˜é‡</span><br><span class="line">export GOBIN&#x3D;$GOPATH&#x2F;bin        #go installåç”Ÿæˆçš„å¯æ‰§è¡Œå‘½ä»¤å­˜æ”¾è·¯å¾„</span><br><span class="line"># ä¿å­˜é€€å‡ºåsourceä¸€ä¸‹</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œgo version</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost gocode]# go version</span><br><span class="line">go version go1.13.10 linux&#x2F;amd64</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œç¨‹åºå¹¶æ‰“åŒ…"><a href="#è¿è¡Œç¨‹åºå¹¶æ‰“åŒ…" class="headerlink" title="è¿è¡Œç¨‹åºå¹¶æ‰“åŒ…"></a>è¿è¡Œç¨‹åºå¹¶æ‰“åŒ…</h2><h3 id="å®‰è£…gin-webæ¡†æ¶"><a href="#å®‰è£…gin-webæ¡†æ¶" class="headerlink" title="å®‰è£…gin webæ¡†æ¶"></a>å®‰è£…gin webæ¡†æ¶</h3><p>çˆ¬è¿‡æ¢¯å­çš„å¯ä»¥ç›´æ¥å®‰è£…ï¼Œä¸å†èµ˜è¿°å¦‚ä½•çˆ¬æ¢¯å­ï¼Œå¦‚æœæ²¡æœ‰çˆ¬æ¢¯å­çš„è¯ éœ€è¦è®¾ç½®ä¸‹GOPROXY</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">golang 1.13 å¯ä»¥ç›´æ¥æ‰§è¡Œï¼š</span><br><span class="line"></span><br><span class="line">ä¸ƒç‰›äº‘</span><br><span class="line">go env -w GO111MODULE&#x3D;on</span><br><span class="line">go env -w GOPROXY&#x3D;https:&#x2F;&#x2F;goproxy.cn,direct</span><br><span class="line"></span><br><span class="line">é˜¿é‡Œäº‘</span><br><span class="line">go env -w GO111MODULE&#x3D;on</span><br><span class="line">go env -w GOPROXY&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;goproxy&#x2F;,direct</span><br></pre></td></tr></table></figure><p>å®‰è£…ginä¾èµ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com&#x2F;gin-gonic&#x2F;gin</span><br></pre></td></tr></table></figure><p>åˆ›å»ºgoæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $GOPATH&#x2F;alertgo &amp;&amp; cd $GOPATH&#x2F;alertgo</span><br><span class="line">touch alertGo.go</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;bytes&quot;</span><br><span class="line">&quot;encoding&#x2F;json&quot;</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">&quot;net&#x2F;http&quot;</span><br><span class="line">&quot;os&quot;</span><br><span class="line">&quot;strings&quot;</span><br><span class="line">&quot;time&quot;</span><br><span class="line"></span><br><span class="line">&quot;github.com&#x2F;gin-gonic&#x2F;gin&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;const (</span><br><span class="line">&#x2F;&#x2F;webHook_Alert &#x3D; &quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;724402cd85e7e80aa5bbbb7d7a89c74db6a3a8bd8fac4c91923ed3f906664ba4&quot;</span><br><span class="line">&#x2F;&#x2F;)</span><br><span class="line">type Message struct &#123;</span><br><span class="line">MsgType string &#96;json:&quot;msgtype&quot;&#96;</span><br><span class="line">Text    struct &#123;</span><br><span class="line">Content               string &#96;json:&quot;content&quot;&#96;</span><br><span class="line">Mentioned_list        string &#96;json:&quot;mentioned_list&quot;&#96;</span><br><span class="line">Mentioned_mobile_list string &#96;json:&quot;mentioned_mobile_list&quot;&#96;</span><br><span class="line">&#125; &#96;json:&quot;text&quot;&#96;</span><br><span class="line">&#125;</span><br><span class="line">type Alert struct &#123;</span><br><span class="line">Labels      map[string]string &#96;json:&quot;labels&quot;&#96;</span><br><span class="line">Annotations map[string]string &#96;json:annotations&#96;</span><br><span class="line">StartsAt    time.Time         &#96;json:&quot;startsAt&quot;&#96;</span><br><span class="line">EndsAt      time.Time         &#96;json:&quot;endsAt&quot;&#96;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;é€šçŸ¥æ¶ˆæ¯ç»“æ„ä½“</span><br><span class="line">type Notification struct &#123;</span><br><span class="line">Version           string            &#96;json:&quot;version&quot;&#96;</span><br><span class="line">GroupKey          string            &#96;json:&quot;groupKey&quot;&#96;</span><br><span class="line">Status            string            &#96;json:&quot;status&quot;&#96;</span><br><span class="line">Receiver          string            &#96;json:receiver&#96;</span><br><span class="line">GroupLabels       map[string]string &#96;json:groupLabels&#96;</span><br><span class="line">CommonLabels      map[string]string &#96;json:commonLabels&#96;</span><br><span class="line">CommonAnnotations map[string]string &#96;json:commonAnnotations&#96;</span><br><span class="line">ExternalURL       string            &#96;json:externalURL&#96;</span><br><span class="line">Alerts            []Alert           &#96;json:alerts&#96;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;è·å–æŠ¥è­¦ä¿¡æ¯</span><br><span class="line">func getAlertInfo(notification Notification) string &#123;</span><br><span class="line">var m Message</span><br><span class="line">m.MsgType &#x3D; &quot;text&quot;</span><br><span class="line">&#x2F;&#x2F;å‘Šè­¦æ¶ˆæ¯</span><br><span class="line">&#x2F;&#x2F;é‡æ–°å®šä¹‰æŠ¥è­¦æ¶ˆæ¯</span><br><span class="line">var newbuffer bytes.Buffer</span><br><span class="line">&#x2F;&#x2F;å®šä¹‰æ¢å¤æ¶ˆæ¯</span><br><span class="line">var recoverbuffer bytes.Buffer</span><br><span class="line">fmt.Println(notification)</span><br><span class="line">fmt.Println(notification.Status)</span><br><span class="line">if notification.Status &#x3D;&#x3D; &quot;resolved&quot; &#123;</span><br><span class="line">for _, alert :&#x3D; range notification.Alerts &#123;</span><br><span class="line">recoverbuffer.WriteString(fmt.Sprintf(&quot;çŠ¶æ€å·²ç»æ¢å¤!!!!\n&quot;))</span><br><span class="line">recoverbuffer.WriteString(fmt.Sprintf(&quot; **é¡¹ç›®: æ¢å¤æ—¶é—´:**%s\n\n&quot;, alert.StartsAt.Add(8*time.Hour).Format(&quot;2006-01-02 15:04:05&quot;)))</span><br><span class="line">recoverbuffer.WriteString(fmt.Sprintf(&quot;é¡¹ç›®: å‘Šè­¦ä¸»é¢˜: %s \n&quot;, alert.Annotations[&quot;summary&quot;]))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">for _, alert :&#x3D; range notification.Alerts &#123;</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; \n&quot;))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;é¡¹ç›®: å‘Šè­¦ç¨‹åºï¼šprometheus_alert_email \n&quot;))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;é¡¹ç›®: å‘Šè­¦çº§åˆ«: %s \n&quot;, alert.Labels[&quot;severity&quot;]))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;é¡¹ç›®: å‘Šè­¦ç±»å‹: %s \n&quot;, alert.Labels[&quot;alertname&quot;]))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;é¡¹ç›®: æ•…éšœä¸»æœº: %s \n&quot;, alert.Labels[&quot;instance&quot;]))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;é¡¹ç›®: å‘Šè­¦ä¸»é¢˜: %s \n&quot;, alert.Annotations[&quot;summary&quot;]))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;é¡¹ç›®: å‘Šè­¦è¯¦æƒ…: %s \n&quot;, alert.Annotations[&quot;description&quot;]))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot; **é¡¹ç›®: å¼€å§‹æ—¶é—´:**%s\n\n&quot;, alert.StartsAt.Add(8*time.Hour).Format(&quot;2006-01-02 15:04:05&quot;)))</span><br><span class="line">newbuffer.WriteString(fmt.Sprintf(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;End&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; \n&quot;))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if notification.Status &#x3D;&#x3D; &quot;resolved&quot; &#123;</span><br><span class="line">m.Text.Content &#x3D; recoverbuffer.String()</span><br><span class="line">&#125; else &#123;</span><br><span class="line">m.Text.Content &#x3D; newbuffer.String()</span><br><span class="line">&#125;</span><br><span class="line">jsons, err :&#x3D; json.Marshal(m)</span><br><span class="line">if err !&#x3D; nil &#123;</span><br><span class="line">fmt.Println(&quot;è§£æå‘é€é’‰é’‰çš„ä¿¡æ¯æœ‰é—®é¢˜!!!!&quot;)</span><br><span class="line">&#125;</span><br><span class="line">resp :&#x3D; string(jsons)</span><br><span class="line">return resp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;é’‰é’‰æŠ¥è­¦</span><br><span class="line">func SendAlertDingMsg(msg string) &#123;</span><br><span class="line">defer func() &#123;</span><br><span class="line">if err :&#x3D; recover(); err !&#x3D; nil &#123;</span><br><span class="line">fmt.Println(&quot;err&quot;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">token :&#x3D; os.Getenv(&quot;token&quot;)</span><br><span class="line">webHook_Alert :&#x3D; &quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;&quot; + token</span><br><span class="line">fmt.Println(&quot;å¼€å§‹å‘é€æŠ¥è­¦æ¶ˆæ¯!!!&quot;)</span><br><span class="line">fmt.Println(webHook_Alert)</span><br><span class="line">&#x2F;&#x2F;content :&#x3D; &#96;&#123;&quot;msgtype&quot;: &quot;text&quot;,</span><br><span class="line">&#x2F;&#x2F;&quot;text&quot;: &#123;&quot;content&quot;: &quot;&#96; + msg + &#96;&quot;&#125;</span><br><span class="line">&#x2F;&#x2F;&#125;&#96;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªè¯·æ±‚</span><br><span class="line">req, err :&#x3D; http.NewRequest(&quot;POST&quot;, webHook_Alert, strings.NewReader(msg))</span><br><span class="line">if err !&#x3D; nil &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">fmt.Println(&quot;é’‰é’‰æŠ¥è­¦è¯·æ±‚å¼‚å¸¸&quot;)</span><br><span class="line">&#125;</span><br><span class="line">client :&#x3D; &amp;http.Client&#123;&#125;</span><br><span class="line">&#x2F;&#x2F;è®¾ç½®è¯·æ±‚å¤´</span><br><span class="line">req.Header.Set(&quot;Content-Type&quot;, &quot;application&#x2F;json; charset&#x3D;utf-8&quot;)</span><br><span class="line">&#x2F;&#x2F;å‘é€è¯·æ±‚</span><br><span class="line">resp, err :&#x3D; client.Do(req)</span><br><span class="line">if err !&#x3D; nil &#123;</span><br><span class="line">&#x2F;&#x2F; handle error</span><br><span class="line">fmt.Println(err)</span><br><span class="line">fmt.Println(&quot;é¡¶é¡¶æŠ¥å‘é€å¼‚å¸¸!!!&quot;)</span><br><span class="line">&#125;</span><br><span class="line">defer resp.Body.Close()</span><br><span class="line">&#125;</span><br><span class="line">func AlertInfo(c *gin.Context) &#123;</span><br><span class="line">var notification Notification</span><br><span class="line">fmt.Println(&quot;æ¥æ”¶åˆ°çš„ä¿¡æ¯æ˜¯....&quot;)</span><br><span class="line">fmt.Println(notification)</span><br><span class="line">err :&#x3D; c.BindJSON(&amp;notification)</span><br><span class="line">fmt.Printf(&quot;%#v&quot;, notification)</span><br><span class="line">if err !&#x3D; nil &#123;</span><br><span class="line">fmt.Println(&quot;ç»‘å®šä¿¡æ¯é”™è¯¯!!!&quot;)</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;&quot;error&quot;: err.Error()&#125;)</span><br><span class="line">return</span><br><span class="line">&#125; else &#123;</span><br><span class="line">fmt.Println(&quot;ç»‘å®šä¿¡æ¯æˆåŠŸ&quot;)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(&quot;ç»‘å®šä¿¡æ¯æˆåŠŸ!!!&quot;)</span><br><span class="line">msg :&#x3D; getAlertInfo(notification)</span><br><span class="line">fmt.Println(&quot;æ‰“å°çš„ä¿¡æ¯æ˜¯.....&quot;)</span><br><span class="line">fmt.Println(msg)</span><br><span class="line">SendAlertDingMsg(msg)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">t :&#x3D; gin.Default()</span><br><span class="line">t.POST(&quot;&#x2F;Alert&quot;, AlertInfo)</span><br><span class="line">t.GET(&quot;&#x2F;&quot;, func(c *gin.Context) &#123;</span><br><span class="line">c.String(http.StatusOK, &#96;&lt;h1&gt;å…³äºalertmanagerå®ç°é’‰é’‰æŠ¥è­¦çš„æ–¹æ³•V6ï¼ï¼ï¼&lt;&#x2F;h1&gt;&#96;+&quot;\næ–°å¢äº†æŠ¥è­¦æ¢å¤æœºåˆ¶ï¼ï¼ï¼&quot;)</span><br><span class="line">&#125;)</span><br><span class="line">t.Run(&quot;:8088&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå°†goæ–‡ä»¶æ‰“åŒ…ä¸ºlinuxäºŒè¿›åˆ¶å¯è¿è¡Œç¨‹åº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build alertGo.go</span><br></pre></td></tr></table></figure><p>è¿è¡ŒalertGoç¨‹åº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">###èµ‹æƒ</span><br><span class="line">chmod 775 alertGo</span><br><span class="line">###åå°è¿è¡Œ</span><br><span class="line">nohup &#x2F;root&#x2F;prometheus&#x2F;alertGo&#x2F;alertGo &gt; alertGo.log 2&gt;&amp;1 &amp;</span><br><span class="line">###æŸ¥çœ‹ç«¯å£è¿›ç¨‹</span><br><span class="line">lsof -i:8088</span><br><span class="line">###æŸ¥çœ‹æ—¥å¿—</span><br><span class="line">tail -f alertGo.log </span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹alertmanager-configmap-yaml-1"><a href="#ä¿®æ”¹alertmanager-configmap-yaml-1" class="headerlink" title="ä¿®æ”¹alertmanager-configmap.yaml"></a>ä¿®æ”¹alertmanager-configmap.yaml</h2><p><img src="https://img-blog.csdnimg.cn/a516c430f9564610aae3e311fb999fd0.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webhook_configs:</span><br><span class="line">      - url: &#39;http:&#x2F;&#x2F;xxxxx:8088&#x2F;Alert&#39;</span><br><span class="line">        send_resolved: true</span><br></pre></td></tr></table></figure><p>çƒ­æ›´æ–°prometheus</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f alertmanager-configmap.yaml</span><br><span class="line">###alertmanager clusterIP</span><br><span class="line">curl -X POST http:&#x2F;&#x2F;10.1.229.17&#x2F;-&#x2F;reload  </span><br></pre></td></tr></table></figure><p>ç„¶åè§¦å‘æŠ¥è­¦ï¼Œé’‰é’‰å°±å¯ä»¥æ­£å¸¸æ”¶å–äº†ï¼Œ<br><img src="https://img-blog.csdnimg.cn/dfbbf2efe4b446c1bc71a20a54855180.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨æ­¤æ„Ÿè°¢<a href="https://blog.51cto.com/luoguoling">å¤§ä½¬</a>çš„ä»£ç </p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> alertmanageré’‰é’‰æŠ¥è­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç›‘æ§ä½“ç³»éƒ¨ç½²ä¹‹åèµ°ä¸Šäº†grafanaæ¨¡æ¿è¸©å‘ä¹‹è·¯</title>
      <link href="posts/267647.html"/>
      <url>posts/267647.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h2 id="åŠå¤©è¸©å‘ï¼Œæ’å‘ï¼Œæœ€åå¡«å‘ï¼Œä¿®æ”¹å­—æ®µã€‚æœ€åæ•ˆæœå¦‚ä¸‹ï¼Œå¯åˆ°æˆ‘çš„githubå‚è€ƒ"><a href="#åŠå¤©è¸©å‘ï¼Œæ’å‘ï¼Œæœ€åå¡«å‘ï¼Œä¿®æ”¹å­—æ®µã€‚æœ€åæ•ˆæœå¦‚ä¸‹ï¼Œå¯åˆ°æˆ‘çš„githubå‚è€ƒ" class="headerlink" title="åŠå¤©è¸©å‘ï¼Œæ’å‘ï¼Œæœ€åå¡«å‘ï¼Œä¿®æ”¹å­—æ®µã€‚æœ€åæ•ˆæœå¦‚ä¸‹ï¼Œå¯åˆ°æˆ‘çš„githubå‚è€ƒ"></a>åŠå¤©è¸©å‘ï¼Œæ’å‘ï¼Œæœ€åå¡«å‘ï¼Œä¿®æ”¹å­—æ®µã€‚æœ€åæ•ˆæœå¦‚ä¸‹ï¼Œå¯åˆ°æˆ‘çš„githubå‚è€ƒ</h2><h2 id="è¿ç»´èµ„æºå…¨è§ˆ"><a href="#è¿ç»´èµ„æºå…¨è§ˆ" class="headerlink" title="è¿ç»´èµ„æºå…¨è§ˆ"></a>è¿ç»´èµ„æºå…¨è§ˆ</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/4421d1b06e96c6a63466ac8b2122842b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/img_convert/21295f99b85da5b1af1111d114f62119.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/img_convert/545115d126254153c60a1c97433772cb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/img_convert/c9e875ec36d1660b992abffa5aed0e73.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="èŠ‚ç‚¹èµ„æºæ€»è§ˆ"><a href="#èŠ‚ç‚¹èµ„æºæ€»è§ˆ" class="headerlink" title="èŠ‚ç‚¹èµ„æºæ€»è§ˆ"></a>èŠ‚ç‚¹èµ„æºæ€»è§ˆ</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/db7cb62d9e3919aa68ad329182e19ae3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/img_convert/4e04c28b6b3db34d0c030510faa7ff11.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/img_convert/8650c4c031b6666889e3011527d9583b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç›‘æ§ä½“ç³»éƒ¨ç½²ä¹‹åèµ°ä¸Šäº†grafanaæ¨¡æ¿è¸©å‘ä¹‹è·¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheusé‚®ä»¶å‘Šè­¦è‡ªå®šä¹‰æ¨¡æ¿çš„è§¦å‘æ—¶é—´ä¸ºutcçš„è§£å†³æ–¹æ³•</title>
      <link href="posts/24142.html"/>
      <url>posts/24142.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p>èƒŒæ™¯<br>Prometheus é‚®ä»¶å‘Šè­¦è‡ªå®šä¹‰æ¨¡æ¿çš„é»˜è®¤ä½¿ç”¨çš„æ˜¯utcæ—¶é—´ã€‚</p><p>è§£å†³<br>å¦‚æœè¦æ”¹æˆåŒ—äº¬æ—¶é—´çš„è¯å¯ä»¥è¿™ä¹ˆæ”¹ï¼š</p><p>åŸæ¥çš„å‘Šè­¦æ¨¡æ¿çš„è§¦å‘æ—¶é—´æ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è§¦å‘æ—¶é—´: &#123;&#123; .StartsAt.Format &quot;2020-01-02 15:04:05&quot; &#125;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™æ ·å­çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; (.StartsAt.Add 28800e9).Format &quot;2020-01-02 15:04:05&quot; &#125;&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ Add 28800e9  å°±æ˜¯è¡¨ç¤ºåŠ 8ä¸ªå°æ—¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Prometheusé‚®ä»¶å‘Šè­¦è‡ªå®šä¹‰æ¨¡æ¿çš„è§¦å‘æ—¶é—´ä¸ºutcçš„è§£å†³æ–¹æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>prometheus+grafana+alertmanagerç›‘æ§k8sæ— å‘ç‰ˆ</title>
      <link href="posts/34136.html"/>
      <url>posts/34136.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="prometheus-grafana-alertmanagerç›‘æ§k8sæ— å‘ç‰ˆ"><a href="#prometheus-grafana-alertmanagerç›‘æ§k8sæ— å‘ç‰ˆ" class="headerlink" title="prometheus+grafana+alertmanagerç›‘æ§k8sæ— å‘ç‰ˆ"></a>prometheus+grafana+alertmanagerç›‘æ§k8sæ— å‘ç‰ˆ</h1><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>k8sæ­å»ºå®Œæˆå¹¶æ­£å¸¸ä½¿ç”¨çš„åŸºç¡€ä¸Šï¼Œéœ€è¦æœ‰ä¸€ä¸ªåŠ¨æ€å­˜å‚¨<br>æˆ‘çš„ç¯å¢ƒï¼š<br>k8sç‰ˆæœ¬    | Kubeadméƒ¨ç½² v1.18.0<br>â€”â€”â€“ | â€”â€“<br>k8s-master  | 172.22.254.57<br>k8s-node1  | 172.22.254.62<br>k8s-node2  | 172.22.254.63(nfsæœåŠ¡ç«¯)<br>StorageClass | nfs-storage</p><p>k8s-masteræœ‰æ±¡ç‚¹ï¼Œå¦‚æœéœ€è¦ç›‘æ§åˆ°masterï¼Œå»é™¤æ±¡ç‚¹å³å¯ï¼ˆéå¿…è¦ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes node1 key1&#x3D;value1:NoSchedule-</span><br></pre></td></tr></table></figure><p>prometheus-rulesä¸­çš„è§„åˆ™å­—æ®µå¯èƒ½éšç€ç‰ˆæœ¬æ›´æ–°å‡ºç°å˜åŒ–ï¼Œå¦‚æœ‰å˜åŒ–å¯ä»¥é€šçŸ¥æˆ‘ï¼Œæˆ‘å®æ—¶æ›´æ–°æ–‡æ¡£ã€‚ç›®å‰è§„åˆ™å†…çš„å­—æ®µåœ¨æ­¤ç‰ˆæœ¬æˆ‘å·²æ›´æ–°è¿‡ã€‚æ”¾å¿ƒä½¿ç”¨</p><p>è¿˜æœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼šprmetheusè·Ÿalertmanagerçš„configmapæ˜¯æ”¯æŒçƒ­æ›´æ–°çš„ã€‚å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æ¥çƒ­æ›´æ–°ï¼Œå¯èƒ½æ‰§è¡Œåˆ·æ–°çš„æ—¶å€™ä¼šæœ‰ç‚¹å„¿ä¹…ï¼Œç­‰ä¸€ä¸‹å°±å¥½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http:&#x2F;&#x2F;ClusterIP:PORT&#x2F;-&#x2F;reload</span><br></pre></td></tr></table></figure><p>èµ„æºä¸‹è½½ï¼š<a href="https://github.com/alexclownfish/k8s-monitor">https://github.com/alexclownfish/k8s-monitor</a></p><h2 id="éƒ¨ç½²æ­£æ–‡"><a href="#éƒ¨ç½²æ­£æ–‡" class="headerlink" title="éƒ¨ç½²æ­£æ–‡"></a>éƒ¨ç½²æ­£æ–‡</h2><h3 id="åˆ›å»ºopså‘½åç©ºé—´"><a href="#åˆ›å»ºopså‘½åç©ºé—´" class="headerlink" title="åˆ›å»ºopså‘½åç©ºé—´"></a>åˆ›å»ºopså‘½åç©ºé—´</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create ns ops</span><br></pre></td></tr></table></figure><h3 id="prometheus-yamlæ–‡ä»¶"><a href="#prometheus-yamlæ–‡ä»¶" class="headerlink" title="prometheus yamlæ–‡ä»¶"></a>prometheus yamlæ–‡ä»¶</h3><h4 id="prometheusé…ç½®æ–‡ä»¶-prometheus-configmap-yaml"><a href="#prometheusé…ç½®æ–‡ä»¶-prometheus-configmap-yaml" class="headerlink" title="prometheusé…ç½®æ–‡ä»¶ prometheus-configmap.yaml"></a>prometheusé…ç½®æ–‡ä»¶ prometheus-configmap.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus-config</span><br><span class="line">  namespace: ops </span><br><span class="line">data:</span><br><span class="line">  prometheus.yml: |</span><br><span class="line">    rule_files:</span><br><span class="line">    - &#x2F;etc&#x2F;config&#x2F;rules&#x2F;*.rules</span><br><span class="line"></span><br><span class="line">    scrape_configs:</span><br><span class="line">    - job_name: prometheus</span><br><span class="line">      static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - localhost:9090</span><br><span class="line"></span><br><span class="line">    - job_name: kubernetes-apiservers</span><br><span class="line">      kubernetes_sd_configs:</span><br><span class="line">      - role: endpoints</span><br><span class="line">      relabel_configs:</span><br><span class="line">      - action: keep</span><br><span class="line">        regex: default;kubernetes;https</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_namespace</span><br><span class="line">        - __meta_kubernetes_service_name</span><br><span class="line">        - __meta_kubernetes_endpoint_port_name</span><br><span class="line">      scheme: https</span><br><span class="line">      tls_config:</span><br><span class="line">        ca_file: &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;ca.crt</span><br><span class="line">        insecure_skip_verify: true</span><br><span class="line">      bearer_token_file: &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;token</span><br><span class="line"> </span><br><span class="line">    - job_name: kubernetes-nodes-kubelet</span><br><span class="line">      kubernetes_sd_configs:</span><br><span class="line">      - role: node  # å‘ç°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹</span><br><span class="line">      relabel_configs:</span><br><span class="line">      # å°†æ ‡ç­¾(.*)ä½œä¸ºæ–°æ ‡ç­¾åï¼ŒåŸæœ‰å€¼ä¸å˜</span><br><span class="line">      - action: labelmap</span><br><span class="line">        regex: __meta_kubernetes_node_label_(.+)</span><br><span class="line">      scheme: https</span><br><span class="line">      tls_config:</span><br><span class="line">        ca_file: &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;ca.crt</span><br><span class="line">        insecure_skip_verify: true</span><br><span class="line">      bearer_token_file: &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;token</span><br><span class="line"></span><br><span class="line">    - job_name: kubernetes-nodes-cadvisor</span><br><span class="line">      kubernetes_sd_configs:</span><br><span class="line">      - role: node</span><br><span class="line">      relabel_configs:</span><br><span class="line">      # å°†æ ‡ç­¾(.*)ä½œä¸ºæ–°æ ‡ç­¾åï¼ŒåŸæœ‰å€¼ä¸å˜</span><br><span class="line">      - action: labelmap</span><br><span class="line">        regex: __meta_kubernetes_node_label_(.+)</span><br><span class="line">      # å®é™…è®¿é—®æŒ‡æ ‡æ¥å£ https:&#x2F;&#x2F;NodeIP:10250&#x2F;metrics&#x2F;cadvisorï¼Œè¿™é‡Œæ›¿æ¢é»˜è®¤æŒ‡æ ‡URLè·¯å¾„</span><br><span class="line">      - target_label: __metrics_path__</span><br><span class="line">        replacement: &#x2F;metrics&#x2F;cadvisor</span><br><span class="line">      scheme: https</span><br><span class="line">      tls_config:</span><br><span class="line">        ca_file: &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;ca.crt</span><br><span class="line">        insecure_skip_verify: true</span><br><span class="line">      bearer_token_file: &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;token</span><br><span class="line"></span><br><span class="line">    - job_name: kubernetes-service-endpoints</span><br><span class="line">      kubernetes_sd_configs:</span><br><span class="line">      - role: endpoints  # ä»Serviceåˆ—è¡¨ä¸­çš„Endpointå‘ç°Podä¸ºç›®æ ‡</span><br><span class="line">      relabel_configs:</span><br><span class="line">      # Serviceæ²¡é…ç½®æ³¨è§£prometheus.io&#x2F;scrapeçš„ä¸é‡‡é›†</span><br><span class="line">      - action: keep</span><br><span class="line">        regex: true</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_service_annotation_prometheus_io_scrape</span><br><span class="line">      # é‡å‘½åé‡‡é›†ç›®æ ‡åè®®</span><br><span class="line">      - action: replace</span><br><span class="line">        regex: (https?)</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_service_annotation_prometheus_io_scheme</span><br><span class="line">        target_label: __scheme__</span><br><span class="line">      # é‡å‘½åé‡‡é›†ç›®æ ‡æŒ‡æ ‡URLè·¯å¾„</span><br><span class="line">      - action: replace</span><br><span class="line">        regex: (.+)</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_service_annotation_prometheus_io_path</span><br><span class="line">        target_label: __metrics_path__</span><br><span class="line">      # é‡å‘½åé‡‡é›†ç›®æ ‡åœ°å€</span><br><span class="line">      - action: replace</span><br><span class="line">        regex: ([^:]+)(?::\d+)?;(\d+)</span><br><span class="line">        replacement: $1:$2</span><br><span class="line">        source_labels:</span><br><span class="line">        - __address__</span><br><span class="line">        - __meta_kubernetes_service_annotation_prometheus_io_port</span><br><span class="line">        target_label: __address__</span><br><span class="line">      # å°†K8sæ ‡ç­¾(.*)ä½œä¸ºæ–°æ ‡ç­¾åï¼ŒåŸæœ‰å€¼ä¸å˜</span><br><span class="line">      - action: labelmap</span><br><span class="line">        regex: __meta_kubernetes_service_label_(.+)</span><br><span class="line">      # ç”Ÿæˆå‘½åç©ºé—´æ ‡ç­¾</span><br><span class="line">      - action: replace</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_namespace</span><br><span class="line">        target_label: kubernetes_namespace</span><br><span class="line">      # ç”ŸæˆServiceåç§°æ ‡ç­¾</span><br><span class="line">      - action: replace</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_service_name</span><br><span class="line">        target_label: kubernetes_name</span><br><span class="line"></span><br><span class="line">    - job_name: kubernetes-pods</span><br><span class="line">      kubernetes_sd_configs:</span><br><span class="line">      - role: pod   # å‘ç°æ‰€æœ‰Podä¸ºç›®æ ‡</span><br><span class="line">      # é‡å‘½åé‡‡é›†ç›®æ ‡åè®®</span><br><span class="line">      relabel_configs:</span><br><span class="line">      - action: keep</span><br><span class="line">        regex: true</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_pod_annotation_prometheus_io_scrape</span><br><span class="line">      # é‡å‘½åé‡‡é›†ç›®æ ‡æŒ‡æ ‡URLè·¯å¾„</span><br><span class="line">      - action: replace</span><br><span class="line">        regex: (.+)</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_pod_annotation_prometheus_io_path</span><br><span class="line">        target_label: __metrics_path__</span><br><span class="line">      # é‡å‘½åé‡‡é›†ç›®æ ‡åœ°å€</span><br><span class="line">      - action: replace</span><br><span class="line">        regex: ([^:]+)(?::\d+)?;(\d+)</span><br><span class="line">        replacement: $1:$2</span><br><span class="line">        source_labels:</span><br><span class="line">        - __address__</span><br><span class="line">        - __meta_kubernetes_pod_annotation_prometheus_io_port</span><br><span class="line">        target_label: __address__</span><br><span class="line">      # å°†K8sæ ‡ç­¾(.*)ä½œä¸ºæ–°æ ‡ç­¾åï¼ŒåŸæœ‰å€¼ä¸å˜</span><br><span class="line">      - action: labelmap</span><br><span class="line">        regex: __meta_kubernetes_pod_label_(.+)</span><br><span class="line">      # ç”Ÿæˆå‘½åç©ºé—´æ ‡ç­¾</span><br><span class="line">      - action: replace</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_namespace</span><br><span class="line">        target_label: kubernetes_namespace</span><br><span class="line">      # ç”ŸæˆServiceåç§°æ ‡ç­¾</span><br><span class="line">      - action: replace</span><br><span class="line">        source_labels:</span><br><span class="line">        - __meta_kubernetes_pod_name</span><br><span class="line">        target_label: kubernetes_pod_name</span><br><span class="line"></span><br><span class="line">    alerting:</span><br><span class="line">      alertmanagers:</span><br><span class="line">      - static_configs:</span><br><span class="line">          - targets: [&quot;alertmanager:80&quot;]</span><br></pre></td></tr></table></figure><h4 id="kube-state-metrics-é‡‡é›†äº†k8sä¸­å„ç§èµ„æºå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯-kube-state-metrics-yaml"><a href="#kube-state-metrics-é‡‡é›†äº†k8sä¸­å„ç§èµ„æºå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯-kube-state-metrics-yaml" class="headerlink" title="kube-state-metrics é‡‡é›†äº†k8sä¸­å„ç§èµ„æºå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ kube-state-metrics.yaml"></a>kube-state-metrics é‡‡é›†äº†k8sä¸­å„ç§èµ„æºå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ kube-state-metrics.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1 </span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">  namespace: ops</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kube-state-metrics</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: kube-state-metrics</span><br><span class="line">      version: v1.3.0</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: kube-state-metrics</span><br><span class="line">        version: v1.3.0</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: kube-state-metrics</span><br><span class="line">      containers:</span><br><span class="line">      - name: kube-state-metrics</span><br><span class="line">        image: lizhenliang&#x2F;kube-state-metrics:v1.8.0 </span><br><span class="line">        ports:</span><br><span class="line">        - name: http-metrics</span><br><span class="line">          containerPort: 8080</span><br><span class="line">        - name: telemetry</span><br><span class="line">          containerPort: 8081</span><br><span class="line">        readinessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: &#x2F;healthz</span><br><span class="line">            port: 8080</span><br><span class="line">          initialDelaySeconds: 5</span><br><span class="line">          timeoutSeconds: 5</span><br><span class="line">      - name: addon-resizer</span><br><span class="line">        image: lizhenliang&#x2F;addon-resizer:1.8.6</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 30Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 30Mi</span><br><span class="line">        env:</span><br><span class="line">          - name: MY_POD_NAME</span><br><span class="line">            valueFrom:</span><br><span class="line">              fieldRef:</span><br><span class="line">                fieldPath: metadata.name</span><br><span class="line">          - name: MY_POD_NAMESPACE</span><br><span class="line">            valueFrom:</span><br><span class="line">              fieldRef:</span><br><span class="line">                fieldPath: metadata.namespace</span><br><span class="line">        volumeMounts:</span><br><span class="line">          - name: config-volume</span><br><span class="line">            mountPath: &#x2F;etc&#x2F;config</span><br><span class="line">        command:</span><br><span class="line">          - &#x2F;pod_nanny</span><br><span class="line">          - --config-dir&#x3D;&#x2F;etc&#x2F;config</span><br><span class="line">          - --container&#x3D;kube-state-metrics</span><br><span class="line">          - --cpu&#x3D;100m</span><br><span class="line">          - --extra-cpu&#x3D;1m</span><br><span class="line">          - --memory&#x3D;100Mi</span><br><span class="line">          - --extra-memory&#x3D;2Mi</span><br><span class="line">          - --threshold&#x3D;5</span><br><span class="line">          - --deployment&#x3D;kube-state-metrics</span><br><span class="line">      volumes:</span><br><span class="line">        - name: config-volume</span><br><span class="line">          configMap:</span><br><span class="line">            name: kube-state-metrics-config</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics-config</span><br><span class="line">  namespace: ops</span><br><span class="line">data:</span><br><span class="line">  NannyConfiguration: |-</span><br><span class="line">    apiVersion: nannyconfig&#x2F;v1alpha1</span><br><span class="line">    kind: NannyConfiguration</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">  namespace: ops</span><br><span class="line">  annotations:</span><br><span class="line">    prometheus.io&#x2F;scrape: &#39;true&#39;</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: http-metrics</span><br><span class="line">    port: 8080</span><br><span class="line">    targetPort: http-metrics</span><br><span class="line">    protocol: TCP</span><br><span class="line">  - name: telemetry</span><br><span class="line">    port: 8081</span><br><span class="line">    targetPort: telemetry</span><br><span class="line">    protocol: TCP</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kube-state-metrics</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">  namespace: ops</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [&quot;&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - configmaps</span><br><span class="line">  - secrets</span><br><span class="line">  - nodes</span><br><span class="line">  - pods</span><br><span class="line">  - services</span><br><span class="line">  - resourcequotas</span><br><span class="line">  - replicationcontrollers</span><br><span class="line">  - limitranges</span><br><span class="line">  - persistentvolumeclaims</span><br><span class="line">  - persistentvolumes</span><br><span class="line">  - namespaces</span><br><span class="line">  - endpoints</span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line">- apiGroups: [&quot;apps&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - statefulsets</span><br><span class="line">  - daemonsets</span><br><span class="line">  - deployments</span><br><span class="line">  - replicasets</span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line">- apiGroups: [&quot;batch&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - cronjobs</span><br><span class="line">  - jobs</span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line">- apiGroups: [&quot;autoscaling&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - horizontalpodautoscalers</span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line">- apiGroups: [&quot;networking.k8s.io&quot;, &quot;extensions&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - ingresses </span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line">- apiGroups: [&quot;storage.k8s.io&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - storageclasses </span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line">- apiGroups: [&quot;certificates.k8s.io&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - certificatesigningrequests</span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line">- apiGroups: [&quot;policy&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - poddisruptionbudgets </span><br><span class="line">  verbs: [&quot;list&quot;, &quot;watch&quot;]</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics-resizer</span><br><span class="line">  namespace: ops</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [&quot;&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - pods</span><br><span class="line">  verbs: [&quot;get&quot;]</span><br><span class="line">- apiGroups: [&quot;extensions&quot;,&quot;apps&quot;]</span><br><span class="line">  resources:</span><br><span class="line">  - deployments</span><br><span class="line">  resourceNames: [&quot;kube-state-metrics&quot;]</span><br><span class="line">  verbs: [&quot;get&quot;, &quot;update&quot;]</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1 </span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">  namespace: ops</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">  namespace: ops</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Role</span><br><span class="line">  name: kube-state-metrics-resizer</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: kube-state-metrics</span><br><span class="line">  namespace: ops</span><br></pre></td></tr></table></figure><h4 id="prometheuséƒ¨ç½²æ–‡ä»¶-prometheus-deploy-yaml-æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨2-20"><a href="#prometheuséƒ¨ç½²æ–‡ä»¶-prometheus-deploy-yaml-æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨2-20" class="headerlink" title="prometheuséƒ¨ç½²æ–‡ä»¶  prometheus-deploy.yaml(æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨2.20)"></a>prometheuséƒ¨ç½²æ–‡ä»¶  prometheus-deploy.yaml(æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨2.20)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus </span><br><span class="line">  namespace: ops</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: prometheus</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: prometheus</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: prometheus</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: prometheus</span><br><span class="line">      initContainers:</span><br><span class="line">      - name: &quot;init-chown-data&quot;</span><br><span class="line">        image: &quot;busybox:latest&quot;</span><br><span class="line">        imagePullPolicy: &quot;IfNotPresent&quot;</span><br><span class="line">        command: [&quot;chown&quot;, &quot;-R&quot;, &quot;65534:65534&quot;, &quot;&#x2F;data&quot;]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: prometheus-data</span><br><span class="line">          mountPath: &#x2F;data</span><br><span class="line">          subPath: &quot;&quot;</span><br><span class="line">      containers:</span><br><span class="line">        - name: prometheus-server-configmap-reload</span><br><span class="line">          image: &quot;jimmidyson&#x2F;configmap-reload:v0.1&quot;</span><br><span class="line">          imagePullPolicy: &quot;IfNotPresent&quot;</span><br><span class="line">          args:</span><br><span class="line">            - --volume-dir&#x3D;&#x2F;etc&#x2F;config</span><br><span class="line">            - --webhook-url&#x3D;http:&#x2F;&#x2F;localhost:9090&#x2F;-&#x2F;reload</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: config-volume</span><br><span class="line">              mountPath: &#x2F;etc&#x2F;config</span><br><span class="line">              readOnly: true</span><br><span class="line">            - mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">              name: timezone</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 100Mi</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 100Mi</span><br><span class="line"></span><br><span class="line">        - name: prometheus-server</span><br><span class="line">          image: &quot;prom&#x2F;prometheus:v2.20.0&quot;</span><br><span class="line">          imagePullPolicy: &quot;IfNotPresent&quot;</span><br><span class="line">          args:</span><br><span class="line">            - --config.file&#x3D;&#x2F;etc&#x2F;config&#x2F;prometheus.yml</span><br><span class="line">            - --storage.tsdb.path&#x3D;&#x2F;data</span><br><span class="line">            - --web.console.libraries&#x3D;&#x2F;etc&#x2F;prometheus&#x2F;console_libraries</span><br><span class="line">            - --web.console.templates&#x3D;&#x2F;etc&#x2F;prometheus&#x2F;consoles</span><br><span class="line">            - --web.enable-lifecycle</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 9090</span><br><span class="line">          readinessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: &#x2F;-&#x2F;ready</span><br><span class="line">              port: 9090</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            timeoutSeconds: 30</span><br><span class="line">          livenessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: &#x2F;-&#x2F;healthy</span><br><span class="line">              port: 9090</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            timeoutSeconds: 30</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 500m</span><br><span class="line">              memory: 800Mi</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 200m</span><br><span class="line">              memory: 400Mi</span><br><span class="line">            </span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: config-volume</span><br><span class="line">              mountPath: &#x2F;etc&#x2F;config</span><br><span class="line">            - name: prometheus-data</span><br><span class="line">              mountPath: &#x2F;data</span><br><span class="line">              subPath: &quot;&quot;</span><br><span class="line">            - name: prometheus-rules</span><br><span class="line">              mountPath: &#x2F;etc&#x2F;config&#x2F;rules</span><br><span class="line">            - mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">              name: timezone  </span><br><span class="line">      volumes:</span><br><span class="line">        - name: config-volume</span><br><span class="line">          configMap:</span><br><span class="line">            name: prometheus-config</span><br><span class="line">        - name: prometheus-rules</span><br><span class="line">          configMap:</span><br><span class="line">            name: prometheus-rules</span><br><span class="line">        - name: prometheus-data</span><br><span class="line">          persistentVolumeClaim:</span><br><span class="line">            claimName: prometheus</span><br><span class="line">        - name: timezone</span><br><span class="line">          hostPath:</span><br><span class="line">            path: &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai</span><br><span class="line">                                                  </span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus</span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: &quot;nfs-storage&quot;</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 10Gi</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata: </span><br><span class="line">  name: prometheus</span><br><span class="line">  namespace: ops</span><br><span class="line">spec: </span><br><span class="line">  type: NodePort</span><br><span class="line">  ports: </span><br><span class="line">    - name: http </span><br><span class="line">      port: 9090</span><br><span class="line">      protocol: TCP</span><br><span class="line">      targetPort: 9090</span><br><span class="line">      nodePort: 30089</span><br><span class="line">  selector: </span><br><span class="line">    k8s-app: prometheus</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus</span><br><span class="line">  namespace: ops</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - nodes</span><br><span class="line">      - nodes&#x2F;metrics</span><br><span class="line">      - services</span><br><span class="line">      - endpoints</span><br><span class="line">      - pods</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">      - list</span><br><span class="line">      - watch</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - configmaps</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">  - nonResourceURLs:</span><br><span class="line">      - &quot;&#x2F;metrics&quot;</span><br><span class="line">    verbs:</span><br><span class="line">      - get</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: prometheus</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: prometheus</span><br><span class="line">  namespace: ops  </span><br></pre></td></tr></table></figure><h4 id="prometheusé…ç½®æŠ¥è­¦è§„åˆ™-prometheus-rules-yaml"><a href="#prometheusé…ç½®æŠ¥è­¦è§„åˆ™-prometheus-rules-yaml" class="headerlink" title="prometheusé…ç½®æŠ¥è­¦è§„åˆ™ prometheus-rules.yaml"></a>prometheusé…ç½®æŠ¥è­¦è§„åˆ™ prometheus-rules.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus-rules</span><br><span class="line">  namespace: ops</span><br><span class="line">data:</span><br><span class="line">  general.rules: |</span><br><span class="line">    groups:</span><br><span class="line">    - name: general.rules</span><br><span class="line">      rules:</span><br><span class="line">      - alert: InstanceDown</span><br><span class="line">        expr: up &#x3D;&#x3D; 0</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: error </span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;Instance &#123;&#123; $labels.instance &#125;&#125; åœæ­¢å·¥ä½œ&quot;</span><br><span class="line">          description: &quot;&#123;&#123; $labels.instance &#125;&#125; job &#123;&#123; $labels.job &#125;&#125; å·²ç»åœæ­¢5åˆ†é’Ÿä»¥ä¸Š.&quot;</span><br><span class="line">               </span><br><span class="line">  node.rules: |</span><br><span class="line">    groups:</span><br><span class="line">    - name: node.rules</span><br><span class="line">      rules:</span><br><span class="line">      - alert: NodeFilesystemUsage</span><br><span class="line">        expr: |</span><br><span class="line">          100 - (node_filesystem_free_bytes &#x2F; node_filesystem_size_bytes) * 100 &gt; 60</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning </span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;Instance &#123;&#123; $labels.instance &#125;&#125; : &#123;&#123; $labels.mountpoint &#125;&#125; åˆ†åŒºä½¿ç”¨ç‡è¿‡é«˜&quot;</span><br><span class="line">          description: &quot;&#123;&#123; $labels.instance &#125;&#125;: &#123;&#123; $labels.mountpoint &#125;&#125; åˆ†åŒºä½¿ç”¨å¤§äº60% (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: NodeMemoryUsage</span><br><span class="line">        expr: |</span><br><span class="line">          100 - (node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes) &#x2F; node_memory_MemTotal_bytes * 100 &gt; 60</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;Instance &#123;&#123; $labels.instance &#125;&#125; å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜&quot;</span><br><span class="line">          description: &quot;&#123;&#123; $labels.instance &#125;&#125;å†…å­˜ä½¿ç”¨å¤§äº60% (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: NodeCPUUsage    </span><br><span class="line">        expr: |</span><br><span class="line">          100 - (avg(irate(node_cpu_seconds_total&#123;mode&#x3D;&quot;idle&quot;&#125;[5m])) by (instance) * 100) &gt; 60 </span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;Instance &#123;&#123; $labels.instance &#125;&#125; CPUä½¿ç”¨ç‡è¿‡é«˜&quot;       </span><br><span class="line">          description: &quot;&#123;&#123; $labels.instance &#125;&#125;CPUä½¿ç”¨å¤§äº60% (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: KubeNodeNotReady</span><br><span class="line">        expr: |</span><br><span class="line">          kube_node_status_condition&#123;condition&#x3D;&quot;Ready&quot;,status&#x3D;&quot;true&quot;&#125; &#x3D;&#x3D; 0</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: error</span><br><span class="line">        annotations:</span><br><span class="line">          message: &#39;&#123;&#123; $labels.node &#125;&#125; å·²ç»æœ‰10å¤šåˆ†é’Ÿæ²¡æœ‰å‡†å¤‡å¥½äº†.&#39;</span><br><span class="line"></span><br><span class="line">  pod.rules: |</span><br><span class="line">    groups:</span><br><span class="line">    - name: pod.rules</span><br><span class="line">      rules:</span><br><span class="line">      - alert: PodCPUUsage</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(pod, namespace) (rate(container_cpu_usage_seconds_total&#123;image!&#x3D;&quot;&quot;&#125;[5m]) * 100) &gt; 5</span><br><span class="line">        for: 5m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning </span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125; CPUä½¿ç”¨å¤§äº80% (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodMemoryUsage</span><br><span class="line">        expr: |</span><br><span class="line">           sum(container_memory_rss&#123;image!&#x3D;&quot;&quot;&#125;) by(pod, namespace) &#x2F; sum(container_spec_memory_limit_bytes&#123;image!&#x3D;&quot;&quot;&#125;) by(pod, namespace) * 100 !&#x3D; +inf &gt; 80</span><br><span class="line">        for: 5m</span><br><span class="line">        labels:</span><br><span class="line">          severity: error </span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125; å†…å­˜ä½¿ç”¨å¤§äº80% (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodNetworkReceive</span><br><span class="line">        expr: |</span><br><span class="line">           sum(rate(container_network_receive_bytes_total&#123;image!&#x3D;&quot;&quot;,name&#x3D;~&quot;^k8s_.*&quot;&#125;[5m]) &#x2F;1000) by (pod,namespace) &gt; 30000</span><br><span class="line">        for: 5m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125; å…¥å£æµé‡å¤§äº30MB&#x2F;s (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;K&#x2F;s)&quot;           </span><br><span class="line"></span><br><span class="line">      - alert: PodNetworkTransmit</span><br><span class="line">        expr: | </span><br><span class="line">           sum(rate(container_network_transmit_bytes_total&#123;image!&#x3D;&quot;&quot;,name&#x3D;~&quot;^k8s_.*&quot;&#125;[5m]) &#x2F;1000) by (pod,namespace) &gt; 30000</span><br><span class="line">        for: 5m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning </span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125; å‡ºå£æµé‡å¤§äº30MB&#x2F;s (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;&#x2F;K&#x2F;s)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodRestart</span><br><span class="line">        expr: |</span><br><span class="line">           sum(changes(kube_pod_container_status_restarts_total[1m])) by (pod,namespace) &gt; 0</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning </span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125; Podé‡å¯ (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodFailed</span><br><span class="line">        expr: |</span><br><span class="line">           sum(kube_pod_status_phase&#123;phase&#x3D;&quot;Failed&quot;&#125;) by (pod,namespace) &gt; 0</span><br><span class="line">        for: 5s</span><br><span class="line">        labels:</span><br><span class="line">          severity: error </span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125; PodçŠ¶æ€Failed (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodPending</span><br><span class="line">        expr: | </span><br><span class="line">           sum(kube_pod_status_phase&#123;phase&#x3D;&quot;Pending&quot;&#125;) by (pod,namespace) &gt; 0</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: error</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125; PodçŠ¶æ€Pending (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodErrImagePull</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(namespace,pod) (kube_pod_container_status_waiting_reason&#123;reason&#x3D;&quot;ErrImagePull&quot;&#125;) &#x3D;&#x3D; 1</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125;  PodçŠ¶æ€ErrImagePull (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodImagePullBackOff</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(namespace,pod) (kube_pod_container_status_waiting_reason&#123;reason&#x3D;&quot;ImagePullBackOff&quot;&#125;) &#x3D;&#x3D; 1</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125;  PodçŠ¶æ€ImagePullBackOff (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodCrashLoopBackOff</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(namespace,pod) (kube_pod_container_status_waiting_reason&#123;reason&#x3D;&quot;CrashLoopBackOff&quot;&#125;) &#x3D;&#x3D; 1</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125;  PodçŠ¶æ€CrashLoopBackOff (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodInvalidImageName</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(namespace,pod) (kube_pod_container_status_waiting_reason&#123;reason&#x3D;&quot;InvalidImageName&quot;&#125;) &#x3D;&#x3D; 1</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125;  PodçŠ¶æ€InvalidImageName (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">      - alert: PodCreateContainerConfigError</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(namespace,pod) (kube_pod_container_status_waiting_reason&#123;reason&#x3D;&quot;CreateContainerConfigError&quot;&#125;) &#x3D;&#x3D; 1</span><br><span class="line">        for: 1m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;å‘½åç©ºé—´: &#123;&#123; $labels.namespace &#125;&#125; | Podåç§°: &#123;&#123; $labels.pod &#125;&#125;  PodçŠ¶æ€CreateContainerConfigError (å½“å‰å€¼: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">  volume.rules: |</span><br><span class="line">    groups:</span><br><span class="line">    - name: volume.rules</span><br><span class="line">      rules:</span><br><span class="line">      - alert: PersistentVolumeClaimLost</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(namespace, persistentvolumeclaim) (kube_persistentvolumeclaim_status_phase&#123;phase&#x3D;&quot;Lost&quot;&#125;) &#x3D;&#x3D; 1</span><br><span class="line">        for: 2m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;PersistentVolumeClaim &#123;&#123; $labels.namespace &#125;&#125;&#x2F;&#123;&#123; $labels.persistentvolumeclaim &#125;&#125; is lost\n  VALUE &#x3D; &#123;&#123; $value &#125;&#125;\n  LABELS &#x3D; &#123;&#123; $labels &#125;&#125;&quot;</span><br><span class="line">      - alert: PersistentVolumeClaimPendig</span><br><span class="line">        expr: |</span><br><span class="line">           sum by(namespace, persistentvolumeclaim) (kube_persistentvolumeclaim_status_phase&#123;phase&#x3D;&quot;Pendig&quot;&#125;) &#x3D;&#x3D; 1</span><br><span class="line">        for: 2m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;PersistentVolumeClaim &#123;&#123; $labels.namespace &#125;&#125;&#x2F;&#123;&#123; $labels.persistentvolumeclaim &#125;&#125; is pendig\n  VALUE &#x3D; &#123;&#123; $value &#125;&#125;\n  LABELS &#x3D; &#123;&#123; $labels &#125;&#125;&quot;</span><br><span class="line">      - alert: PersistentVolume Failed</span><br><span class="line">        expr: |</span><br><span class="line">           sum(kube_persistentvolume_status_phase&#123;phase&#x3D;&quot;Failed&quot;,job&#x3D;&quot;kubernetes-service-endpoints&quot;&#125;) by (persistentvolume) &#x3D;&#x3D; 1</span><br><span class="line">        for: 2m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;Persistent volume is failed state\n  VALUE &#x3D; &#123;&#123; $value &#125;&#125;\n  LABELS &#x3D; &#123;&#123; $labels &#125;&#125;&quot;</span><br><span class="line">      - alert: PersistentVolume Pending</span><br><span class="line">        expr: |</span><br><span class="line">           sum(kube_persistentvolume_status_phase&#123;phase&#x3D;&quot;Pending&quot;,job&#x3D;&quot;kubernetes-service-endpoints&quot;&#125;) by (persistentvolume) &#x3D;&#x3D; 1</span><br><span class="line">        for: 2m</span><br><span class="line">        labels:</span><br><span class="line">          severity: warning</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;Persistent volume is pending state\n  VALUE &#x3D; &#123;&#123; $value &#125;&#125;\n  LABELS &#x3D; &#123;&#123; $labels &#125;&#125;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="node-exporteré…ç½®node-exporter-yaml-æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨1-0-1"><a href="#node-exporteré…ç½®node-exporter-yaml-æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨1-0-1" class="headerlink" title="node-exporteré…ç½®node-exporter.yaml(æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨1.0.1)"></a>node-exporteré…ç½®node-exporter.yaml(æ³¨æ„ç‰ˆæœ¬éœ€è¦ç”¨1.0.1)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1 </span><br><span class="line">kind: DaemonSet</span><br><span class="line">metadata:</span><br><span class="line">  name: node-exporter </span><br><span class="line">  namespace: ops </span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: node-exporter </span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: node-exporter</span><br><span class="line">      version: v1.0.1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: node-exporter </span><br><span class="line">        version: v1.0.1</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: prometheus-node-exporter</span><br><span class="line">          image: &quot;prom&#x2F;node-exporter:v1.0.1&quot;</span><br><span class="line">          #imagePullPolicy: &quot;Always&quot;</span><br><span class="line">          args:</span><br><span class="line">            - --path.procfs&#x3D;&#x2F;host&#x2F;proc</span><br><span class="line">            - --path.sysfs&#x3D;&#x2F;host&#x2F;sys</span><br><span class="line">          ports:</span><br><span class="line">            - name: metrics</span><br><span class="line">              containerPort: 9100</span><br><span class="line">              hostPort: 9100</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: proc</span><br><span class="line">              mountPath: &#x2F;host&#x2F;proc</span><br><span class="line">              readOnly:  true</span><br><span class="line">            - name: sys</span><br><span class="line">              mountPath: &#x2F;host&#x2F;sys</span><br><span class="line">              readOnly: true</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 50Mi</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 50Mi</span><br><span class="line">      hostNetwork: true</span><br><span class="line">      hostPID: true</span><br><span class="line">      hostIPC: true</span><br><span class="line">      volumes:</span><br><span class="line">        - name: proc</span><br><span class="line">          hostPath:</span><br><span class="line">            path: &#x2F;proc</span><br><span class="line">        - name: sys</span><br><span class="line">          hostPath:</span><br><span class="line">            path: &#x2F;sys</span><br><span class="line">        - name: rootfs</span><br><span class="line">          hostPath:</span><br><span class="line">            path: &#x2F;</span><br><span class="line">        - name: dev</span><br><span class="line">          hostPath:</span><br><span class="line">            path: &#x2F;dev</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: node-exporter</span><br><span class="line">  namespace: ops</span><br><span class="line">  annotations:</span><br><span class="line">    prometheus.io&#x2F;scrape: &quot;true&quot;</span><br><span class="line">spec:</span><br><span class="line">  clusterIP: None</span><br><span class="line">  ports:</span><br><span class="line">    - name: metrics</span><br><span class="line">      port: 9100</span><br><span class="line">      protocol: TCP</span><br><span class="line">      targetPort: 9100</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: node-exporter</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="alertmanager-yamlæ–‡ä»¶"><a href="#alertmanager-yamlæ–‡ä»¶" class="headerlink" title="alertmanager yamlæ–‡ä»¶"></a>alertmanager yamlæ–‡ä»¶</h3><h4 id="alertmanageré…ç½®æ–‡ä»¶alertmanger-configmap-yaml"><a href="#alertmanageré…ç½®æ–‡ä»¶alertmanger-configmap-yaml" class="headerlink" title="alertmanageré…ç½®æ–‡ä»¶alertmanger-configmap.yaml"></a>alertmanageré…ç½®æ–‡ä»¶alertmanger-configmap.yaml</h4><p>æ³¨:é‚®ç®±éœ€è¦è‡ªå·±å»ç½‘æ˜“é‚®ç®±ç”³è¯·å¹¶ä¸”å–å¾—æˆæƒç®¡ç†å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: alertmanager-config</span><br><span class="line">  namespace: ops</span><br><span class="line">data:</span><br><span class="line">  alertmanager.yml: |-</span><br><span class="line">    global:</span><br><span class="line">      # åœ¨æ²¡æœ‰æŠ¥è­¦çš„æƒ…å†µä¸‹å£°æ˜ä¸ºå·²è§£å†³çš„æ—¶é—´</span><br><span class="line">      resolve_timeout: 5m</span><br><span class="line">      # é…ç½®é‚®ä»¶å‘é€ä¿¡æ¯</span><br><span class="line">      smtp_smarthost: &#39;smtp.163.com:465&#39;</span><br><span class="line">      smtp_from: &#39;xxx@163.com&#39;</span><br><span class="line">      smtp_auth_username: &#39;xxx@163.com&#39;</span><br><span class="line">      smtp_auth_password: &#39;xxxxxx&#39;</span><br><span class="line">      smtp_hello: &#39;163.com&#39;</span><br><span class="line">      smtp_require_tls: false</span><br><span class="line">    # æ‰€æœ‰æŠ¥è­¦ä¿¡æ¯è¿›å…¥åçš„æ ¹è·¯ç”±ï¼Œç”¨æ¥è®¾ç½®æŠ¥è­¦çš„åˆ†å‘ç­–ç•¥</span><br><span class="line">    route:</span><br><span class="line">      # è¿™é‡Œçš„æ ‡ç­¾åˆ—è¡¨æ˜¯æ¥æ”¶åˆ°æŠ¥è­¦ä¿¡æ¯åçš„é‡æ–°åˆ†ç»„æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼Œæ¥æ”¶åˆ°çš„æŠ¥è­¦ä¿¡æ¯é‡Œé¢æœ‰è®¸å¤šå…·æœ‰ cluster&#x3D;A å’Œ alertname&#x3D;LatncyHigh è¿™æ ·çš„æ ‡ç­¾çš„æŠ¥è­¦ä¿¡æ¯å°†ä¼šæ‰¹é‡è¢«èšåˆåˆ°ä¸€ä¸ªåˆ†ç»„é‡Œé¢</span><br><span class="line">      group_by: [&#39;alertname&#39;, &#39;cluster&#39;]</span><br><span class="line">      # å½“ä¸€ä¸ªæ–°çš„æŠ¥è­¦åˆ†ç»„è¢«åˆ›å»ºåï¼Œéœ€è¦ç­‰å¾…è‡³å°‘group_waitæ—¶é—´æ¥åˆå§‹åŒ–é€šçŸ¥ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿æ‚¨èƒ½æœ‰è¶³å¤Ÿçš„æ—¶é—´ä¸ºåŒä¸€åˆ†ç»„æ¥è·å–å¤šä¸ªè­¦æŠ¥ï¼Œç„¶åä¸€èµ·è§¦å‘è¿™ä¸ªæŠ¥è­¦ä¿¡æ¯ã€‚</span><br><span class="line">      group_wait: 30s</span><br><span class="line"> </span><br><span class="line">      # å½“ç¬¬ä¸€ä¸ªæŠ¥è­¦å‘é€åï¼Œç­‰å¾…&#39;group_interval&#39;æ—¶é—´æ¥å‘é€æ–°çš„ä¸€ç»„æŠ¥è­¦ä¿¡æ¯ã€‚</span><br><span class="line">      group_interval: 5m</span><br><span class="line"> </span><br><span class="line">      # å¦‚æœä¸€ä¸ªæŠ¥è­¦ä¿¡æ¯å·²ç»å‘é€æˆåŠŸäº†ï¼Œç­‰å¾…&#39;repeat_interval&#39;æ—¶é—´æ¥é‡æ–°å‘é€ä»–ä»¬</span><br><span class="line">      repeat_interval: 5m</span><br><span class="line"> </span><br><span class="line">      # é»˜è®¤çš„receiverï¼šå¦‚æœä¸€ä¸ªæŠ¥è­¦æ²¡æœ‰è¢«ä¸€ä¸ªrouteåŒ¹é…ï¼Œåˆ™å‘é€ç»™é»˜è®¤çš„æ¥æ”¶å™¨</span><br><span class="line">      receiver: default</span><br><span class="line"> </span><br><span class="line">      # ä¸Šé¢æ‰€æœ‰çš„å±æ€§éƒ½ç”±æ‰€æœ‰å­è·¯ç”±ç»§æ‰¿ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¯ä¸ªå­è·¯ç”±ä¸Šè¿›è¡Œè¦†ç›–ã€‚</span><br><span class="line">      routes:</span><br><span class="line">      - receiver: email</span><br><span class="line">        group_wait: 10s</span><br><span class="line">        match:</span><br><span class="line">          team: node</span><br><span class="line">    templates:</span><br><span class="line">      - &#39;&#x2F;etc&#x2F;config&#x2F;template&#x2F;email.tmpl&#39;</span><br><span class="line">    receivers:</span><br><span class="line">    - name: &#39;default&#39;</span><br><span class="line">      email_configs:</span><br><span class="line">      - to: &#39;xxxx@qq.com&#39;</span><br><span class="line">        html: &#39;&#123;&#123; template &quot;email.html&quot; . &#125;&#125;&#39;</span><br><span class="line">        headers: &#123; Subject: &quot;[WARN] Prometheus å‘Šè­¦é‚®ä»¶&quot; &#125;</span><br><span class="line">        #send_resolved: true</span><br><span class="line">    - name: &#39;email&#39;</span><br><span class="line">      email_configs:</span><br><span class="line">      - to: &#39;xxxx@gmail.com&#39;</span><br><span class="line">        send_resolved: true</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="alertmanager-templateæ–‡ä»¶alertmanager-template-yaml"><a href="#alertmanager-templateæ–‡ä»¶alertmanager-template-yaml" class="headerlink" title="alertmanager templateæ–‡ä»¶alertmanager-template.yaml"></a>alertmanager templateæ–‡ä»¶alertmanager-template.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#è‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: alertmanager-template-volume</span><br><span class="line">  namespace: ops</span><br><span class="line">data:</span><br><span class="line">  email.tmpl: |</span><br><span class="line">    &#123;&#123; define &quot;email.html&quot; &#125;&#125;</span><br><span class="line">        &#123;&#123; range .Alerts &#125;&#125;</span><br><span class="line">    &lt;pre&gt;</span><br><span class="line">        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">       å‘Šè­¦ç¨‹åº: prometheus_alert_email </span><br><span class="line">       å‘Šè­¦çº§åˆ«: &#123;&#123; .Labels.severity &#125;&#125; çº§åˆ« </span><br><span class="line">       å‘Šè­¦ç±»å‹: &#123;&#123; .Labels.alertname &#125;&#125; </span><br><span class="line">       æ•…éšœä¸»æœº: &#123;&#123; .Labels.instance &#125;&#125; </span><br><span class="line">       å‘Šè­¦ä¸»é¢˜: &#123;&#123; .Annotations.summary &#125;&#125;</span><br><span class="line">       å‘Šè­¦è¯¦æƒ…: &#123;&#123; .Annotations.description &#125;&#125;</span><br><span class="line">       å¤„ç†æ–¹æ³•: &#123;&#123; .Annotations.console &#125;&#125;</span><br><span class="line">       è§¦å‘æ—¶é—´: &#123;&#123; .StartsAt.Format &quot;2006-01-02 15:04:05&quot; &#125;&#125;</span><br><span class="line">       &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;end&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">    &lt;&#x2F;pre&gt;</span><br><span class="line">        &#123;&#123; end &#125;&#125;</span><br><span class="line">    &#123;&#123; end &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="alertmanageréƒ¨ç½²æ–‡ä»¶alertmanager-deployment-yaml"><a href="#alertmanageréƒ¨ç½²æ–‡ä»¶alertmanager-deployment-yaml" class="headerlink" title="alertmanageréƒ¨ç½²æ–‡ä»¶alertmanager-deployment.yaml"></a>alertmanageréƒ¨ç½²æ–‡ä»¶alertmanager-deployment.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: alertmanager</span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: alertmanager</span><br><span class="line">      version: v0.14.0</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: alertmanager</span><br><span class="line">        version: v0.14.0</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: prometheus-alertmanager</span><br><span class="line">          image: &quot;prom&#x2F;alertmanager:v0.14.0&quot;</span><br><span class="line">          imagePullPolicy: &quot;IfNotPresent&quot;</span><br><span class="line">          args:</span><br><span class="line">            - --config.file&#x3D;&#x2F;etc&#x2F;config&#x2F;alertmanager.yml</span><br><span class="line">            - --storage.path&#x3D;&#x2F;data</span><br><span class="line">            - --web.external-url&#x3D;&#x2F;</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 9093</span><br><span class="line">          readinessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: &#x2F;#&#x2F;status</span><br><span class="line">              port: 9093</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            timeoutSeconds: 30</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: config-volume</span><br><span class="line">              mountPath: &#x2F;etc&#x2F;config</span><br><span class="line">#è‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿</span><br><span class="line">            - name: config-template-volume</span><br><span class="line">              mountPath: &#x2F;etc&#x2F;config&#x2F;template</span><br><span class="line">            - name: storage-volume</span><br><span class="line">              mountPath: &quot;&#x2F;data&quot;</span><br><span class="line">              subPath: &quot;&quot;</span><br><span class="line">            - mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">              name: timezone</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 200Mi</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 100Mi</span><br><span class="line">        - name: prometheus-alertmanager-configmap-reload</span><br><span class="line">          image: &quot;jimmidyson&#x2F;configmap-reload:v0.1&quot;</span><br><span class="line">          imagePullPolicy: &quot;IfNotPresent&quot;</span><br><span class="line">          args:</span><br><span class="line">            - --volume-dir&#x3D;&#x2F;etc&#x2F;config</span><br><span class="line">            - --webhook-url&#x3D;http:&#x2F;&#x2F;localhost:9093&#x2F;-&#x2F;reload</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: config-volume</span><br><span class="line">              mountPath: &#x2F;etc&#x2F;config</span><br><span class="line">              readOnly: true</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 200Mi</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 10m</span><br><span class="line">              memory: 100Mi</span><br><span class="line">      volumes:</span><br><span class="line">        - name: config-volume</span><br><span class="line">          configMap:</span><br><span class="line">            name: alertmanager-config</span><br><span class="line">        - name: config-template-volume</span><br><span class="line">          configMap:</span><br><span class="line">            name: alertmanager-template-volume</span><br><span class="line">        - name: storage-volume</span><br><span class="line">          persistentVolumeClaim:</span><br><span class="line">            claimName: alertmanager</span><br><span class="line">        - name: timezone</span><br><span class="line">          hostPath:</span><br><span class="line">            path: &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: alertmanager</span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: nfs-storage</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: &quot;2Gi&quot;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: alertmanager</span><br><span class="line">  namespace: ops</span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io&#x2F;cluster-service: &quot;true&quot;</span><br><span class="line">    addonmanager.kubernetes.io&#x2F;mode: Reconcile</span><br><span class="line">    kubernetes.io&#x2F;name: &quot;Alertmanager&quot;</span><br><span class="line">spec:</span><br><span class="line">  type: &quot;NodePort&quot;</span><br><span class="line">  ports:</span><br><span class="line">    - name: http</span><br><span class="line">      port: 80</span><br><span class="line">      protocol: TCP</span><br><span class="line">      targetPort: 9093</span><br><span class="line">      nodePort: 30093</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: alertmanager</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="grafana-yamlæ–‡ä»¶"><a href="#grafana-yamlæ–‡ä»¶" class="headerlink" title="grafana yamlæ–‡ä»¶"></a>grafana yamlæ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment </span><br><span class="line">metadata:</span><br><span class="line">  name: grafana</span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: grafana</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: grafana</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: grafana</span><br><span class="line">        image: grafana&#x2F;grafana:7.1.0</span><br><span class="line">        ports:</span><br><span class="line">          - containerPort: 3000</span><br><span class="line">            protocol: TCP</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            cpu: 100m            </span><br><span class="line">            memory: 256Mi          </span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m            </span><br><span class="line">            memory: 256Mi</span><br><span class="line">        volumeMounts:</span><br><span class="line">          - name: grafana-data</span><br><span class="line">            mountPath: &#x2F;var&#x2F;lib&#x2F;grafana</span><br><span class="line">            subPath: grafana</span><br><span class="line">          - mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">            name: timezone</span><br><span class="line">      securityContext:</span><br><span class="line">        fsGroup: 472</span><br><span class="line">        runAsUser: 472</span><br><span class="line">      volumes:</span><br><span class="line">      - name: grafana-data</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          claimName: grafana</span><br><span class="line">      - name: timezone</span><br><span class="line">        hostPath:</span><br><span class="line">          path: &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai </span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: grafana </span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: &quot;nfs-storage&quot;</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 5Gi</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: grafana</span><br><span class="line">  namespace: ops</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port : 80</span><br><span class="line">    targetPort: 3000</span><br><span class="line">    nodePort: 30030</span><br><span class="line">  selector:</span><br><span class="line">    app: grafana</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²åˆ°k8sä¸­"><a href="#éƒ¨ç½²åˆ°k8sä¸­" class="headerlink" title="éƒ¨ç½²åˆ°k8sä¸­"></a>éƒ¨ç½²åˆ°k8sä¸­</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f .</span><br></pre></td></tr></table></figure><h2 id="grafanaæ•°æ®æºå’Œç›‘æ§"><a href="#grafanaæ•°æ®æºå’Œç›‘æ§" class="headerlink" title="grafanaæ•°æ®æºå’Œç›‘æ§"></a>grafanaæ•°æ®æºå’Œç›‘æ§</h2><h3 id="grafanaæ·»åŠ æ•°æ®æº"><a href="#grafanaæ·»åŠ æ•°æ®æº" class="headerlink" title="grafanaæ·»åŠ æ•°æ®æº"></a>grafanaæ·»åŠ æ•°æ®æº</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/2e2b52257bf58eb3de3800b73bf1b33a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç‚¹å‡»datasource - add datasource<br><img src="https://img-blog.csdnimg.cn/img_convert/f4a6d0482662d940b54f5345ff5719b6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹åç‚¹å‡»save&amp;test,æ·»åŠ æ•°æ®æºç»“æŸ</p><h3 id="importå¯¼å…¥æ¨¡æ¿"><a href="#importå¯¼å…¥æ¨¡æ¿" class="headerlink" title="importå¯¼å…¥æ¨¡æ¿"></a>importå¯¼å…¥æ¨¡æ¿</h3><p>æ¨¡æ¿ä¸‹è½½ï¼š<a href="https://github.com/alexclownfish/k8s-monitor/tree/main/grafana_template">https://github.com/alexclownfish/k8s-monitor/tree/main/grafana_template</a><br><img src="https://img-blog.csdnimg.cn/img_convert/0da7161b13ec62e8a64bb700885473fc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/img_convert/6dc324132e15af124c96a6cb10632f20.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="ä¿®æ”¹prometheus-ruleséªŒè¯ç›‘æ§è§¦å‘æŠ¥è­¦å¹¶å‘é€é‚®ä»¶"><a href="#ä¿®æ”¹prometheus-ruleséªŒè¯ç›‘æ§è§¦å‘æŠ¥è­¦å¹¶å‘é€é‚®ä»¶" class="headerlink" title="ä¿®æ”¹prometheus ruleséªŒè¯ç›‘æ§è§¦å‘æŠ¥è­¦å¹¶å‘é€é‚®ä»¶"></a>ä¿®æ”¹prometheus ruleséªŒè¯ç›‘æ§è§¦å‘æŠ¥è­¦å¹¶å‘é€é‚®ä»¶</h3><p>ä¿®æ”¹prometheus-rules.yaml<br><img src="https://img-blog.csdnimg.cn/img_convert/68786c7f9abf4518c5cf910056074369.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#çƒ­æ›´æ–°configmap</span><br><span class="line">kubectl apply -f prometheus-rules.yaml</span><br><span class="line">curl -X POST http:&#x2F;&#x2F;10.1.230.219:9090&#x2F;-&#x2F;reload</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/9bed866e7556554490febdfb84bf3769.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/img_convert/7a5776cc75bbd830ee989699467317c4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>çœ‹åˆ°å·²ç»è§¦å‘æŠ¥è­¦å¹¶å‘é€é‚®ä»¶<br>è‡³æ­¤ç»“æŸ</p><h2 id="æ„Ÿè°¢å¤§ä½¬"><a href="#æ„Ÿè°¢å¤§ä½¬" class="headerlink" title="æ„Ÿè°¢å¤§ä½¬"></a>æ„Ÿè°¢å¤§ä½¬</h2><p><a href="https://blog.51cto.com/luoguoling">https://blog.51cto.com/luoguoling</a><br><a href="https://alexcld.com/">https://alexcld.com</a></p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus+grafana+alertmanagerç›‘æ§k8sæ— å‘ç‰ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>clickhouseå‡çº§æœ€æ–°ç‰ˆ21.6.6</title>
      <link href="posts/35255.html"/>
      <url>posts/35255.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h3 id="é—²èŠ"><a href="#é—²èŠ" class="headerlink" title="é—²èŠ"></a>é—²èŠ</h3><p>ä¸Šç« æåˆ°clickhouseç‰ˆæœ¬æ›´æ–°è¿­ä»£è¾ƒå¿«ï¼Œbugè¾ƒå¤šã€‚<br>ä»¥ä¸Šç¯‡æ–‡ç« 20.8ä¸ºä¾‹</p><p>é¡¹ç›®ä¸­æœ‰ç”¨åˆ°clickhouse20.8æ¥å®æ—¶åŒæ­¥mysql8.13çš„æ•°æ®ï¼Œä½†æ˜¯åŒæ­¥è¿‡å»çš„è¡¨æ­£å¸¸æŸ¥è¯¢æ•°æ® æ’å…¥æ•°æ®éƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‡åˆ°å¤æ‚æŸ¥è¯¢ï¼ˆåµŒå¥—ï¼Œè¿ç®—ï¼Œèšåˆï¼‰å°±ä¼šæŠ¥é”™ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†å¥½å¤šæ–¹æ³•ï¼Œæœ€åæ‰å‘ç°æ˜¯clickhouseç‰ˆæœ¬çš„é—®é¢˜ï¼Œclickhouseå®˜ç½‘æ–‡æ¡£åœ¨æ–°çš„ç‰ˆæœ¬ä¹Ÿæœ‰ä¿®å¤ã€‚</p><p>ç±»ä¼¼è¿™ä¸€ä¸ªsqlï¼Œå¥½åƒä¹Ÿä¸æ”¯æŒç”¨inæ¥åµŒå¥—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">  generateUUIDv4() as ukey,</span><br><span class="line">  apiName,</span><br><span class="line">  toStartOfDay(toDateTime(timestamp &#x2F; 1000)) AS time,</span><br><span class="line">  count(apiName) AS num</span><br><span class="line">from</span><br><span class="line">  audit.http_stripped_event</span><br><span class="line">where</span><br><span class="line">  apiName in (</span><br><span class="line">  SELECT</span><br><span class="line">    data_val</span><br><span class="line">  from</span><br><span class="line">    data_dataTransfer_ch.t_task_check_field_data</span><br><span class="line">  where</span><br><span class="line">    task_id &#x3D; &#39;796D82C8-CB64-41AC-84EE-9D292880FEBC&#39;</span><br><span class="line">    and data_version &#x3D; 0)</span><br><span class="line">GROUP BY</span><br><span class="line">  apiName,</span><br><span class="line">  time;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">centos7836 :) select * from data_dataTransfer_ch_test.t_task_check_field_data;</span><br><span class="line">SELECT *</span><br><span class="line">FROM data_dataTransfer_ch_test.t_task_check_field_data</span><br><span class="line">Received exception from server (version 20.8.3):</span><br><span class="line">Code: 32. DB::Exception: Received from 192.168.78.36:9000. DB::Exception: Attempt to read after eof. </span><br><span class="line">0 rows in set. Elapsed: 0.405 sec. </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210707142311748.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åå°±å°†æˆ‘çš„clickhouseè¿›è¡Œäº†å‡çº§ï¼Œä»¥ä¸‹æ˜¯æ“ä½œ</p><h2 id="clickhouseå‡çº§æœ€æ–°ç‰ˆ21-6-6"><a href="#clickhouseå‡çº§æœ€æ–°ç‰ˆ21-6-6" class="headerlink" title="clickhouseå‡çº§æœ€æ–°ç‰ˆ21.6.6"></a>clickhouseå‡çº§æœ€æ–°ç‰ˆ21.6.6</h2><p>ä»¥æˆ‘ä»¬é¡¹ç›®ä¸ºä¾‹ï¼Œæ•´ç†ä¸‹ClickHouseå‡çº§çš„ç›¸å…³æ³¨æ„äº‹é¡¹ï¼Œç”±äºé„™äººå­¦è¯†æµ…è–„ï¼Œæä¾›çš„æ–¹å¼æ–¹æ³•ä»…ä¾›å¤§å®¶å‚è€ƒï¼Œå¼•èµ·çš„ä»»ä½•é—®é¢˜ï¼Œæœ¬äººä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚å®‰å…¨ç”Ÿäº§ç¬¬ä¸€æ¡ï¼šè®°å¾—å¤‡ä»½ã€è®°å¾—å¤‡ä»½ã€è®°å¾—å¤‡ä»½ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚</p><p>æˆ‘ä»¬ClickHouseæ˜¯é€šè¿‡RPMæ–¹å¼æ¥å®‰è£…çš„ï¼ŒåŒ…æ‹¬å¦‚ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master repo]# ll</span><br><span class="line">total 159984</span><br><span class="line">-rw-r--r-- 1 root root     62996 Jul  4 20:34 clickhouse-client-21.6.6.51-2.noarch.rpm</span><br><span class="line">-rw-r--r-- 1 root root 163667677 Jul  4 20:34 clickhouse-common-static-21.6.6.51-2.x86_64.rpm</span><br><span class="line">-rw-r--r-- 1 root root     87450 Jul  4 20:34 clickhouse-server-21.6.6.51-2.noarch.rpm</span><br></pre></td></tr></table></figure><h3 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h3><p>1ã€å¤‡ä»½é…ç½®æ–‡ä»¶</p><p>è·¯å¾„ä¸ºï¼š/etc/clickhouse-serverï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢éƒ½å¤‡ä»½å§ï¼Œæ­£å¸¸å®‰è£…æ–°ç‰ˆæœ¬ï¼Œclickhouseä¼šè‡ªåŠ¨å°†ä¹‹å‰çš„é…ç½®æ–‡ä»¶config.xmlå¤‡ä»½ï¼Œå‘½åä¸ºï¼šconfig.xml.rpmsaveã€‚ä¸è¿‡å°å¿ƒä½¿å¾—ä¸‡å¹´èˆ¹ã€‚</p><p>2ã€å¤‡ä»½æ•°æ®æ–‡ä»¶</p><p>æ•°æ®æ–‡ä»¶çš„è·¯å¾„æ˜¯åœ¨config.xmlä¸­è¿›è¡Œé…ç½®çš„ï¼Œæˆ‘ä»¬é…ç½®æŒ‡å‘ä¸€å—å•ç‹¬çš„ç›˜ã€‚<br><img src="https://img-blog.csdnimg.cn/20210707143002167.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">æ€»è€Œè¨€ä¹‹ï¼Œè¨€è€Œæ€»ä¹‹ï¼ŒæŠŠæ•´ä¸ªæ•°æ®æ–‡ä»¶å¤‡ä»½å§ã€‚</p><h3 id="å¸è½½æ—§ç‰ˆæœ¬"><a href="#å¸è½½æ—§ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬"></a>å¸è½½æ—§ç‰ˆæœ¬</h3><p>1ã€æŸ¥çœ‹ç›®å‰å®‰è£…ç‰ˆæœ¬</p><p>yum list installed | grep clickhouse</p><p>2ã€åˆ é™¤è½¯ä»¶ç‰ˆæœ¬</p><p>yum remove -y clickhouse-common-static</p><p>yum remove -y clickhouse-server-common</p><h3 id="å®‰è£…æ–°ç‰ˆæœ¬"><a href="#å®‰è£…æ–°ç‰ˆæœ¬" class="headerlink" title="å®‰è£…æ–°ç‰ˆæœ¬"></a>å®‰è£…æ–°ç‰ˆæœ¬</h3><p><a href="https://repo.clickhouse.tech/rpm/stable/x86_64/">rpmåŒ…ä¸‹è½½åœ°å€ï¼šhttps://repo.clickhouse.tech/rpm/stable/x86_64/</a><br>ä¸‹è½½å®Œæˆä¹‹åç›´æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh *.rpm</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸåï¼Œä¼šåœ¨/etc/clickhouse-serverä¸‹ç”Ÿäº§ç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚</p><p>æŒ‰ç…§æ—§çš„config.xmlé…ç½®ä¿¡æ¯ï¼Œæ›´æ”¹config.xmlã€‚ä¹Ÿå¯å…ˆç›´æ¥è¦†ç›–ï¼Œå¦‚æœåç»­ä¸æˆåŠŸï¼Œè¿˜æ˜¯ä¸€æ¡ä¸€æ¡æ¥ä¿®æ”¹ï¼Œæœ€å¥½æ¯”å¯¹ä¸‹ã€‚é˜²æ­¢æœ‰å°ç‰ˆæœ¬å·®å¼‚ã€‚</p><p>æ–°ç‰ˆæœ¬clickhouseç”±systemdæ§åˆ¶<br>é‡å¯æœåŠ¡éªŒè¯åŠŸèƒ½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start clickhouse-server</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> clickhouse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clickhouseå‡çº§æœ€æ–°ç‰ˆ21.6.6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>clickhouseå•æœºéƒ¨ç½²åŠå®æ—¶åŒæ­¥mysqlæ•°æ®</title>
      <link href="posts/24143.html"/>
      <url>posts/24143.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="clickhouseå•æœºéƒ¨ç½²åŠå®æ—¶åŒæ­¥mysqlæ•°æ®"><a href="#clickhouseå•æœºéƒ¨ç½²åŠå®æ—¶åŒæ­¥mysqlæ•°æ®" class="headerlink" title="clickhouseå•æœºéƒ¨ç½²åŠå®æ—¶åŒæ­¥mysqlæ•°æ®"></a>clickhouseå•æœºéƒ¨ç½²åŠå®æ—¶åŒæ­¥mysqlæ•°æ®</h1><h2 id="clickhouse20-8-3éƒ¨åˆ†"><a href="#clickhouse20-8-3éƒ¨åˆ†" class="headerlink" title="clickhouse20.8.3éƒ¨åˆ†"></a>clickhouse20.8.3éƒ¨åˆ†</h2><h4 id="ç¤ºä¾‹ç‰ˆæœ¬ï¼š20-8-3"><a href="#ç¤ºä¾‹ç‰ˆæœ¬ï¼š20-8-3" class="headerlink" title="ç¤ºä¾‹ç‰ˆæœ¬ï¼š20.8.3"></a>ç¤ºä¾‹ç‰ˆæœ¬ï¼š20.8.3</h4><h4 id="ç¯å¢ƒæ£€æŸ¥"><a href="#ç¯å¢ƒæ£€æŸ¥" class="headerlink" title="ç¯å¢ƒæ£€æŸ¥"></a>ç¯å¢ƒæ£€æŸ¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -q sse4_2 &#x2F;proc&#x2F;cpuinfo &amp;&amp; echo &quot;SSE 4.2 supported&quot; || echo &quot;SSE 4.2 not supported&quot;</span><br><span class="line">æ˜¾ç¤ºï¼šSSE 4.2 supportedï¼Œåˆ™ç¯å¢ƒæ”¯æŒ</span><br></pre></td></tr></table></figure><h4 id="ä¸‹è½½å®‰è£…ï¼ˆå•æœºæ¨¡å¼ï¼‰"><a href="#ä¸‹è½½å®‰è£…ï¼ˆå•æœºæ¨¡å¼ï¼‰" class="headerlink" title="ä¸‹è½½å®‰è£…ï¼ˆå•æœºæ¨¡å¼ï¼‰"></a>ä¸‹è½½å®‰è£…ï¼ˆå•æœºæ¨¡å¼ï¼‰</h4><p>å®‰è£…ä¾èµ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y curl</span><br><span class="line">yum install -y libtool</span><br></pre></td></tr></table></figure><p>æ·»åŠ Clickhouse çš„yumé•œåƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https:&#x2F;&#x2F;packagecloud.io&#x2F;install&#x2F;repositories&#x2F;altinity&#x2F;clickhouse&#x2F;script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥é•œåƒæƒ…å†µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep clickhouse</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…-server-client"><a href="#å®‰è£…-server-client" class="headerlink" title="å®‰è£… server client"></a>å®‰è£… server client</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y clickhouse-server </span><br><span class="line">yum install -y clickhouse-client</span><br><span class="line">å®‰è£…å®Œå</span><br><span class="line">vim &#x2F;etc&#x2F;clickhouse-server&#x2F;users.xml</span><br><span class="line">            &lt;password&gt;alexNB&lt;&#x2F;password&gt;</span><br><span class="line">ç»™defaultç”¨æˆ·è®¾ç½®å¯†ç </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨server</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;clickhouse-server start|restart|stop</span><br><span class="line">å¯åŠ¨client CLI</span><br><span class="line">clickhouse-client</span><br><span class="line">clickhouse-client -m #å¯ä»¥åœ¨å‘½ä»¤çª—å£è¾“å…¥å¤šè¡Œå‘½ä»¤</span><br><span class="line">åœæ­¢</span><br><span class="line">systemctl stop clickhouse-server</span><br></pre></td></tr></table></figure><h4 id="å¤–ç½‘è®¿é—®-å¯é€‰"><a href="#å¤–ç½‘è®¿é—®-å¯é€‰" class="headerlink" title="å¤–ç½‘è®¿é—®(å¯é€‰)"></a>å¤–ç½‘è®¿é—®(å¯é€‰)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;clickhouse-server&#x2F;config.xml</span><br><span class="line">æŠŠ &lt;listen_host&gt;::&lt;&#x2F;listen_host&gt; çš„æ³¨é‡Šæ‰“å¼€ï¼Œè¿™æ ·çš„è¯æ‰èƒ½è®©ClickHouseè¢«é™¤æœ¬æœºä»¥å¤–çš„æœåŠ¡å™¨è®¿é—®</span><br><span class="line">å¦‚æœç¦ç”¨äº†ipv6ï¼Œä½¿ç”¨ä¸‹é¢é…ç½®</span><br><span class="line">&lt;listen_host&gt;0.0.0.0&lt;&#x2F;listen_host&gt;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹é»˜è®¤ç›®å½•</li><li>æœåŠ¡ç«¯çš„é…ç½®ç›®å½•ï¼š/etc/clickhouse-server</li><li>æ•°æ®æ–‡ä»¶è·¯å¾„ï¼švar/lib/clickhouse <path>/var/lib/clickhouse/</path></li><li>æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š /var/log/clickhouse-server/ å¦‚<log>/var/log/clickhouse-server/clickhouse-server.log</li><li>å­˜å‚¨å’Œæ—¥å¿—éœ€è¦å»ºè®®ä¿®æ”¹ä¸ºéç³»ç»Ÿç›˜ï¼Œå…¶ä»–é»˜è®¤å³å¯<h4 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹å®‰è£…</span><br><span class="line">yum list installed | grep clickhouse</span><br><span class="line">clickhouse-client.noarch               21.3.3.14-2                     @repo.clickhouse.tech_rpm_stable_x86_64</span><br><span class="line">clickhouse-common-static.x86_64        21.3.3.14-2                     @repo.clickhouse.tech_rpm_stable_x86_64</span><br><span class="line">clickhouse-server.noarch               21.3.3.14-2                     @repo.clickhouse.tech_rpm_stable_x86_64</span><br><span class="line">å¸è½½å¹¶åˆ é™¤ç›®å½•</span><br><span class="line">yum remove -y clickhouse-common-static</span><br><span class="line">yum remove -y clickhouse-server-commonrm -rf &#x2F;var&#x2F;lib&#x2F;clickhouserm -rf &#x2F;etc&#x2F;clickhouse*rm -rf &#x2F;var&#x2F;log&#x2F;clickhouse*</span><br></pre></td></tr></table></figure><h2 id="mysql-8-13"><a href="#mysql-8-13" class="headerlink" title="mysql_8.13"></a>mysql_8.13</h2><h4 id="å®‰è£…å®Œmasterä¹‹å-æ‰§è¡ŒsqlæŸ¥çœ‹æ˜¯å¦æ»¡è¶³æ¡ä»¶"><a href="#å®‰è£…å®Œmasterä¹‹å-æ‰§è¡ŒsqlæŸ¥çœ‹æ˜¯å¦æ»¡è¶³æ¡ä»¶" class="headerlink" title="å®‰è£…å®Œmasterä¹‹å,æ‰§è¡ŒsqlæŸ¥çœ‹æ˜¯å¦æ»¡è¶³æ¡ä»¶"></a>å®‰è£…å®Œmasterä¹‹å,æ‰§è¡ŒsqlæŸ¥çœ‹æ˜¯å¦æ»¡è¶³æ¡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%gtid_mode%&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| gtid_mode     | ON    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; show variables like &#39;%enforce_gtid_consistency%&#39;;</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| Variable_name            | Value |</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| enforce_gtid_consistency | ON    |</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; show variables like &#39;%binlog_format%&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="è‹¥ä¸æ»¡è¶³ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯mysql"><a href="#è‹¥ä¸æ»¡è¶³ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯mysql" class="headerlink" title="è‹¥ä¸æ»¡è¶³ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯mysql"></a>è‹¥ä¸æ»¡è¶³ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯mysql</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;my.cnf</span><br><span class="line"></span><br><span class="line">gtid_mode&#x3D;ON</span><br><span class="line">enforce_gtid_consistency&#x3D;1</span><br><span class="line">binlog_format&#x3D;ROW</span><br></pre></td></tr></table></figure><h4 id="MySQL8åˆ›å»ºç”¨æˆ·å¹¶æˆæƒçš„è¯­å¥"><a href="#MySQL8åˆ›å»ºç”¨æˆ·å¹¶æˆæƒçš„è¯­å¥" class="headerlink" title="MySQL8åˆ›å»ºç”¨æˆ·å¹¶æˆæƒçš„è¯­å¥"></a>MySQL8åˆ›å»ºç”¨æˆ·å¹¶æˆæƒçš„è¯­å¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;create user brady@&#39;%&#39; identified  by &#39;brady&#39;;</span><br></pre></td></tr></table></figure>æˆæƒç¤ºä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;grant all privileges on *.* to brady@&#39;%&#39; with grant option;</span><br></pre></td></tr></table></figure>åˆ·æ–°æƒé™<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;flush privileges;</span><br></pre></td></tr></table></figure>ä¿®æ”¹è¿œç¨‹è¿æ¥ç”¨æˆ·çš„åŠ å¯†è§„åˆ™<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;ALTER USER &#39;brady&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;brady&#39;;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h2><h4 id="è¿›å…¥clickhouseæ•°æ®åº“"><a href="#è¿›å…¥clickhouseæ•°æ®åº“" class="headerlink" title="è¿›å…¥clickhouseæ•°æ®åº“"></a>è¿›å…¥clickhouseæ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clickhouse-client -u default -h &lt;IP&gt; --password alexNB</span><br></pre></td></tr></table></figure><h4 id="å¼€å¯å¤åˆ¶é€šé“"><a href="#å¼€å¯å¤åˆ¶é€šé“" class="headerlink" title="å¼€å¯å¤åˆ¶é€šé“"></a>å¼€å¯å¤åˆ¶é€šé“</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from system.settings where name &#x3D;&#39;allow_experimental_database_materialize_mysql&#39;;</span><br><span class="line"></span><br><span class="line">SET allow_experimental_database_materialize_mysql&#x3D;1;</span><br></pre></td></tr></table></figure><h4 id="åŒæ­¥æ•°æ®"><a href="#åŒæ­¥æ•°æ®" class="headerlink" title="åŒæ­¥æ•°æ®"></a>åŒæ­¥æ•°æ®</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE DBNAME ENGINE &#x3D; MaterializeMySQL(&#39;MYSQLIP:PORT&#39;, &#39;SOURCEDB&#39;, &#39;MYSQL_DB&#39;, &#39;PASSWORD&#39;);</span><br><span class="line"></span><br><span class="line">CREATE DATABASE data_dataTransfer_ch_update ENGINE &#x3D; MaterializeMySQL(&#39;172.22.254.217:3306&#39;, &#39;data_dataTransfer_ch&#39;, &#39;brady&#39;, &#39;brady&#39;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">k8s-master :) show databases;</span><br><span class="line">SHOW DATABASES</span><br><span class="line">Query id: 7469cc9b-da21-44ad-9eb5-f32cddcadbe7</span><br><span class="line">â”Œâ”€nameâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ audit                       â”‚</span><br><span class="line">â”‚ data_dataTransfer_ch        â”‚</span><br><span class="line">â”‚ data_dataTransfer_ch_update â”‚</span><br><span class="line">â”‚ default                     â”‚</span><br><span class="line">â”‚ system                      â”‚</span><br><span class="line">â”‚ tstu                        â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">6 rows in set. Elapsed: 0.002 sec. </span><br><span class="line"></span><br><span class="line">k8s-master :) use data_dataTransfer_ch_update;</span><br><span class="line">USE data_dataTransfer_ch_update</span><br><span class="line">Query id: 552cecae-df70-49e1-a4c4-8bae3e7f4f7d</span><br><span class="line">Ok.</span><br><span class="line">0 rows in set. Elapsed: 0.001 sec. </span><br><span class="line"></span><br><span class="line">k8s-master :) select task_id,data_val from data_dataTransfer_ch_update.t_task_check_field_data where task_id &#x3D; &#39;796D82C8-CB64-41AC-84EE-9D292880FEBC&#39;;</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">    task_id,</span><br><span class="line">    data_val</span><br><span class="line">FROM data_dataTransfer_ch_update.t_task_check_field_data</span><br><span class="line">WHERE task_id &#x3D; &#39;796D82C8-CB64-41AC-84EE-9D292880FEBC&#39;</span><br><span class="line"></span><br><span class="line">Query id: 676b491b-df7a-4010-84ed-acb8dec5a393</span><br><span class="line"></span><br><span class="line">â”Œâ”€task_idâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€data_valâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ 796D82C8-CB64-41AC-84EE-9D292880FEBC â”‚ http:&#x2F;&#x2F;110.110.110.110:8085&#x2F;vul&#x2F;xss&#x2F;xssblind&#x2F;admin_login.php            â”‚</span><br><span class="line">â”‚ 796D82C8-CB64-41AC-84EE-9D292880FEBC â”‚ http:&#x2F;&#x2F;110.110.110.110:8085&#x2F;vul&#x2F;xss&#x2F;xssblind&#x2F;admin_login.php            â”‚</span><br><span class="line">â”‚ 796D82C8-CB64-41AC-84EE-9D292880FEBC â”‚ http:&#x2F;&#x2F;110.110.110.110:8085&#x2F;&#x2F;vul&#x2F;xss&#x2F;xsspost&#x2F;post_login.php             â”‚</span><br><span class="line">â”‚ 796D82C8-CB64-41AC-84EE-9D292880FEBC â”‚ http:&#x2F;&#x2F;110.110.110.110:8085&#x2F;vul&#x2F;sqli&#x2F;sqli_iu&#x2F;sqli_login.php             â”‚</span><br><span class="line">â”‚ 796D82C8-CB64-41AC-84EE-9D292880FEBC â”‚ http:&#x2F;&#x2F;110.110.110.110:8085&#x2F;vul&#x2F;infoleak&#x2F;findabc.php                    â”‚</span><br></pre></td></tr></table></figure>è‡³æ­¤å®æ—¶åŒæ­¥ç»“æŸ<br>å¯ä»¥åœ¨mysqlå¯¹æ•°æ®è¡¨è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œåœ¨clickhouseå¯ä»¥çœ‹åˆ°æ•ˆæœ</li></ul><p>clickhouseç‰ˆæœ¬æ›´æ–°è¿­ä»£è¾ƒå¿«ï¼Œè€ç‰ˆæœ¬bugè¾ƒå¤šä¸ç¨³å®šã€‚<br>20.8è¿™ä¸ªç‰ˆæœ¬bugä¹ŸæŒºå¤šï¼Œå¦‚æœæœ‰é‡åˆ°å¯ä»¥å‚è€ƒä¸‹ç¯‡æ–‡ç« <br><a href="https://alexcld.com/posts/35255.html">å¤§ä½¬ç§»æ­¥è¿™é‡Œ</a><br><a href="https://blog.csdn.net/weixin_45509582">æˆ–è€…è¿™é‡Œ</a></p>]]></content>
      
      
      <categories>
          
          <category> clickhouse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clickhouseå•æœºéƒ¨ç½²åŠå®æ—¶åŒæ­¥mysqlæ•°æ® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>K8s nodePortã€portã€targetPortã€hostPortè¯¦è§£</title>
      <link href="posts/2313.html"/>
      <url>posts/2313.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="K8s-nodePortã€portã€targetPortã€hostPortè¯¦è§£"><a href="#K8s-nodePortã€portã€targetPortã€hostPortè¯¦è§£" class="headerlink" title="K8s nodePortã€portã€targetPortã€hostPortè¯¦è§£"></a>K8s nodePortã€portã€targetPortã€hostPortè¯¦è§£</h1><h2 id="1-nodePort"><a href="#1-nodePort" class="headerlink" title="1. nodePort"></a>1. nodePort</h2><p>å¤–éƒ¨æµé‡è®¿é—®k8sé›†ç¾¤ä¸­serviceå…¥å£çš„ä¸€ç§æ–¹å¼ï¼ˆå¦ä¸€ç§æ–¹å¼æ˜¯LoadBalancerï¼‰ï¼Œå³nodeIP:nodePortæ˜¯æä¾›ç»™å¤–éƒ¨æµé‡è®¿é—®k8sé›†ç¾¤ä¸­serviceçš„å…¥å£ã€‚æ¯”å¦‚å¤–éƒ¨ç”¨æˆ·è¦è®¿é—®k8sé›†ç¾¤ä¸­çš„ä¸€ä¸ªWebåº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é…ç½®å¯¹åº”serviceçš„type=NodePortï¼ŒnodePort=30001ã€‚å…¶ä»–ç”¨æˆ·å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨<a href="http://node:30001è®¿é—®åˆ°è¯¥webæœåŠ¡ã€‚è€Œæ•°æ®åº“ç­‰æœåŠ¡å¯èƒ½ä¸éœ€è¦è¢«å¤–ç•Œè®¿é—®ï¼Œåªéœ€è¢«å†…éƒ¨æœåŠ¡è®¿é—®å³å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸å¿…è®¾ç½®serviceçš„NodePortã€‚">http://node:30001è®¿é—®åˆ°è¯¥webæœåŠ¡ã€‚è€Œæ•°æ®åº“ç­‰æœåŠ¡å¯èƒ½ä¸éœ€è¦è¢«å¤–ç•Œè®¿é—®ï¼Œåªéœ€è¢«å†…éƒ¨æœåŠ¡è®¿é—®å³å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸å¿…è®¾ç½®serviceçš„NodePortã€‚</a></p><h2 id="2-port"><a href="#2-port" class="headerlink" title="2. port"></a>2. port</h2><p>k8sé›†ç¾¤å†…éƒ¨æœåŠ¡ä¹‹é—´è®¿é—®serviceçš„å…¥å£ã€‚å³clusterIP:portæ˜¯serviceæš´éœ²åœ¨clusterIPä¸Šçš„ç«¯å£ã€‚mysqlå®¹å™¨æš´éœ²äº†3306ç«¯å£ï¼Œé›†ç¾¤å†…å…¶ä»–å®¹å™¨é€šè¿‡33306ç«¯å£è®¿é—®mysqlæœåŠ¡ï¼Œä½†æ˜¯å¤–éƒ¨æµé‡ä¸èƒ½è®¿é—®mysqlæœåŠ¡ï¼Œå› ä¸ºmysqlæœåŠ¡æ²¡æœ‰é…ç½®NodePortã€‚å¯¹åº”çš„service.yamlå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: mysql-service</span><br><span class="line">spec:</span><br><span class="line"> ports:</span><br><span class="line"> - port: 33306</span><br><span class="line">   targetPort: 3306</span><br><span class="line"> selector:</span><br><span class="line">  name: mysql-pod</span><br></pre></td></tr></table></figure><h2 id="3-targetPort"><a href="#3-targetPort" class="headerlink" title="3.targetPort"></a>3.targetPort</h2><p>å®¹å™¨çš„ç«¯å£ï¼ˆæœ€ç»ˆçš„æµé‡ç«¯å£ï¼‰ã€‚targetPortæ˜¯podä¸Šçš„ç«¯å£ï¼Œä»portå’ŒnodePortä¸Šæ¥çš„æµé‡ï¼Œç»è¿‡kube-proxyæµå…¥åˆ°åç«¯podçš„targetPortä¸Šï¼Œæœ€åè¿›å…¥å®¹å™¨ã€‚<br>åˆ¶ä½œå®¹å™¨æ—¶æš´éœ²çš„ç«¯å£ä¸€è‡´ï¼ˆä½¿ç”¨DockerFileä¸­çš„EXPOSEï¼‰ï¼Œä¾‹å¦‚å®˜æ–¹çš„nginxï¼ˆå‚è€ƒDockerFileï¼‰æš´éœ²80ç«¯å£ã€‚ å¯¹åº”çš„service.yamlå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: nginx-service</span><br><span class="line">spec:</span><br><span class="line"> type: NodePort         &#x2F;&#x2F; æœ‰é…ç½®NodePortï¼Œå¤–éƒ¨æµé‡å¯è®¿é—®k8sä¸­çš„æœåŠ¡</span><br><span class="line"> ports:</span><br><span class="line"> - port: 30080          &#x2F;&#x2F; æœåŠ¡è®¿é—®ç«¯å£</span><br><span class="line">   targetPort: 80       &#x2F;&#x2F; å®¹å™¨ç«¯å£</span><br><span class="line">   nodePort: 30001      &#x2F;&#x2F; NodePort</span><br><span class="line"> selector:</span><br><span class="line">  name: nginx-pod</span><br></pre></td></tr></table></figure><h2 id="4-hostPort"><a href="#4-hostPort" class="headerlink" title="4.hostPort"></a>4.hostPort</h2><p>è¿™æ˜¯ä¸€ç§ç›´æ¥å®šä¹‰Podç½‘ç»œçš„æ–¹å¼ã€‚hostPortæ˜¯ç›´æ¥å°†å®¹å™¨çš„ç«¯å£ä¸æ‰€è°ƒåº¦çš„èŠ‚ç‚¹ä¸Šçš„ç«¯å£è·¯ç”±ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡å®¿ä¸»æœºçš„IPåŠ ä¸Šæ¥è®¿é—®Podäº†ï¼Œå¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: influxdb</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">    - name: influxdb</span><br><span class="line">      image: influxdb</span><br><span class="line">      ports:</span><br><span class="line">        - containerPort: 8086</span><br><span class="line">          hostPort: 8086</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšæœ‰ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºPodé‡æ–°è°ƒåº¦çš„æ—¶å€™è¯¥Podè¢«è°ƒåº¦åˆ°çš„å®¿ä¸»æœºå¯èƒ½ä¼šå˜åŠ¨ï¼Œè¿™æ ·å°±å˜åŒ–äº†ï¼Œç”¨æˆ·å¿…é¡»è‡ªå·±ç»´æŠ¤ä¸€ä¸ªPodä¸æ‰€åœ¨å®¿ä¸»æœºçš„å¯¹åº”å…³ç³»ã€‚<br>ä½¿ç”¨äº† hostPort çš„å®¹å™¨åªèƒ½è°ƒåº¦åˆ°ç«¯å£ä¸å†²çªçš„ Node ä¸Šï¼Œé™¤éæœ‰å¿…è¦ï¼ˆæ¯”å¦‚è¿è¡Œä¸€äº›ç³»ç»Ÿçº§çš„ daemon æœåŠ¡ï¼‰ï¼Œä¸å»ºè®®ä½¿ç”¨ç«¯å£æ˜ å°„åŠŸèƒ½ã€‚å¦‚æœéœ€è¦å¯¹å¤–æš´éœ²æœåŠ¡ï¼Œå»ºè®®ä½¿ç”¨ NodePort Serviceã€‚</p><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><p>æ€»çš„æ¥è¯´ï¼Œportå’ŒnodePortéƒ½æ˜¯serviceçš„ç«¯å£ï¼Œå‰è€…æš´éœ²ç»™k8sé›†ç¾¤å†…éƒ¨æœåŠ¡è®¿é—®ï¼Œåè€…æš´éœ²ç»™k8sé›†ç¾¤å¤–éƒ¨æµé‡è®¿é—®ã€‚ä»ä¸Šä¸¤ä¸ªç«¯å£è¿‡æ¥çš„æ•°æ®éƒ½éœ€è¦ç»è¿‡åå‘ä»£ç†kube-proxyï¼Œæµå…¥åç«¯podçš„targetPortä¸Šï¼Œæœ€ååˆ°è¾¾podå†…çš„å®¹å™¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8s nodePortã€portã€targetPortã€hostPortè¯¦è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubesphereæœ€å°åŒ–å®‰è£…</title>
      <link href="posts/32145.html"/>
      <url>posts/32145.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="KUBERSPHEREå®‰è£…"><a href="#KUBERSPHEREå®‰è£…" class="headerlink" title="KUBERSPHEREå®‰è£…"></a>KUBERSPHEREå®‰è£…</h1><h2 id="æ³¨ï¼š"><a href="#æ³¨ï¼š" class="headerlink" title="æ³¨ï¼š"></a>æ³¨ï¼š</h2><p>åœ¨k8sæ­å»ºå®Œæˆçš„åŸºç¡€ä¸Šå®‰è£…æœ€å°åŒ–kubesphere</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¯å¢ƒï¼šcentos7x3</span><br><span class="line">k8s-master192.168.10.1012æ ¸5G</span><br><span class="line">k8s-node1192.168.10.1022æ ¸2G</span><br><span class="line">k8s-node2192.168.10.1032æ ¸2G</span><br></pre></td></tr></table></figure><p><a href="https://mp.weixin.qq.com/s/PD1CCkKZgtZD7pAZEqF-rw">kubeadminå®‰è£…kubernetesç§»æ­¥é˜¿è‰¯å¤§ä½¬çš„æ•™ç¨‹</a><br>åŸºäºkubeadminæ­å»ºï¼Œmasterå†…å­˜å°½é‡ç»™åˆ°7-8ä¸ªGï¼ˆæˆ‘è¿™é‡Œç¯å¢ƒä¸å…è®¸ï¼ŒæœŸé—´å‡ºç°è¿‡å¤šæ¬¡è“å±ï¼‰</p><p>ç”±äºéƒ¨åˆ†åŒ…è¢«å¢™ï¼Œæ­å»ºè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰è®¸å¤šåŒ…æ‹‰ä¸ä¸‹æ¥ï¼Œå»ºè®®çˆ¬ä¸ªæ¢¯å­è¿‡å»ï¼Œæˆ–è€…æœ¬åœ°ç¿»è¿‡å»ä¹‹åç»™è™šæ‹Ÿæœºåšè½¬å‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨yumæºå­˜åœ¨çš„æƒ…å†µä¸‹</span><br><span class="line">yum -y install openvpn</span><br><span class="line">åå°è¿è¡Œ</span><br><span class="line">openvpn --daemon --config *.openvpn</span><br></pre></td></tr></table></figure><p>å‡ºç°ä»€ä¹ˆä»€ä¹ˆsuccessfullyä»€ä¹ˆä»€ä¹ˆcompletelyå°±okäº†</p><h3 id="ä¸€ã€å®‰è£…helm"><a href="#ä¸€ã€å®‰è£…helm" class="headerlink" title="ä¸€ã€å®‰è£…helm"></a>ä¸€ã€å®‰è£…helm</h3><p>1.åœ°å€ <a href="https://helm.sh/docs/intro/install/">https://helm.sh/docs/intro/install/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;get.helm.sh&#x2F;helm-v3.3.4-linux-amd64.tar.gz</span><br><span class="line"> </span><br><span class="line">tart -zxvf helm-v3.3.4-linux-amd64.tar.gz</span><br><span class="line"> </span><br><span class="line">mv linux-amd64&#x2F;helm &#x2F;usr&#x2F;local&#x2F;bin&#x2F;helm</span><br><span class="line"> </span><br><span class="line">helm version</span><br><span class="line">version.BuildInfo&#123;Version:&quot;v3.3.4&quot;, GitCommit:&quot;a61ce5633af99708171414353ed49547cf05013d&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.14.9&quot;&#125;</span><br></pre></td></tr></table></figure><p>2.å‘½ä»¤è¡¥å…¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~&#x2F;.bashrc</span><br><span class="line"></span><br><span class="line">source &lt;(helm completion bash)</span><br><span class="line"></span><br><span class="line">source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure><p>3.æ·»åŠ å¸¸ç”¨ä»“åº“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add stable https:&#x2F;&#x2F;kubernetes-charts.storage.googleapis.com&#x2F;</span><br><span class="line">$ helm repo add bitnami https:&#x2F;&#x2F;charts.bitnami.com&#x2F;bitnami</span><br><span class="line">$ helm repo add incubator https:&#x2F;&#x2F;kubernetes-charts-incubator.storage.googleapis.com&#x2F;</span><br><span class="line">$ helm repo add ingress-nginx https:&#x2F;&#x2F;kubernetes.github.io&#x2F;ingress-nginx</span><br><span class="line">$ helm repo update # Make sure we get the latest list of charts</span><br><span class="line">$ helm repo add ali-stable    https:&#x2F;&#x2F;kubernetes.oss-cn-hangzhou.aliyuncs.com&#x2F;charts  #é˜¿é‡Œäº‘</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helm repo list</span><br><span class="line"></span><br><span class="line">NAME            URL                                                       </span><br><span class="line">ingress-nginx   https:&#x2F;&#x2F;kubernetes.github.io&#x2F;ingress-nginx                </span><br><span class="line">stable          https:&#x2F;&#x2F;kubernetes-charts.storage.googleapis.com&#x2F;         </span><br><span class="line">bitnami         https:&#x2F;&#x2F;charts.bitnami.com&#x2F;bitnami                        </span><br><span class="line">incubator       https:&#x2F;&#x2F;kubernetes-charts-incubator.storage.googleapis.com&#x2F;</span><br></pre></td></tr></table></figure><p>4.é…ç½®æƒé™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">æƒé™</span><br><span class="line">kubectl apply -f helm-rbac.yaml</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: tiller</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: tiller</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: tiller</span><br><span class="line">    namespace: kube-system</span><br></pre></td></tr></table></figure><h3 id="äºŒã€å®‰è£…openebsåˆ›å»ºstorageclassæŒä¹…åŒ–å­˜å‚¨"><a href="#äºŒã€å®‰è£…openebsåˆ›å»ºstorageclassæŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="äºŒã€å®‰è£…openebsåˆ›å»ºstorageclassæŒä¹…åŒ–å­˜å‚¨"></a>äºŒã€å®‰è£…openebsåˆ›å»ºstorageclassæŒä¹…åŒ–å­˜å‚¨</h3><p><a href="https://www.cnblogs.com/benjamin77/p/9944268.html">å¯ç§»æ­¥å¤§ä½¬ç”¨nfsåšæŒä¹…åŒ–å­˜å‚¨æ¡ˆä¾‹æ¥äº†è§£æŒä¹…åŒ–å­˜å‚¨</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node -o wide</span><br><span class="line">å»é™¤æ±¡ç‚¹</span><br><span class="line">kubectl describe node master | grep Taint</span><br><span class="line">å»é™¤masterçš„æ±¡ç‚¹</span><br><span class="line">kubectl taint nodes master node-role.kubernetes.io&#x2F;master:NoSchedule-</span><br><span class="line"></span><br><span class="line">å®‰è£…OpenEBS</span><br><span class="line">A:è‹¥é›†ç¾¤å·²å®‰è£…äº† Helmï¼Œå¯é€šè¿‡ Helm å‘½ä»¤æ¥å®‰è£… OpenEBSï¼š</span><br><span class="line">kubectl create ns openebs</span><br><span class="line">helm install --namespace openebs --name openebs stable&#x2F;openebs --version 1.5.0</span><br><span class="line">B:é™¤æ­¤ä¹‹å¤– è¿˜å¯ä»¥é€šè¿‡ kubectl å‘½ä»¤å®‰è£…ï¼š</span><br><span class="line">kubectl apply -f https:&#x2F;&#x2F;openebs.github.io&#x2F;charts&#x2F;openebs-operator-1.5.0.yaml</span><br><span class="line"></span><br><span class="line">éªŒè¯</span><br><span class="line">kubectl get sc</span><br><span class="line">å¦‚ä¸‹å°† openebs-hostpathè®¾ç½®ä¸º é»˜è®¤çš„ StorageClass</span><br><span class="line">kubectl patch storageclass openebs-hostpath -p &#39;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io&#x2F;is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#39;</span><br><span class="line"></span><br><span class="line">éªŒè¯</span><br><span class="line">kubectl get sc</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€æœ€å°åŒ–å®‰è£…kubesphere"><a href="#ä¸‰ã€æœ€å°åŒ–å®‰è£…kubesphere" class="headerlink" title="ä¸‰ã€æœ€å°åŒ–å®‰è£…kubesphere"></a>ä¸‰ã€æœ€å°åŒ–å®‰è£…kubesphere</h3><p><a href="https://kubesphere.io/docs/quick-start/minimal-kubesphere-on-k8s/">å‚è€ƒå®˜ç½‘</a><br><img src="https://img-blog.csdnimg.cn/20210520140416518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>1.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https:&#x2F;&#x2F;github.com&#x2F;kubesphere&#x2F;ks-installer&#x2F;releases&#x2F;download&#x2F;v3.1.0&#x2F;kubesphere-installer.yaml</span><br><span class="line">   </span><br><span class="line">kubectl apply -f https:&#x2F;&#x2F;github.com&#x2F;kubesphere&#x2F;ks-installer&#x2F;releases&#x2F;download&#x2F;v3.1.0&#x2F;cluster-configuration.yaml</span><br></pre></td></tr></table></figure><p>2.æ£€æŸ¥å®‰è£…æ—¥å¿—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app&#x3D;ks-install -o jsonpath&#x3D;&#39;&#123;.items[0].metadata.name&#125;&#39;) -f</span><br></pre></td></tr></table></figure><p>3.ä½¿ç”¨kubectl get pod â€“all-namespacesï¼Œçœ‹çœ‹æ˜¯å¦æ‰€æœ‰çš„è±†èšï¼Œåœ¨KubeSphereç›¸å…³çš„å‘½åç©ºé—´è¿è¡Œæ­£å¸¸ã€‚å¦‚æœæ˜¯ï¼Œè¯·30880é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ§åˆ¶å°çš„ç«¯å£ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc&#x2F;ks-console -n kubesphere-system</span><br></pre></td></tr></table></figure><p>4.æŸ¥çœ‹kubusphereç»„ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n kubesphere-monitoring-system</span><br></pre></td></tr></table></figure><p>5.ç™»å½•kubesphereæ§åˆ¶å°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Console: http:&#x2F;&#x2F;192.168.10.103:30880</span><br><span class="line">Account: admin</span><br><span class="line">Password: P@88w0rd</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2021052014123986.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210520141239698.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210520141239688.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> kubesphere </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8sç¯å¢ƒä¸‹kubesphereæœ€å°åŒ–å®‰è£… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerä¸‹jumpserverè·³æ¿æœº,å ¡å’æœºè¯¦ç»†éƒ¨ç½²</title>
      <link href="posts/7853.html"/>
      <url>posts/7853.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h3 id="å…³äºè·³æ¿æœº-å ¡å’æœºçš„ä»‹ç»ï¼š"><a href="#å…³äºè·³æ¿æœº-å ¡å’æœºçš„ä»‹ç»ï¼š" class="headerlink" title="å…³äºè·³æ¿æœº/å ¡å’æœºçš„ä»‹ç»ï¼š"></a>å…³äºè·³æ¿æœº/å ¡å’æœºçš„ä»‹ç»ï¼š</h3><p>è·³æ¿æœºå¯ä»¥ä½¿å¼€å‘æˆ–è¿ç»´äººå‘˜åœ¨ç»´æŠ¤è¿‡ç¨‹ä¸­é¦–å…ˆè¦ç»Ÿä¸€ç™»å½•åˆ°è¿™å°æœåŠ¡å™¨ï¼Œç„¶åå†ç™»å½•åˆ°ç›®æ ‡è®¾å¤‡è¿›è¡Œç»´æŠ¤å’Œæ“ä½œ</p><h3 id="è·³æ¿æœºä½¿ç”¨åœºæ™¯ï¼š"><a href="#è·³æ¿æœºä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="è·³æ¿æœºä½¿ç”¨åœºæ™¯ï¼š"></a>è·³æ¿æœºä½¿ç”¨åœºæ™¯ï¼š</h3><p><img src="https://img-blog.csdnimg.cn/20210122105747380.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="jumpserveræ¦‚è¿°"><a href="#jumpserveræ¦‚è¿°" class="headerlink" title="jumpserveræ¦‚è¿°"></a>jumpserveræ¦‚è¿°</h3><p>Jumpserveræ˜¯ä¸€æ¬¾å¼€æºçš„å¼€æºçš„å ¡å’æœºï¼Œå¯ä½¿ç³»ç»Ÿçš„ç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜å®‰å…¨çš„è¿æ¥åˆ°ä¼ä¸šå†…éƒ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ“ä½œï¼Œå¹¶ä¸”æ”¯æŒå¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿï¼Œæ˜¯ä¸€æ¬¾éå¸¸å®‰å…¨çš„è¿œç¨‹è¿æ¥å·¥å…·</p><h3 id="å¸¸è§æ”¯æŒçš„ç³»ç»Ÿï¼š"><a href="#å¸¸è§æ”¯æŒçš„ç³»ç»Ÿï¼š" class="headerlink" title="å¸¸è§æ”¯æŒçš„ç³»ç»Ÿï¼š"></a>å¸¸è§æ”¯æŒçš„ç³»ç»Ÿï¼š</h3><p>CentOS, RedHat, Fedora, Amazon Linux<br>Debian<br>SUSE, Ubuntu<br>FreeBSD<br>å…¶ä»–sshåè®®ç¡¬ä»¶è®¾å¤‡</p><h3 id="éƒ¨ç½²æ­¥éª¤"><a href="#éƒ¨ç½²æ­¥éª¤" class="headerlink" title="éƒ¨ç½²æ­¥éª¤"></a>éƒ¨ç½²æ­¥éª¤</h3><h5 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h5><h5 id="Tips-è¯¥å®éªŒéœ€è¦è™šæ‹Ÿæœºæ¥å…¥äº’è”ç½‘ï¼Œä½¿è™šæ‹Ÿæœºä¸Šç½‘å¯çœ‹æˆ‘çš„å¦ä¸€ä¸ªæ–‡ç« "><a href="#Tips-è¯¥å®éªŒéœ€è¦è™šæ‹Ÿæœºæ¥å…¥äº’è”ç½‘ï¼Œä½¿è™šæ‹Ÿæœºä¸Šç½‘å¯çœ‹æˆ‘çš„å¦ä¸€ä¸ªæ–‡ç« " class="headerlink" title="Tips:è¯¥å®éªŒéœ€è¦è™šæ‹Ÿæœºæ¥å…¥äº’è”ç½‘ï¼Œä½¿è™šæ‹Ÿæœºä¸Šç½‘å¯çœ‹æˆ‘çš„å¦ä¸€ä¸ªæ–‡ç« "></a>Tips:<a href="https://alexcld.com/posts/2356.html">è¯¥å®éªŒéœ€è¦è™šæ‹Ÿæœºæ¥å…¥äº’è”ç½‘ï¼Œä½¿è™šæ‹Ÿæœºä¸Šç½‘å¯çœ‹æˆ‘çš„å¦ä¸€ä¸ªæ–‡ç« </a></h5><p>å…³é—­selinux</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#setenforce 0</span><br></pre></td></tr></table></figure><p>å…³é—­é˜²ç«å¢™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#systemctl stop firewalld</span><br><span class="line">[root@centos7 ~]#iptables -F</span><br></pre></td></tr></table></figure><h5 id="å®‰è£…dockerçš„æº"><a href="#å®‰è£…dockerçš„æº" class="headerlink" title="å®‰è£…dockerçš„æº"></a>å®‰è£…dockerçš„æº</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#yum -y install wget</span><br><span class="line">[root@centos7 ~]#cd &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br><span class="line">[root@centos7 ~]#wget https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">[root@centos7 ~]#wget http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br><span class="line">[root@centos7 ~]#yum -y install centos-release-openstack-ocata</span><br></pre></td></tr></table></figure><h5 id="é…ç½®mariadb"><a href="#é…ç½®mariadb" class="headerlink" title="é…ç½®mariadb"></a>é…ç½®mariadb</h5><p>å®‰è£…mariadb</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#yum -y install mariadb-server</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#vim &#x2F;etc&#x2F;my.cnf</span><br><span class="line">[client-server]</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">symbolic-links&#x3D;0</span><br><span class="line">#ç¦æ­¢ä¸»æœºåè§£æ</span><br><span class="line">skip_name_resolve</span><br><span class="line"></span><br><span class="line">!includedir &#x2F;etc&#x2F;my.cnf.d</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#systemctl start mariadb</span><br><span class="line">[root@centos7 ~]#systemctl enable mariadb</span><br></pre></td></tr></table></figure><p>åˆ›å»ºjumpserveræ•°æ®åº“å¹¶æˆæƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#mysql</span><br><span class="line">MariaDB [(none)]&gt; create database jumpserver default charset &#39;utf8&#39;;</span><br><span class="line">#åˆ›å»ºç®¡ç†è´¦å·ï¼Œå¯†ç å¿…é¡»æ˜¯æ•°å­—åŠ å­—æ¯</span><br><span class="line">MariaDB [(none)]&gt; grant all on jumpserver.* to &#39;jumpserver&#39;@&#39;%&#39; identified by &#39;ywz0207.&#39;;</span><br></pre></td></tr></table></figure><h5 id="é…ç½®Redis"><a href="#é…ç½®Redis" class="headerlink" title="é…ç½®Redis"></a>é…ç½®Redis</h5><p>å®‰è£…Redis</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#yum install epel-release</span><br><span class="line">[root@centos7 ~]#yum -y install redis</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#vim &#x2F;etc&#x2F;redis.conf </span><br><span class="line">61ï¼šbind 0.0.0.0</span><br><span class="line">480ï¼šrequirepass 123</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#systemctl start redis</span><br><span class="line">[root@centos7 ~]#systemctl enable redis</span><br></pre></td></tr></table></figure><h5 id="é…ç½®docker"><a href="#é…ç½®docker" class="headerlink" title="é…ç½®docker"></a>é…ç½®docker</h5><p>å®‰è£…docker</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#yum -y install docker-ce</span><br></pre></td></tr></table></figure><p>å¯åŠ¨docker</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#systemctl start docker</span><br><span class="line">[root@centos7 ~]#systemctl enable docker</span><br></pre></td></tr></table></figure><p>ä¸‹è½½jumpserveré•œåƒï¼Œå¹¶è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#docker run --name jms_all -d \</span><br><span class="line">    -v &#x2F;opt&#x2F;mysql:&#x2F;var&#x2F;lib&#x2F;mysql \</span><br><span class="line">    -v &#x2F;opt&#x2F;jumpserver:&#x2F;opt&#x2F;jumpserver&#x2F;data&#x2F;media \</span><br><span class="line">    -p 80:80 \</span><br><span class="line">    -p 2222:2222 \</span><br><span class="line">    -e SECRET_KEY&#x3D;PEHVdLzvZFtDQT733ntHDH1hglXQ9OQKoI1xxAfdDhpRGx3tg7 \</span><br><span class="line">    -e BOOTSTRAP_TOKEN&#x3D;YDzl55tZPTdclbUh \</span><br><span class="line">    -e DB_HOST&#x3D;192.168.10.101 \ #å½“å‰ä¸»æœºIP</span><br><span class="line">    -e DB_PORT&#x3D;3306 \ </span><br><span class="line">    -e DB_USER&#x3D;jumpserver \ #æ•°æ®åº“ç”¨æˆ·</span><br><span class="line">    -e DB_PASSWORD&#x3D;ywz0207. \ #æ•°æ®åº“å¯†ç </span><br><span class="line">    -e DB_NAME&#x3D;jumpserver \ #æ•°æ®åº“åç§°</span><br><span class="line">    -e REDIS_HOST&#x3D;192.168.10.101 \</span><br><span class="line">    -e REDIS_PORT&#x3D;6379 \</span><br><span class="line">    -e REDIS_PASSWORD&#x3D;123 \ #Rediså¯†ç </span><br><span class="line">    jumpserver&#x2F;jms_all:1.4.8</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#docker logs -f jms_all</span><br><span class="line">#çœ‹åˆ°å¦‚ä¸‹å‡ è¡Œå³å¯</span><br><span class="line">gunicorn is running: 57</span><br><span class="line">celery is running: 73</span><br><span class="line">beat is running: 75</span><br><span class="line">guacd[98]: INFO:    Guacamole proxy daemon (guacd) version 0.9.14 started</span><br><span class="line">Starting guacd: SUCCESS</span><br><span class="line">Tomcat started.</span><br><span class="line">Use eventlet dispatch</span><br><span class="line">Start coco process</span><br><span class="line">Use eventlet dispatch</span><br><span class="line">Start coco process</span><br><span class="line">Use eventlet dispatch</span><br><span class="line">Start coco process</span><br><span class="line">Jumpserver ALL 1.4.8</span><br><span class="line">å®˜ç½‘ http:&#x2F;&#x2F;www.jumpserver.org</span><br><span class="line">æ–‡æ¡£ http:&#x2F;&#x2F;docs.jumpserver.org</span><br><span class="line">æœ‰é—®é¢˜è¯·å‚è€ƒ http:&#x2F;&#x2F;docs.jumpserver.org&#x2F;zh&#x2F;docs&#x2F;faq.html</span><br></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨å‘½ä»¤ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it jms_all &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>è®¿é—®æµ‹è¯•<br>ç™»å…¥webç•Œé¢ï¼Œåˆå§‹å¯†ç è´¦å·å‡ä¸ºadmin</p><p><img src="https://img-blog.csdnimg.cn/20210122110648550.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="åç»­ä¸»æœºåˆ—è¡¨é…ç½®ï¼Œç­–ç•¥ï¼Œç”¨æˆ·ç­–ç•¥ç­‰ç›¸å…³æˆªå›¾è¿‡å¤šï¼Œè‡ªå·±ç¢ç£¨å§ã€‚ç½‘ä¸Šæœ‰ç›¸å…³æ–‡æ¡£å¯å‚è€ƒ"><a href="#åç»­ä¸»æœºåˆ—è¡¨é…ç½®ï¼Œç­–ç•¥ï¼Œç”¨æˆ·ç­–ç•¥ç­‰ç›¸å…³æˆªå›¾è¿‡å¤šï¼Œè‡ªå·±ç¢ç£¨å§ã€‚ç½‘ä¸Šæœ‰ç›¸å…³æ–‡æ¡£å¯å‚è€ƒ" class="headerlink" title="åç»­ä¸»æœºåˆ—è¡¨é…ç½®ï¼Œç­–ç•¥ï¼Œç”¨æˆ·ç­–ç•¥ç­‰ç›¸å…³æˆªå›¾è¿‡å¤šï¼Œè‡ªå·±ç¢ç£¨å§ã€‚ç½‘ä¸Šæœ‰ç›¸å…³æ–‡æ¡£å¯å‚è€ƒ"></a>åç»­ä¸»æœºåˆ—è¡¨é…ç½®ï¼Œç­–ç•¥ï¼Œç”¨æˆ·ç­–ç•¥ç­‰ç›¸å…³æˆªå›¾è¿‡å¤šï¼Œè‡ªå·±ç¢ç£¨å§ã€‚ç½‘ä¸Šæœ‰ç›¸å…³æ–‡æ¡£å¯å‚è€ƒ</h4>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dockerä¸‹jumpserverè·³æ¿æœº,å ¡å’æœºè¯¦ç»†éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®©Linuxè™šæ‹Ÿæœºè¿æ¥å®¿ä¸»æœºå¹¶ä¸”èƒ½å¤Ÿä¸Šç½‘</title>
      <link href="posts/2356.html"/>
      <url>posts/2356.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p>ç³»ç»Ÿï¼šcentos7.6<br>1ï¼šè®¾ç½®è™šæ‹Ÿæœºçš„IPåœ°å€<br>[root@localhost ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0<br>TYPE=Ethernet<br>BOOTPROTO=static<br>DEFROUTE=yes<br>PEERDNS=yes<br>PEERROUTES=yes<br>IPV4_FAILURE_FATAL=no<br>IPADDR=192.168.10.101<br>NETMASK=255.255.255.0<br>GATEWAY=192.168.10.254<br>DNS1=192.168.10.254<br>#IPV6INIT=yes<br>#IPV6_AUTOCONF=yes<br>#IPV6_DEFROUTE=yes<br>#IPV6_PEERDNS=yes<br>#IPV6_PEERROUTES=yes<br>#IPV6_FAILURE_FATAL=no<br>#IPV6_ADDR_GEN_MODE=stable-privacy<br>NAME=ens33<br>UUID=53739d53-97dd-47bf-9be1-8dd323d36030<br>DEVICE=ens33<br>ONBOOT=yes</p><p>æ³¨æ„ï¼šè¿™é‡Œçš„ipåœ°å€å¯ä»¥éšæ„è®¾ç½®ï¼Œä½†è¦å’Œåé¢çš„åœ°å€ä¿æŒä¸€è‡´</p><p>2ï¼šå°†è¯¥è™šæ‹Ÿæœºçš„ç½‘å¡è®¾ç½®ä¸ºNATæ¡¥æ¥æ¨¡å¼ï¼Œï¼ˆé»˜è®¤ä¸ºNATæ¨¡å¼ï¼‰</p><p><img src="https://img-blog.csdnimg.cn/20210122094220849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>3ï¼šVMwareä¸­æ‰“å¼€è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ï¼Œè®¾ç½®vmnet8çš„å­ç½‘IPï¼Œè¦å’Œç¬¬ä¸€æ­¥ä¸­ä¿æŒä¸€è‡´<br><img src="https://img-blog.csdnimg.cn/20210122094241410.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>4ï¼šåœ¨ä¸Šå›¾ä¸­æ‰“å¼€vmnet8çš„â€œNATè®¾ç½®â€ï¼Œå°†ç½‘å…³IPæ”¹ä¸º192.168.10.254ï¼Œè¦å’Œç¬¬ä¸€æ­¥ä¸­ä¿æŒä¸€è‡´<br><img src="https://img-blog.csdnimg.cn/20210122094303425.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>5ï¼šä¿®æ”¹æ¡¥æ¥æ¨¡å¼</p><p><img src="https://img-blog.csdnimg.cn/20210122094639316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>6ï¼šåœ¨å®¿ä¸»æœºä¸Šï¼Œç»™vmnet8è®¾ç½®ä¸€ä¸ªIPï¼ŒIPåœ°å€æ˜¯192.168.10.0ç½‘ç»œçš„ï¼Œä¸è¦å’Œå…¶ä»–IPå†²çª</p><p><img src="https://img-blog.csdnimg.cn/20210122094440173.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>7ï¼šåœ¨linuxä¸Šåˆ†åˆ«æµ‹è¯•ä¸å®¿ä¸»æœºvmnet8ï¼Œå’Œäº’è”ç½‘æ˜¯å¦é€šä¿¡<br><img src="https://img-blog.csdnimg.cn/20210122095044381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®©Linuxè™šæ‹Ÿæœºè¿æ¥å®¿ä¸»æœºå¹¶ä¸”èƒ½å¤Ÿä¸Šç½‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>oracleå¸¸ç”¨sqlè¯­å¥é›†åˆ</title>
      <link href="posts/1651.html"/>
      <url>posts/1651.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p>1ã€è¯´æ˜ï¼šåˆ›å»ºæ•°æ®åº“<br>Create DATABASE database-name<br>2ã€è¯´æ˜ï¼šåˆ é™¤æ•°æ®åº“<br>drop database dbname<br>3ã€è¯´æ˜ï¼šå¤‡ä»½sql server<br>â€” åˆ›å»ºå¤‡ä»½æ•°æ®çš„ device<br>USE master<br>EXEC sp_addumpdevice â€˜diskâ€˜, â€˜testBackâ€˜, â€˜c:\mssql7backup\MyNwind_1.datâ€˜<br>â€” å¼€å§‹å¤‡ä»½<br>BACKUP DATABASE pubs TO testBack<br>4ã€è¯´æ˜ï¼šåˆ›å»ºæ–°è¡¨<br>create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],â€¦)<br>æ ¹æ®å·²æœ‰çš„è¡¨åˆ›å»ºæ–°è¡¨ï¼š<br>Aï¼šcreate table tab_new like tab_old (ä½¿ç”¨æ—§è¡¨åˆ›å»ºæ–°è¡¨)<br>Bï¼šcreate table tab_new as select col1,col2â€¦ from tab_old definition only<br>5ã€è¯´æ˜ï¼šåˆ é™¤æ–°è¡¨<br>drop table tabname<br>6ã€è¯´æ˜ï¼šå¢åŠ ä¸€ä¸ªåˆ—<br>Alter table tabname add column col type<br>alter table student add dd char;<br>æ³¨ï¼šåˆ—å¢åŠ åå°†ä¸èƒ½åˆ é™¤ã€‚DB2ä¸­åˆ—åŠ ä¸Šåæ•°æ®ç±»å‹ä¹Ÿä¸èƒ½æ”¹å˜ï¼Œå”¯ä¸€èƒ½æ”¹å˜çš„æ˜¯å¢åŠ varcharç±»å‹çš„é•¿åº¦ã€‚<br>7ã€è¯´æ˜ï¼šæ·»åŠ ä¸»é”®ï¼š Alter table tabname add primary key(col)<br>alter table student add primary key(sno);<br>è¯´æ˜ï¼šåˆ é™¤ä¸»é”®ï¼š Alter table tabname drop primary key(col)<br>Alter table TF_F_USER_RES drop primary key(USER_ID, PARTITION_ID, RES_TYPE_CODE, RES_CODE, START_DATE);<br>8ã€è¯´æ˜ï¼šåˆ›å»ºç´¢å¼•ï¼šcreate [unique] index idxname on tabname(colâ€¦.)<br>åˆ é™¤ç´¢å¼•ï¼šdrop index idxname<br>æ³¨ï¼šç´¢å¼•æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œæƒ³æ›´æ”¹å¿…é¡»åˆ é™¤é‡æ–°å»ºã€‚<br>9ã€è¯´æ˜ï¼šåˆ›å»ºè§†å›¾ï¼šcreate view viewname as select statement<br>åˆ é™¤è§†å›¾ï¼šdrop view viewname<br>10ã€è¯´æ˜ï¼šå‡ ä¸ªç®€å•çš„åŸºæœ¬çš„sqlè¯­å¥<br>é€‰æ‹©ï¼šselect * from table1 where èŒƒå›´<br>æ’å…¥ï¼šinsert into table1(field1,field2) values(value1,value2)<br>åˆ é™¤ï¼šdelete from table1 where èŒƒå›´<br>æ›´æ–°ï¼šupdate table1 set field1=value1 where èŒƒå›´<br>æŸ¥æ‰¾ï¼šselect * from table1 where field1 like â€™%value1%â€™ â€”likeçš„è¯­æ³•å¾ˆç²¾å¦™ï¼ŒæŸ¥èµ„æ–™!<br>æ’åºï¼šselect * from table1 order by field1,field2 [desc]<br>æ€»æ•°ï¼šselect count as totalcount from table1<br>æ±‚å’Œï¼šselect sum(field1) as sumvalue from table1<br>å¹³å‡ï¼šselect avg(field1) as avgvalue from table1<br>æœ€å¤§ï¼šselect max(field1) as maxvalue from table1<br>æœ€å°ï¼šselect min(field1) as minvalue from table1<br>11ã€è¯´æ˜ï¼šå‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯<br>Aï¼š UNION è¿ç®—ç¬¦<br>UNION è¿ç®—ç¬¦é€šè¿‡ç»„åˆå…¶ä»–ä¸¤ä¸ªç»“æœè¡¨ï¼ˆä¾‹å¦‚ TABLE1 å’Œ TABLE2ï¼‰å¹¶æ¶ˆå»è¡¨ä¸­ä»»ä½•é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš UNION ä¸€èµ·ä½¿ç”¨æ—¶ï¼ˆå³ UNION ALLï¼‰ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ´¾ç”Ÿè¡¨çš„æ¯ä¸€è¡Œä¸æ˜¯æ¥è‡ª TABLE1 å°±æ˜¯æ¥è‡ª TABLE2ã€‚<br>Bï¼š EXCEPT è¿ç®—ç¬¦<br>EXCEPT è¿ç®—ç¬¦é€šè¿‡åŒ…æ‹¬æ‰€æœ‰åœ¨ TABLE1 ä¸­ä½†ä¸åœ¨ TABLE2 ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš EXCEPT ä¸€èµ·ä½¿ç”¨æ—¶ (EXCEPT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚<br>Cï¼š INTERSECT è¿ç®—ç¬¦<br>INTERSECT è¿ç®—ç¬¦é€šè¿‡åªåŒ…æ‹¬ TABLE1 å’Œ TABLE2 ä¸­éƒ½æœ‰çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš INTERSECT ä¸€èµ·ä½¿ç”¨æ—¶ (INTERSECT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚<br>æ³¨ï¼šä½¿ç”¨è¿ç®—è¯çš„å‡ ä¸ªæŸ¥è¯¢ç»“æœè¡Œå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚<br>12ã€è¯´æ˜ï¼šä½¿ç”¨å¤–è¿æ¥<br>Aã€left outer joinï¼š<br>å·¦å¤–è¿æ¥ï¼ˆå·¦è¿æ¥ï¼‰ï¼šç»“æœé›†å‡ åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œä¹ŸåŒ…æ‹¬å·¦è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚<br>SQL: select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c<br>Bï¼šright outer join:<br>å³å¤–è¿æ¥(å³è¿æ¥)ï¼šç»“æœé›†æ—¢åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¿æ¥è¡Œï¼Œä¹ŸåŒ…æ‹¬å³è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚<br>Cï¼šfull outer joinï¼š<br>å…¨å¤–è¿æ¥ï¼šä¸ä»…åŒ…æ‹¬ç¬¦å·è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œè¿˜åŒ…æ‹¬ä¸¤ä¸ªè¿æ¥è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</p><p>äºŒã€æå‡</p><p>1ã€è¯´æ˜ï¼šå¤åˆ¶è¡¨(åªå¤åˆ¶ç»“æ„,æºè¡¨åï¼ša æ–°è¡¨åï¼šb) (Accesså¯ç”¨)<br>æ³•ä¸€ï¼šselect * into b from a where 1&lt;&gt;1<br>æ³•äºŒï¼šselect top 0 * into b from a<br>2ã€è¯´æ˜ï¼šæ‹·è´è¡¨(æ‹·è´æ•°æ®,æºè¡¨åï¼ša ç›®æ ‡è¡¨åï¼šb) (Accesså¯ç”¨)<br>insert into b(a, b, c) select d,e,f from b;</p><p>3ã€è¯´æ˜ï¼šè·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´(å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„) (Accesså¯ç”¨)<br>insert into b(a, b, c) select d,e,f from b in â€˜å…·ä½“æ•°æ®åº“â€™ where æ¡ä»¶<br>ä¾‹å­ï¼šâ€¦from b in â€˜â€œ&amp;Server.MapPath(â€œ.â€&amp;â€\data.mdbâ€ &amp;â€â€˜ whereâ€¦</p><p>4ã€è¯´æ˜ï¼šå­æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)<br>select a,b,c from a where a IN (select d from b æˆ–è€…: select a,b,c from a where a IN (1,2,3)</p><p>5ã€è¯´æ˜ï¼šæ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´<br>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b</p><p>6ã€è¯´æ˜ï¼šå¤–è¿æ¥æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)<br>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c</p><p>7ã€è¯´æ˜ï¼šåœ¨çº¿è§†å›¾æŸ¥è¯¢(è¡¨å1ï¼ša<br>select * from (Select a,b,c FROM a) T where t.a &gt; 1;</p><p>8ã€è¯´æ˜ï¼šbetweençš„ç”¨æ³•,betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼,not betweenä¸åŒ…æ‹¬<br>select * from table1 where time between time1 and time2<br>select a,b,c, from table1 where a not between æ•°å€¼1 and æ•°å€¼2</p><p>9ã€è¯´æ˜ï¼šin çš„ä½¿ç”¨æ–¹æ³•<br>select * from table1 where a [not] in (â€˜å€¼1â€™,â€™å€¼2â€™,â€™å€¼4â€™,â€™å€¼6â€™)</p><p>10ã€è¯´æ˜ï¼šä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯<br>delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1</p><p>11ã€è¯´æ˜ï¼šå››è¡¨è”æŸ¥é—®é¢˜ï¼š<br>select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where â€¦</p><p>12ã€è¯´æ˜ï¼šæ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’<br>SQL: select * from æ—¥ç¨‹å®‰æ’ where datediff(â€˜minuteâ€˜,få¼€å§‹æ—¶é—´,getdate())&gt;5</p><p>13ã€è¯´æ˜ï¼šä¸€æ¡sql è¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ<br>select top 10 b.* from (select top 20 ä¸»é”®å­—æ®µ,æ’åºå­—æ®µ from è¡¨å order by æ’åºå­—æ®µ desc) a,è¡¨å b where b.ä¸»é”®å­—æ®µ = a.ä¸»é”®å­—æ®µ order by a.æ’åºå­—æ®µ</p><p>14ã€è¯´æ˜ï¼šå‰10æ¡è®°å½•<br>select top 10 * form table1 where èŒƒå›´</p><p>15ã€è¯´æ˜ï¼šé€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯(ç±»ä¼¼è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ,æ¯æœˆçƒ­é”€äº§å“åˆ†æ,æŒ‰ç§‘ç›®æˆç»©æ’å,ç­‰ç­‰.)<br>select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)</p><p>16ã€è¯´æ˜ï¼šåŒ…æ‹¬æ‰€æœ‰åœ¨ TableA ä¸­ä½†ä¸åœ¨ TableBå’ŒTableC ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨<br>(select a from tableA except (select a from tableB) except (select a from tableC)</p><p>17ã€è¯´æ˜ï¼šéšæœºå–å‡º10æ¡æ•°æ®<br>select top 10 * from tablename order by newid()</p><p>18ã€è¯´æ˜ï¼šéšæœºé€‰æ‹©è®°å½•<br>select newid()</p><p>19ã€è¯´æ˜ï¼šåˆ é™¤é‡å¤è®°å½•<br>Delete from tablename where id not in (select max(id) from tablename group by col1,col2,â€¦)</p><p>20ã€è¯´æ˜ï¼šåˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å<br>select name from sysobjects where type=â€˜Uâ€˜</p><p>21ã€è¯´æ˜ï¼šåˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„<br>select name from syscolumns where id=object_id(â€˜TableNameâ€˜)</p><p>22ã€è¯´æ˜ï¼šåˆ—ç¤ºtypeã€venderã€pcså­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼select ä¸­çš„caseã€‚<br>select type,sum(case vender when â€˜Aâ€˜ then pcs else 0 end),sum(case vender when â€˜Câ€˜ then pcs else 0 end),sum(case vender when â€˜Bâ€˜ then pcs else 0 end) FROM tablename group by type<br>æ˜¾ç¤ºç»“æœï¼š<br>type vender pcs<br>ç”µè„‘ A 1<br>ç”µè„‘ A 1<br>å…‰ç›˜ B 2<br>å…‰ç›˜ A 2<br>æ‰‹æœº B 3<br>æ‰‹æœº C 3</p><p>23ã€è¯´æ˜ï¼šåˆå§‹åŒ–è¡¨table1</p><p>TRUNCATE TABLE table1</p><p>24ã€è¯´æ˜ï¼šé€‰æ‹©ä»10åˆ°15çš„è®°å½•<br>select top 5 * from (select top 15 * from table order by id asc) table_åˆ«å order by id desc</p><p>ä¸‰ã€æŠ€å·§</p><p>1ã€1=1ï¼Œ1=2çš„ä½¿ç”¨ï¼Œåœ¨SQLè¯­å¥ç»„åˆæ—¶ç”¨çš„è¾ƒå¤š</p><p>â€œwhere 1=1â€æ˜¯è¡¨ç¤ºé€‰æ‹©å…¨éƒ¨â€œwhere 1=2â€å…¨éƒ¨ä¸é€‰ï¼Œ<br>å¦‚ï¼š<br>if @strWhere !=â€˜<br>begin<br>set @strSQL = â€˜select count() as Total from [â€˜ + @tblName + â€˜] where â€˜ + @strWhere<br>end<br>else<br>begin<br>set @strSQL = â€˜select count() as Total from [â€˜ + @tblName + â€˜]â€˜<br>end</p><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™æˆ<br>set @strSQL = â€˜select count(*) as Total from [â€˜ + @tblName + â€˜] where 1=1 å®‰å®šâ€˜+ @strWhere</p><p>2ã€æ”¶ç¼©æ•°æ®åº“<br>â€“é‡å»ºç´¢å¼•<br>DBCC REINDEX<br>DBCC INDEXDEFRAG<br>â€“æ”¶ç¼©æ•°æ®å’Œæ—¥å¿—<br>DBCC SHRINKDB<br>DBCC SHRINKFILE</p><p>3ã€å‹ç¼©æ•°æ®åº“<br>dbcc shrinkdatabase(dbname)</p><p>4ã€è½¬ç§»æ•°æ®åº“ç»™æ–°ç”¨æˆ·ä»¥å·²å­˜åœ¨ç”¨æˆ·æƒé™<br>exec sp_change_users_login â€˜update_oneâ€˜,â€˜newnameâ€˜,â€˜oldnameâ€˜<br>go</p><p>5ã€æ£€æŸ¥å¤‡ä»½é›†<br>RESTORE VERIFYONLY from disk=â€˜E:\dvbbs.bakâ€˜</p><p>6ã€ä¿®å¤æ•°æ®åº“<br>Alter DATABASE [dvbbs] SET SINGLE_USER<br>GO<br>DBCC CHECKDB(â€˜dvbbsâ€˜,repair_allow_data_loss) WITH TABLOCK<br>GO<br>Alter DATABASE [dvbbs] SET MULTI_USER<br>GO</p><p>7ã€æ—¥å¿—æ¸…é™¤<br>SET NOCOUNT ON<br>DECLARE @LogicalFileName sysname,<br>@MaxMinutes INT,<br>@NewSize INT</p><p>USE tablename â€“ è¦æ“ä½œçš„æ•°æ®åº“å<br>Select @LogicalFileName = â€˜tablename_logâ€˜, â€“ æ—¥å¿—æ–‡ä»¶å<br>@MaxMinutes = 10, â€“ Limit on time allowed to wrap log.<br>@NewSize = 1 â€“ ä½ æƒ³è®¾å®šçš„æ—¥å¿—æ–‡ä»¶çš„å¤§å°(M)</p><p>â€“ Setup / initialize<br>DECLARE @OriginalSize int<br>Select @OriginalSize = size<br>FROM sysfiles<br>Where name = @LogicalFileName<br>Select â€˜Original Size of â€˜ + db_name() + â€˜ LOG is â€˜ +<br>CONVERT(VARCHAR(30),@OriginalSize) + â€˜ 8K pages or â€˜ +<br>CONVERT(VARCHAR(30),(@OriginalSize*8/1024)) + â€˜MBâ€˜<br>FROM sysfiles<br>Where name = @LogicalFileName<br>Create TABLE DummyTrans<br>(DummyColumn char (8000) not null)</p><p>DECLARE @Counter INT,<br>@StartTime DATETIME,<br>@TruncLog VARCHAR(255)<br>Select @StartTime = GETDATE(),<br>@TruncLog = â€˜BACKUP LOG â€˜ + db_name() + â€˜ WITH TRUNCATE_ONLYâ€˜</p><p>DBCC SHRINKFILE (@LogicalFileName, @NewSize)<br>EXEC (@TruncLog)<br>â€“ Wrap the log if necessary.<br>WHILE @MaxMinutes &gt; DATEDIFF (mi, @StartTime, GETDATE()) â€“ time has not expired<br>AND @OriginalSize = (Select size FROM sysfiles Where name = @LogicalFileName)<br>AND (@OriginalSize * 8 /1024) &gt; @NewSize<br>BEGIN â€“ Outer loop.<br>Select @Counter = 0<br>WHILE ((@Counter &lt; @OriginalSize / 16) AND (@Counter &lt; 50000))<br>BEGIN â€“ update<br>Insert DummyTrans VALUES (â€˜Fill Logâ€˜)<br>Delete DummyTrans<br>Select @Counter = @Counter + 1<br>END<br>EXEC (@TruncLog)<br>END<br>Select â€˜Final Size of â€˜ + db_name() + â€˜ LOG is â€˜ +<br>CONVERT(VARCHAR(30),size) + â€˜ 8K pages or â€˜ +<br>CONVERT(VARCHAR(30),(size*8/1024)) + â€˜MBâ€˜<br>FROM sysfiles<br>Where name = @LogicalFileName<br>Drop TABLE DummyTrans<br>SET NOCOUNT OFF</p><p>8ã€è¯´æ˜ï¼šæ›´æ”¹æŸä¸ªè¡¨<br>exec sp_changeobjectowner â€˜tablenameâ€˜,â€˜dboâ€˜</p><p>9ã€å­˜å‚¨æ›´æ”¹å…¨éƒ¨è¡¨</p><p>Create PROCEDURE dbo.User_ChangeObjectOwnerBatch<br>@OldOwner as NVARCHAR(128),<br>@NewOwner as NVARCHAR(128)<br>AS</p><p>DECLARE @Name as NVARCHAR(128)<br>DECLARE @Owner as NVARCHAR(128)<br>DECLARE @OwnerName as NVARCHAR(128)</p><p>DECLARE curObject CURSOR FOR<br>select â€˜Nameâ€˜ = name,<br>â€˜Ownerâ€˜ = user_name(uid)<br>from sysobjects<br>where user_name(uid)=@OldOwner<br>order by name</p><p>OPEN curObject<br>FETCH NEXT FROM curObject INTO @Name, @Owner<br>WHILE(@@FETCH_STATUS=0)<br>BEGIN<br>if @Owner=@OldOwner<br>begin<br>set @OwnerName = @OldOwner + â€˜.â€˜ + rtrim(@Name)<br>exec sp_changeobjectowner @OwnerName, @NewOwner<br>end<br>â€“ select @name,@NewOwner,@OldOwner</p><p>FETCH NEXT FROM curObject INTO @Name, @Owner<br>END</p><p>close curObject<br>deallocate curObject<br>GO</p><p>10ã€SQL SERVERä¸­ç›´æ¥å¾ªç¯å†™å…¥æ•°æ®<br>declare @i int<br>set @i=1<br>while @i&lt;30<br>begin<br>insert into test (userid) values(@i)<br>set @i=@i+1<br>end</p>]]></content>
      
      
      <categories>
          
          <category> oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracleå¸¸ç”¨sqlè¯­å¥é›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³oracleä¸èƒ½ä¸Šä¸‹ç®­å¤´ç¿»å†å²å‘½ä»¤é—®é¢˜</title>
      <link href="posts/3246.html"/>
      <url>posts/3246.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h3 id="è§£å†³å‘½ä»¤è¡Œä¸­ä¸Šä¸‹é”®ä¸èƒ½ç¿»å†å²å‘½ä»¤çš„é—®é¢˜"><a href="#è§£å†³å‘½ä»¤è¡Œä¸­ä¸Šä¸‹é”®ä¸èƒ½ç¿»å†å²å‘½ä»¤çš„é—®é¢˜" class="headerlink" title="è§£å†³å‘½ä»¤è¡Œä¸­ä¸Šä¸‹é”®ä¸èƒ½ç¿»å†å²å‘½ä»¤çš„é—®é¢˜"></a>è§£å†³å‘½ä»¤è¡Œä¸­ä¸Šä¸‹é”®ä¸èƒ½ç¿»å†å²å‘½ä»¤çš„é—®é¢˜</h3><p>å®‰è£…è¿‡ç¨‹ï¼š<br>å°†è½¯ä»¶æ‹·è´åˆ°/rootä¸‹<br>æŒ‚è½½å…‰ç›˜åˆ°/media/mntä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#mkdir &#x2F;media&#x2F;mnt</span><br><span class="line">#mount &#x2F;dev&#x2F;cdrom &#x2F;media&#x2F;cdrom</span><br><span class="line">#vim &#x2F;etc&#x2F;yum.repos.d&#x2F;test.repo</span><br><span class="line">[aaa]</span><br><span class="line">name&#x3D;aaa</span><br><span class="line">baseurl&#x3D;file:&#x2F;&#x2F;&#x2F;media&#x2F;cdrom&#x2F;</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgcheck&#x3D;0</span><br></pre></td></tr></table></figure><p>æ·»åŠ æœ¬åœ°yumæº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle ~]## yum -y install readline*</span><br><span class="line">[root@oracle ~]# cd &#x2F;opt</span><br><span class="line">[root@oracle opt]# tar zxvf rlwrap-0.42.tar.gz</span><br><span class="line">[root@oracle opt]# cd rlwrap-0.42&#x2F;</span><br><span class="line">[root@oracle rlwrap-0.42]# .&#x2F;configure &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ rlwarp äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle rlwrap-0.42]# su oracle</span><br><span class="line">[oracle@oracle rlwrap-0.42]$ vi ~oracle&#x2F;.bash_profile</span><br><span class="line">[oracle@oracle rlwrap-0.42]$ vi ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure><p>åœ¨æœ«å°¾æ·»åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias sqlplus&#x3D;&#39;rlwrap sqlplus&#39;</span><br><span class="line">alias rman&#x3D;&#39;rlwrap rman&#39;</span><br><span class="line">alias lsnrctl&#x3D;&#39;rlwrap lsnrctl&#39;</span><br></pre></td></tr></table></figure><p>ä¿å­˜é€€å‡º<br>ä½¿æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle opt]$ source ~oracle&#x2F;.bash_profile</span><br><span class="line">[oracle@oracle rlwrap-0.42]$ source ~oracle&#x2F;.bashrc </span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œrlwrapåï¼Œæœ‰äº›å¯èƒ½ä½¿ç”¨SecureCRTä¼šå†æ¬¡å‡ºç°ä¹±ç ï¼Œè¿™æ˜¯ä¿®æ”¹ä¸€ä¸‹SecureCRTçš„å­—ç¬¦ç¼–ç ï¼š<br>ã€é€‰é¡¹ã€‘-&gt;ã€ä¼šè¯é€‰é¡¹ã€‘-&gt;ã€ç»ˆç«¯ã€‘-&gt;ã€å¤–è§‚ã€‘+</p>]]></content>
      
      
      <categories>
          
          <category> oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è§£å†³oracleä¸èƒ½ä¸Šä¸‹ç®­å¤´ç¿»å†å²å‘½ä»¤é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker pull &amp; docker search æŠ¥é”™ï¼šindex.docker.io i/o timeout</title>
      <link href="posts/8546.html"/>
      <url>posts/8546.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h2 id="docker-pull-amp-amp-docker-searchå‡ºç°ï¼šError-response-from-daemon-Get-https-index-docker-io-v1-search-q-nginx-amp-n-25-dial-tcp-lookup-index-docker-io-on-172-16-16-2-53-read-udp-172-16-16-23-44580-gt-172-16-16-2-53-i-o-timeoutæ­¤ç±»æŠ¥é”™"><a href="#docker-pull-amp-amp-docker-searchå‡ºç°ï¼šError-response-from-daemon-Get-https-index-docker-io-v1-search-q-nginx-amp-n-25-dial-tcp-lookup-index-docker-io-on-172-16-16-2-53-read-udp-172-16-16-23-44580-gt-172-16-16-2-53-i-o-timeoutæ­¤ç±»æŠ¥é”™" class="headerlink" title="docker pull &amp;&amp; docker searchå‡ºç°ï¼šError response from daemon: Get https://index.docker.io/v1/search?q=nginx&amp;n=25: dial tcp: lookup index.docker.io on 172.16.16.2:53: read udp 172.16.16.23:44580-&gt;172.16.16.2:53: i/o timeoutæ­¤ç±»æŠ¥é”™"></a>docker pull &amp;&amp; docker searchå‡ºç°ï¼šError response from daemon: Get <a href="https://index.docker.io/v1/search?q=nginx&amp;n=25">https://index.docker.io/v1/search?q=nginx&amp;n=25</a>: dial tcp: lookup index.docker.io on 172.16.16.2:53: read udp 172.16.16.23:44580-&gt;172.16.16.2:53: i/o timeoutæ­¤ç±»æŠ¥é”™</h2><p>å¦‚å›¾ï¼š<img src="https://img-blog.csdnimg.cn/20201103172930131.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="è§£å†³æ–¹æ³•ä¸€ï¼š"><a href="#è§£å†³æ–¹æ³•ä¸€ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ä¸€ï¼š"></a>è§£å†³æ–¹æ³•ä¸€ï¼š</h3><p>è¿™ä¸ªæ˜¯å› ä¸ºdnsåŸŸåæ²¡æœ‰è§£æçš„åŸå› ï¼Œç¼–è¾‘/etc/resolv.conf æ–‡ä»¶ï¼Œå¢åŠ ä¸€è¡Œdnsåœ°å€ï¼Œä¾‹å¦‚ï¼šnameserver 8.8.4.4<br>ç±»ä¼¼è¿™ç§ï¼š<br><img src="https://img-blog.csdnimg.cn/20201103173056479.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="è§£å†³æ–¹æ³•äºŒï¼š"><a href="#è§£å†³æ–¹æ³•äºŒï¼š" class="headerlink" title="è§£å†³æ–¹æ³•äºŒï¼š"></a>è§£å†³æ–¹æ³•äºŒï¼š</h3><p>ä¹Ÿå¯ç›´æ¥åœ¨hostsæ–‡ä»¶é‡Œæ·»åŠ è§£æï¼Œä» digè¿”å›çš„ipéšä¾¿é€‰ä¸ªåŠ è¿›hostsæ–‡ä»¶ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# dig @114.114.114.114 index.docker.io</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201103173414634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20201103173709440.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶ååœ¨è¿›è¡Œdocker pull &amp; docker searchå°±å¯ä»¥äº†</p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dockeræŠ¥é”™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxå®‰è£…oracle10Gè‡ªå¯åŠ¨å®ä¾‹ç›‘å¬</title>
      <link href="posts/6514.html"/>
      <url>posts/6514.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p>å®‰è£…ç¯å¢ƒ:<br>è¿™é‡Œåœ¨vmwareé‡Œè™šæ‹Ÿçš„RHEL5ï¼Œåˆ†é…çš„å†…å­˜1Gï¼ŒSWAPåˆ†åŒº1Gï¼Œå»ºè®®æœ€å¥½æŠŠSWAPåˆ†åŒºæ”¹æˆ2Gã€‚å¦åˆ™å®‰è£…æ—¶ï¼Œåˆ°äº†æµ‹è¯•çš„æ­¥éª¤ä¼šæç¤ºç›‘æµ‹å¤±è´¥ã€‚ï¼ˆå½“ç„¶ï¼Œå¦‚æœä½ å¼ºè¡Œå®‰è£…ä¸€æ ·æ²¡é—®é¢˜ï¼‰</p><h3 id="å®‰è£…Oracle-10g-Release2-å‰çš„é…ç½®"><a href="#å®‰è£…Oracle-10g-Release2-å‰çš„é…ç½®" class="headerlink" title="å®‰è£…Oracle 10g Release2 å‰çš„é…ç½®"></a>å®‰è£…Oracle 10g Release2 å‰çš„é…ç½®</h3><h5 id="1-é¦–å…ˆæŒ‚åœ¨å…‰ç›˜ï¼Œå®‰è£…Oracle-10g-R2æ‰€éœ€çš„è½¯ä»¶åŒ…"><a href="#1-é¦–å…ˆæŒ‚åœ¨å…‰ç›˜ï¼Œå®‰è£…Oracle-10g-R2æ‰€éœ€çš„è½¯ä»¶åŒ…" class="headerlink" title="1. é¦–å…ˆæŒ‚åœ¨å…‰ç›˜ï¼Œå®‰è£…Oracle 10g R2æ‰€éœ€çš„è½¯ä»¶åŒ…"></a>1. é¦–å…ˆæŒ‚åœ¨å…‰ç›˜ï¼Œå®‰è£…Oracle 10g R2æ‰€éœ€çš„è½¯ä»¶åŒ…</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># mkdir &#x2F;mnt&#x2F;cdrom</span><br><span class="line"># mount &#x2F;dev&#x2F;cdrom &#x2F;mnt&#x2F;cdrom</span><br><span class="line"># cd &#x2F;mnt&#x2F;cdrom&#x2F;Server&#x2F;</span><br><span class="line"># rpm -Uvh setarch-2*</span><br><span class="line"># rpm -Uvh make-3*</span><br><span class="line"># rpm -Uvh glibc-2*</span><br><span class="line"># rpm -Uvh libaio-0*</span><br><span class="line"># rpm -Uvh compat-libstdc++-33-3*</span><br><span class="line"># rpm -Uvh compat-gcc-34-3*</span><br><span class="line"># rpm -Uvh compat-gcc-34-c++-3*</span><br><span class="line"># rpm -Uvh gcc-4*</span><br><span class="line"># rpm -Uvh libXp-1*</span><br><span class="line"># rpm -Uvh openmotif22-*</span><br><span class="line"># rpm -Uvh compat-db-4*</span><br></pre></td></tr></table></figure><p>å…¶ä¸­é™¤äº†openmotif22-2.2.3-18å’Œcompat-db-4.2.52-5.1åœ¨ç¬¬ä¸‰å¼ ç›˜ä¸Šï¼Œå…¶ä½™çš„åŒ…éƒ½åœ¨ç¬¬ä¸€å¼ ç›˜ä¸Šã€‚</p><h5 id="2-ä¿®æ”¹-etc-redhat-releaseæ–‡ä»¶"><a href="#2-ä¿®æ”¹-etc-redhat-releaseæ–‡ä»¶" class="headerlink" title="2.ä¿®æ”¹/etc/redhat-releaseæ–‡ä»¶"></a>2.ä¿®æ”¹/etc/redhat-releaseæ–‡ä»¶</h5><p>å› ä¸ºOracle 10gå®˜æ–¹åªæ”¯æŒåˆ°RHEL4ä¸ºæ­¢ï¼Œæ‰€ä»¥éœ€è¦æ›´æ”¹ç‰ˆæœ¬è¯´æ˜ï¼Œç¼–è¾‘/etc/redhat-releaseæ–‡ä»¶,åˆ é™¤Red Hat Enterprise Linux Server release 5 (Tikanga)ï¼Œæ”¹ä¸ºredhat-4</p><h5 id="3-ä¿®æ”¹å†…æ ¸å‚æ•°"><a href="#3-ä¿®æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="3.ä¿®æ”¹å†…æ ¸å‚æ•°"></a>3.ä¿®æ”¹å†…æ ¸å‚æ•°</h5><p>#vim /etc/sysctl.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kernel.shmmni &#x3D; 4096</span><br><span class="line">kernel.sem &#x3D; 250 32000 100 128</span><br><span class="line">fs.file-max &#x3D; 65536</span><br><span class="line">net.ipv4.ip_local_port_range &#x3D; 1024 65000</span><br><span class="line">net.core.rmem_default&#x3D;262144</span><br><span class="line">net.core.rmem_max&#x3D;262144</span><br><span class="line">net.core.wmem_default&#x3D;262144</span><br><span class="line">net.core.wmem_max&#x3D;262144</span><br></pre></td></tr></table></figure><p>ä½¿æ›´æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><p>#sysctl -p</p><h5 id="4-å»ºç«‹å®‰è£…Oracleéœ€è¦çš„ç”¨æˆ·ï¼Œç»„ï¼ŒåŠç›®å½•"><a href="#4-å»ºç«‹å®‰è£…Oracleéœ€è¦çš„ç”¨æˆ·ï¼Œç»„ï¼ŒåŠç›®å½•" class="headerlink" title="4.å»ºç«‹å®‰è£…Oracleéœ€è¦çš„ç”¨æˆ·ï¼Œç»„ï¼ŒåŠç›®å½•"></a>4.å»ºç«‹å®‰è£…Oracleéœ€è¦çš„ç”¨æˆ·ï¼Œç»„ï¼ŒåŠç›®å½•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#groupadd oinstall</span><br><span class="line">#groupadd dba</span><br><span class="line">#groupadd oper</span><br><span class="line">#useradd -g oinstall -G dba oracle</span><br><span class="line">#passwd oracle</span><br><span class="line"></span><br><span class="line">#mkdir &#x2F;oracle</span><br><span class="line">#chown -R oracle:oinstall &#x2F;oracle</span><br><span class="line">#chmod -R 775 &#x2F;oracle</span><br></pre></td></tr></table></figure><p>å®‰è£…oracleçš„ç›®å½•å»ºè®®å®‰è£…åœ¨ä¸€ä¸ªå•ç‹¬çš„åˆ†åŒºæˆ–è€…ç£ç›˜ä¸Šã€‚</p><h5 id="5-è®¾ç½®oracleç”¨æˆ·çš„shell-limit"><a href="#5-è®¾ç½®oracleç”¨æˆ·çš„shell-limit" class="headerlink" title="5.è®¾ç½®oracleç”¨æˆ·çš„shell limit"></a>5.è®¾ç½®oracleç”¨æˆ·çš„shell limit</h5><p>#vi /etc/security/limits.conf    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">oracle soft nofile 1024</span><br><span class="line">oracle hard nofile 65536</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ›´æ”¹/etc/pam.d/loginæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼Œä½¿shell limitç”Ÿæ•ˆï¼š</p><p>#vi /etc/pam.d/login</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session                  required                pam_limits.so</span><br></pre></td></tr></table></figure><h5 id="6-é…ç½®IPåœ°å€"><a href="#6-é…ç½®IPåœ°å€" class="headerlink" title="6.é…ç½®IPåœ°å€"></a>6.é…ç½®IPåœ°å€</h5><p>å®‰è£…RHELçš„æ—¶å€™æœ€å¥½é‡‡ç”¨é™æ€IPåœ°å€ï¼Œå¦‚æœå½“æ—¶é€‰æ‹©çš„æ˜¯DHCPï¼Œç°åœ¨éœ€è¦æ›´æ”¹/etc/sysconfig/network-scripts/ifcfg-eth0æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@TSM54-Test network-scripts]# cat ifcfg-eth0</span><br><span class="line"># Advanced Micro Devices [AMD] 79c970 [PCnet32 LANCE]</span><br><span class="line">DEVICE&#x3D;eth0</span><br><span class="line">BOOTPROTO&#x3D;static</span><br><span class="line">HWADDR&#x3D;00:0C:29:4B:17:C4</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">IPADDR&#x3D;192.168.68.98</span><br><span class="line">NETMASK&#x3D;255.255.255.0</span><br><span class="line">GATEWAY&#x3D;192.168.68.10</span><br></pre></td></tr></table></figure><h5 id="7-é…ç½®oracleç”¨æˆ·çš„ç¯å¢ƒå˜é‡"><a href="#7-é…ç½®oracleç”¨æˆ·çš„ç¯å¢ƒå˜é‡" class="headerlink" title="7.é…ç½®oracleç”¨æˆ·çš„ç¯å¢ƒå˜é‡"></a>7.é…ç½®oracleç”¨æˆ·çš„ç¯å¢ƒå˜é‡</h5><p>ä¸‹é¢çš„æ“ä½œï¼Œè¯¥ç”¨oracleç”¨æˆ·ç™»é™†æ‰§è¡Œäº†ã€‚</p><p>ä¸ºäº†é˜²æ­¢å®‰è£…oracleæ—¶å‡ºç°ä¹±ç ï¼Œå…ˆæŠŠè¯­è¨€ç¯å¢ƒæ”¹ä¸ºè‹±æ–‡,åœ¨ç»ˆç«¯é‡Œè¾“å…¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@TSM54-TEST ~]$export LC_CTYPE&#x3D;en_US.UTF-8</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œç¼–è¾‘/home/oracleç›®å½•ä¸‹çš„.bash_profileæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export ORACLE_BASE&#x3D;&#x2F;oracle</span><br><span class="line">export ORACLE_HOME&#x3D;$ORACLE_BASE&#x2F;product&#x2F;10.2.0&#x2F;db_1</span><br><span class="line">export ORACLE_SID&#x3D;orcl</span><br><span class="line">export PATH&#x3D;$PATH:$ORACLE_HOME&#x2F;bin</span><br><span class="line">export LD_LIBRARY_PATH&#x3D;$ORACLE_HOME&#x2F;lib:&#x2F;lib:&#x2F;usr&#x2F;lib</span><br><span class="line">CLASSPATH&#x3D;$ORACLE_HOME&#x2F;JRE:$ORACLE_HOME&#x2F;jlib:$ORACLE_HOME&#x2F;rdbms&#x2F;jlib</span><br><span class="line">export CLASSPATH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ $USER &#x3D; &quot;oracle&quot; ]; then</span><br><span class="line">        if [ $SHELL &#x3D; &quot;&#x2F;bin&#x2F;ksh&quot; ]; then</span><br><span class="line">                ulimit -p 16384</span><br><span class="line">                ulimit -n 65536</span><br><span class="line">        else</span><br><span class="line">                ulimit -u 16384 -n 65536</span><br><span class="line">        fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="å¯ä»¥ç”¨oracleç”¨æˆ·ç™»é™†è¿›å…¥ç³»ç»Ÿå®‰è£…ï¼Œæˆ–è€…ç”¨ç¬¬ä¸‰æ–¹å·¥å…·xmanager"><a href="#å¯ä»¥ç”¨oracleç”¨æˆ·ç™»é™†è¿›å…¥ç³»ç»Ÿå®‰è£…ï¼Œæˆ–è€…ç”¨ç¬¬ä¸‰æ–¹å·¥å…·xmanager" class="headerlink" title="å¯ä»¥ç”¨oracleç”¨æˆ·ç™»é™†è¿›å…¥ç³»ç»Ÿå®‰è£…ï¼Œæˆ–è€…ç”¨ç¬¬ä¸‰æ–¹å·¥å…·xmanager"></a>å¯ä»¥ç”¨oracleç”¨æˆ·ç™»é™†è¿›å…¥ç³»ç»Ÿå®‰è£…ï¼Œæˆ–è€…ç”¨ç¬¬ä¸‰æ–¹å·¥å…·xmanager</h3><h5 id="ç„¶åå®‰è£…Xmanager-å¯åŠ¨Xstart-åœ¨HOSTå¡«å†™LINUXçš„IPåœ°å€ï¼Œé€‰æ‹©SSHåè®®ï¼Œç”¨æˆ·åå’Œå¯†ç ä¸LINUXç™»é™†ä¸€æ ·ï¼Œé€‰æ‹©ç”¨æˆ·ç•Œé¢ï¼Œåœ¨Command-ä¸‹é€‰æ‹©GNOME-æˆ‘çš„æ˜¯GNOME-ï¼Œæœ€åRUNï¼Œç„¶åæ‰“å¼€Xshell-å°±èƒ½å¤Ÿè¿œç¨‹æ§åˆ¶LINUXäº†"><a href="#ç„¶åå®‰è£…Xmanager-å¯åŠ¨Xstart-åœ¨HOSTå¡«å†™LINUXçš„IPåœ°å€ï¼Œé€‰æ‹©SSHåè®®ï¼Œç”¨æˆ·åå’Œå¯†ç ä¸LINUXç™»é™†ä¸€æ ·ï¼Œé€‰æ‹©ç”¨æˆ·ç•Œé¢ï¼Œåœ¨Command-ä¸‹é€‰æ‹©GNOME-æˆ‘çš„æ˜¯GNOME-ï¼Œæœ€åRUNï¼Œç„¶åæ‰“å¼€Xshell-å°±èƒ½å¤Ÿè¿œç¨‹æ§åˆ¶LINUXäº†" class="headerlink" title="ç„¶åå®‰è£…Xmanager,å¯åŠ¨Xstart åœ¨HOSTå¡«å†™LINUXçš„IPåœ°å€ï¼Œé€‰æ‹©SSHåè®®ï¼Œç”¨æˆ·åå’Œå¯†ç ä¸LINUXç™»é™†ä¸€æ ·ï¼Œé€‰æ‹©ç”¨æˆ·ç•Œé¢ï¼Œåœ¨Command ä¸‹é€‰æ‹©GNOME  æˆ‘çš„æ˜¯GNOME ï¼Œæœ€åRUNï¼Œç„¶åæ‰“å¼€Xshell å°±èƒ½å¤Ÿè¿œç¨‹æ§åˆ¶LINUXäº†"></a>ç„¶åå®‰è£…Xmanager,å¯åŠ¨Xstart åœ¨HOSTå¡«å†™LINUXçš„IPåœ°å€ï¼Œé€‰æ‹©SSHåè®®ï¼Œç”¨æˆ·åå’Œå¯†ç ä¸LINUXç™»é™†ä¸€æ ·ï¼Œé€‰æ‹©ç”¨æˆ·ç•Œé¢ï¼Œåœ¨Command ä¸‹é€‰æ‹©GNOME  æˆ‘çš„æ˜¯GNOME ï¼Œæœ€åRUNï¼Œç„¶åæ‰“å¼€Xshell å°±èƒ½å¤Ÿè¿œç¨‹æ§åˆ¶LINUXäº†</h5><h3 id="å®‰è£…Oracle-10g"><a href="#å®‰è£…Oracle-10g" class="headerlink" title="å®‰è£…Oracle 10g"></a>å®‰è£…Oracle 10g</h3><p>æˆ‘æŠŠ10201_database_linux32.zipæ”¾åœ¨/optç›®å½•ä¸‹ï¼Œå¹¶é€šè¿‡</p><p>#unzip 10201_database_linux32.zipè§£å‹ï¼Œç°åœ¨ä½¿ç”¨oracleç”¨æˆ·åˆ°/opt/databaseç›®å½•ä¸‹æ‰§è¡Œå®‰è£…:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[oracle@TSM54-Test opt]$ cd &#x2F;opt&#x2F;database&#x2F;</span><br><span class="line">[oracle@TSM54-Test database]$ ls</span><br><span class="line">doc install response runInstaller stage welcome.html</span><br><span class="line">[oracle@TSM54-Test database]$ .&#x2F;runInstaller</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®è‡ªå·±çœŸå®ç¯å¢ƒé€šè¿‡å›¾å½¢åŒ–ç•Œé¢å®‰è£…oracle10g<br>è¿™é‡Œæš‚æ—¶ä¸åšå¤šä½™è¯´æ˜ï¼Œåç»­ä¼šå°†å›¾æ”¾ä¸Šæ¥</p><h3 id="æ•°æ®åº“çš„å¯åŠ¨"><a href="#æ•°æ®åº“çš„å¯åŠ¨" class="headerlink" title="æ•°æ®åº“çš„å¯åŠ¨"></a>æ•°æ®åº“çš„å¯åŠ¨</h3><p>å¯åŠ¨è¿‡ç¨‹åˆ†ä¸ºï¼šå¯åŠ¨å®ä¾‹ã€ç”±å®ä¾‹è£…è½½æ•°æ®åº“ã€æ‰“å¼€æ•°æ®åº“<br>SQL&gt; startup nomount<br>åªå¯åŠ¨å®ä¾‹</p><p>SQL&gt; startup mount<br>å¯åŠ¨å®ä¾‹ï¼Œå¹¶åŠ è½½æ•°æ®åº“ï¼Œä½†ä¸æ‰“å¼€æ•°æ®åº“</p><p>SQL&gt; startup<br>å¯åŠ¨å®ä¾‹ã€ç”±å®ä¾‹è£…è½½æ•°æ®åº“ã€æ‰“å¼€æ•°æ®åº“</p><p>SQL&gt; alter database mount;<br>å¦‚æœä½¿ç”¨startup nomountå¯åŠ¨å®ä¾‹ï¼Œå¯ä»¥ç”¨æ­¤å‘½ä»¤åŠ è½½æ•°æ®åº“ï¼Œä½†ä¸ä¼šå¯åŠ¨æ•°æ®åº“</p><p>SQL&gt; alter database open;<br>å¦‚æœå½“å‰å¤„äºæ•°æ®åº“å·²åŠ è½½çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤æ‰“å¼€æ•°æ®åº“</p><p>9ï¼šå…³é—­æ•°æ®åº“<br>SQL&gt; shutdown normal<br>ç­‰åŒäºç›´æ¥ä½¿ç”¨shutdownå‘½ä»¤ï¼Œ</p><p>SQL&gt; shutdown immediate</p><p>SQL&gt; shutdown transactional</p><p>SQL&gt; shutdown abort</p><p>10ï¼šå¯åŠ¨ä¸å…³é—­ç›‘å¬<br>[oracle@oracle ~]$ lsnrctl start</p><p>[oracle@oracle ~]$ lsnrctl stop</p><p>[oracle@oracle ~]$ lsnrctl </p><p>LSNRCTL for Linux: Version 12.2.0.1.0 - Production on 03-8æœˆ -2018 05:08:52</p><p>Copyright (c) 1991, 2016, Oracle.  All rights reserved.</p><p>æ¬¢è¿æ¥åˆ°LSNRCTL, è¯·é”®å…¥â€helpâ€ä»¥è·å¾—ä¿¡æ¯ã€‚</p><p>LSNRCTL&gt; </p><h3 id="é…ç½®oracleå¼€æœºè‡ªå¯åŠ¨å®ä¾‹ï¼Œç›‘å¬"><a href="#é…ç½®oracleå¼€æœºè‡ªå¯åŠ¨å®ä¾‹ï¼Œç›‘å¬" class="headerlink" title="é…ç½®oracleå¼€æœºè‡ªå¯åŠ¨å®ä¾‹ï¼Œç›‘å¬"></a>é…ç½®oracleå¼€æœºè‡ªå¯åŠ¨å®ä¾‹ï¼Œç›‘å¬</h3><p>1.ä¿®æ”¹/etc/oratabæ–‡ä»¶ï¼Œå°†Næ”¹ä¸ºYå³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#vim &#x2F;etc&#x2F;oratab</span><br><span class="line">#game:&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;10.2.0&#x2F;db_1:Y</span><br><span class="line">--æ ¼å¼ï¼š$ORACLE_SID:$ORACLE_HOME:&lt;N|Y&gt;   </span><br><span class="line">--&lt;N|Y&gt;é€‰é¡¹ä»£è¡¨å¼€æœºæ˜¯å¦è‡ªå¯åŠ¨</span><br><span class="line">--game:&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;10.2.0&#x2F;db_1:N   --dbcaåˆ›å»ºåº“æ—¶æ³¨å†Œçš„é»˜è®¤ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>2.ç¡®è®¤dbstartæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#cd $ORACLE_HOME&#x2F;bin</span><br><span class="line">#ls -ll | grep dbstart</span><br><span class="line">#vim dbstart</span><br><span class="line">--dbstartä¸ºå¼€æœºè‡ªå¯åŠ¨è„šæœ¬ï¼Œè®©ç³»ç»Ÿå¼€æœºå°±å»æ‰§è¡Œdbstartè„šæœ¬æ–‡ä»¶ï¼Œå®ƒä¼šå»è¯»oratabæ–‡ä»¶ï¼Œè¯»åˆ°Yå°±ä¼šæŠŠå¯¹åº”çš„å®ä¾‹å¼€æœºè‡ªå¯åŠ¨</span><br><span class="line"></span><br><span class="line">--è°ƒæ•´æˆ–ç¡®è®¤ç›‘å¬è·¯å¾„ï¼Œå¦‚ORACLE_HOME_LISTNER&#x3D;&#x2F;ade&#x2F;vikrkuma_new&#x2F;oracleæˆ–ORACLE_HOME_LISTNER&#x3D;$ORACLE_HOMEæ ¹æ®è®¾ç½®çš„ç›‘å¬è°ƒæ•´è·¯å¾„</span><br></pre></td></tr></table></figure><p>3.ç¼–è¾‘/etc/rc.d/rc.local</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#vim &#x2F;etc&#x2F;rc.d&#x2F;rc.local #æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œå¯åŠ¨å®ä¾‹ï¼Œå¯åŠ¨ç›‘å¬</span><br><span class="line">su - oracle -c&quot;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;10.2.0&#x2F;db_1&#x2F;bin&#x2F;dbstart&quot;</span><br><span class="line">su - oracle -c&quot;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;10.2.0&#x2F;db_1&#x2F;bin&#x2F;lsnrctl start&quot;</span><br><span class="line">--å‘½ä»¤ä¸­-cä»£è¡¨æ‰§è¡Œè„šæœ¬ï¼Œè„šæœ¬dbstartä¸­æŒ‡å®šå¯åŠ¨çš„å®ä¾‹ï¼Œè„šæœ¬lsnrctlä¸­å¯åŠ¨é…ç½®çš„ç›‘å¬</span><br></pre></td></tr></table></figure><p>å°ç»“ï¼š<br>linuxä¸‹è®¾ç½®å®ä¾‹è‡ªå¯åŠ¨æœ‰å…³è„šæœ¬ï¼š</p><p>oratabï¼šå®ä¾‹æ˜¯å¦è‡ªå¯åŠ¨çš„æ³¨å†Œä¿¡æ¯</p><p>dbstartï¼šå¼€æœºå¯åŠ¨è„šæœ¬æ–‡ä»¶ä¼šè¯»å–oratabä¿¡æ¯</p><p>rc.localï¼šå¼€æœºåç«‹å³è¦åšçš„æ–‡ä»¶</p><p>åˆ°æ­¤ç»“æŸï¼Œæ„‰å¿«çš„å¼€å§‹oracleä¹‹æ—…</p><h4 id="æ•°æ®åº“å¸¸ç”¨sqlè¯­å¥é›†åˆ"><a href="#æ•°æ®åº“å¸¸ç”¨sqlè¯­å¥é›†åˆ" class="headerlink" title="æ•°æ®åº“å¸¸ç”¨sqlè¯­å¥é›†åˆ"></a><a href="https://alexcld.com/posts/1651.html">æ•°æ®åº“å¸¸ç”¨sqlè¯­å¥é›†åˆ</a></h4><h3 id="è§£å†³oracleä¸èƒ½ä¸Šä¸‹ç¿»å†å²å‘½ä»¤é—®é¢˜"><a href="#è§£å†³oracleä¸èƒ½ä¸Šä¸‹ç¿»å†å²å‘½ä»¤é—®é¢˜" class="headerlink" title="è§£å†³oracleä¸èƒ½ä¸Šä¸‹ç¿»å†å²å‘½ä»¤é—®é¢˜"></a><a href="https://alexcld.com/posts/3246.html">è§£å†³oracleä¸èƒ½ä¸Šä¸‹ç¿»å†å²å‘½ä»¤é—®é¢˜</a></h3>]]></content>
      
      
      <categories>
          
          <category> oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linuxå®‰è£…oracle10Gè‡ªå¯åŠ¨å®ä¾‹ç›‘å¬ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-butterflyä½¿ç”¨aplayeråŠ è½½éŸ³ä¹é¡µé¢</title>
      <link href="posts/1564.html"/>
      <url>posts/1564.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p>ç”±äºhexo butterflyä¸»é¢˜ä½œè€…æ²¡æœ‰è¯¦ç»†è¯´æ˜å¦‚ä½•åŠ è½½aplayerï¼Œä¹‹æŒ‡æ˜äº†aplayerå®˜ç½‘æ–‡æ¡£ã€‚ä½†æ˜¯å®˜ç½‘æ–‡æ¡£çš„æ•™ç¨‹æœªå…æœ‰äº›éš¾æ‡‚ï¼ˆå°¤å…¶æ˜¯å¯¹äºæ–°æ‰‹ï¼‰ï¼Œå› ä¸ºç½‘ä¸Šæ‰¾åˆ°çš„å¤§å¤šä¸ºejsåˆ›é€ çš„ä¸»é¢˜ï¼Œè€Œæœ¬ä¸»é¢˜ä½¿ç”¨äº†pugï¼Œæ‰€ä»¥ï¼Œæˆ‘å°†æˆ‘æ‘¸ç´¢çš„ç»éªŒåœ¨æ­¤å…¬å¸ƒï¼Œå¸Œæœ›èƒ½å¸¦ç»™ä½¿ç”¨pugç¼–å†™çš„ä¸»é¢˜çš„æœ‹å‹ä»¬ä¸€äº›å¸®åŠ©</p><p>é¦–å…ˆï¼Œæ‰“å¼€shellï¼ˆwindows cmdï¼‰ï¼Œç„¶åå®šä½åˆ°ä½ åšå®¢çš„æ ¹ç›®å½•ä¸‹<br>æ¥ç€ï¼Œä¾æ¬¡æ‰§è¡Œä¸‰æ¡å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new page music</span><br><span class="line">npm install aplayer</span><br><span class="line">npm install --save hexo-tag-aplayer</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œå‡å¦‚å®‰è£…æˆåŠŸï¼Œåˆ™å¯ä»¥å®šä½åˆ°<br>ä¸»é¢˜ç›®å½•\layout\includes<br>çœ‹çœ‹layout.pugåº”è¯¥å‡ºç°ä»¥ä¸‹å­—æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">head</span><br><span class="line">   include .&#x2F;head.pug</span><br><span class="line">    link(rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;APlayer.min.css&quot;)</span><br><span class="line">    div(id&#x3D;&quot;aplayer&quot;)</span><br><span class="line">    script(src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;radium-bit&#x2F;res@master&#x2F;live2d&#x2F;autoload.js&quot; async)</span><br><span class="line">    script(src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;meting@2&#x2F;dist&#x2F;Meting.min.js&quot; async)</span><br><span class="line"> body</span><br></pre></td></tr></table></figure><p>è‹¥ä¸å­˜åœ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">link(rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;APlayer.min.css&quot;)</span><br><span class="line">div(id&#x3D;&quot;aplayer&quot;)</span><br><span class="line">script(src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;meting@2&#x2F;dist&#x2F;Meting.min.js&quot; async)</span><br></pre></td></tr></table></figure><p>è‹¥ä¸å­˜åœ¨è¯·æ‰‹åŠ¨åŠ ä¸Šã€‚ä¸€å®šè¦æ³¨æ„ç¼©è¿›ä¸ä¸Šè¿°ç»“æ„ä¸€è‡´ï¼å› ä¸ºç¼©è¿›æ˜¯Pugçš„è¡¨è¾¾æ–¹å¼ã€‚<br>æ¥ç€ï¼ŒæŸ¥çœ‹aplayer.pugï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨ã€‚è¯·åˆ›å»ºæ–‡ä»¶å¹¶å¤åˆ¶ä»¥ä¸‹å†…å®¹æ‰‹åŠ¨åŠ ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">link(rel&#x3D;&quot;stylesheet&quot; type&#x3D;&#39;text&#x2F;css&#39;, href&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;aplayer@1.10&#x2F;dist&#x2F;APlayer.min.css&quot;)</span><br><span class="line">script(type&#x3D;&#39;text&#x2F;javascript&#39;, src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;aplayer@1.10&#x2F;dist&#x2F;APlayer.min.js&quot;)</span><br><span class="line">script(type&#x3D;&#39;text&#x2F;javascript&#39;, src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;meting@1.2&#x2F;dist&#x2F;Meting.min.js&quot;)</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œè¿”å›åšå®¢æ ¹ç›®å½•ï¼ŒæŸ¥çœ‹_config.ymlåœ¨æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#aplayer</span><br><span class="line">aplayer: </span><br><span class="line">  script_dir: js                      # Public ç›®å½•ä¸‹è„šæœ¬ç›®å½•è·¯å¾„ï¼Œé»˜è®¤: &#39;assets&#x2F;js&#39;</span><br><span class="line">  style_dir: css                         # Public ç›®å½•ä¸‹æ ·å¼ç›®å½•è·¯å¾„ï¼Œé»˜è®¤: &#39;assets&#x2F;css&#39;</span><br><span class="line">  #cdn: http:&#x2F;&#x2F;xxx&#x2F;aplayer.min.js                # å¼•ç”¨ APlayer.js å¤–éƒ¨ CDN åœ°å€ (é»˜è®¤ä¸å¼€å¯)</span><br><span class="line">  #style_cdn: http:&#x2F;&#x2F;xxx&#x2F;aplayer.min.css         # å¼•ç”¨ APlayer.css å¤–éƒ¨ CDN åœ°å€ (é»˜è®¤ä¸å¼€å¯)</span><br><span class="line">  meting: true                                  # MetingJS æ”¯æŒ</span><br><span class="line">  #meting_api: http:&#x2F;&#x2F;xxx&#x2F;api.php                # è‡ªå®šä¹‰ Meting API åœ°å€</span><br><span class="line">  #meting_cdn: http:&#x2F;&#x2F;xxx&#x2F;Meing.min.js           # å¼•ç”¨ Meting.js å¤–éƒ¨ CDN åœ°å€ (é»˜è®¤ä¸å¼€å¯)</span><br><span class="line">  asset_inject: true                            # è‡ªåŠ¨æ’å…¥ Aplayer.js ä¸ Meting.js èµ„æºè„šæœ¬, é»˜è®¤å¼€å¯</span><br><span class="line">  #externalLink: http:&#x2F;&#x2F;xxx&#x2F;aplayer.min.js       # è€ç‰ˆæœ¬å‚æ•°ï¼ŒåŠŸèƒ½ä¸å‚æ•° cdn ç›¸åŒmeting: true</span><br></pre></td></tr></table></figure><p>å¹¶è°ƒæ•´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder: true</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåœ¨ åšå®¢æ ¹ç›®å½•\source\music\index.mdä½¿ç”¨ä»¥ä¸‹æ ¼å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: æˆ‘çš„æ­Œå•</span><br><span class="line">date: 2019-05-17 16:14:00</span><br><span class="line">cover: https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;radium-bit&#x2F;res@latest&#x2F;Music.jpg</span><br><span class="line">type: &quot;music&quot;</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">&lt;font color&#x3D;#0c74d6 size&#x3D;3 face&#x3D;&quot;é»‘ä½“&quot;&gt;**è¿™æ˜¯æ­Œå•ä»‹ç»ï¼Œå¦‚æœä¸éœ€è¦åˆ»æ„ç•™ç©º**&lt;&#x2F;font&gt;</span><br><span class="line"></span><br><span class="line">&#123;% meting &quot;697054881&quot; &quot;netease&quot; &quot;playlist&quot; %&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¸€ä¸²æ•°å­—æ˜¯æ­Œå•IDï¼Œâ€œneteaseâ€ä¸ºç½‘æ˜“äº‘éŸ³ä¹ã€‚è¯¦ç»†å‚æ•°ç”¨æ³•è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£<br>æ­Œå•IDæå–æ–¹æ³•æ˜¯ä»¥é“¾æ¥åˆ†äº«æŸä¸ªæ­Œå•<br>ä¾‹å¦‚<br><a href="https://music.163.com/playlist?id=313418853&amp;userid=1362990007">https://music.163.com/playlist?id=313418853&amp;userid=1362990007</a></p><p>çº¢è‰²éƒ¨åˆ†å°±æ˜¯æ­Œå•IDäº†</p><p>å†™å…¥å®Œæ¯•åï¼Œå›åˆ°CMDã€‚è¾“å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå®Œæ¯•ï¼æ¥ä¸‹æ¥å°±å¯ä»¥éƒ¨ç½²åˆ°ä½ çš„æœåŠ¡å™¨å•¦(â€¦â€¢Ë˜_Ë˜â€¢â€¦)</p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo-butterflyä½¿ç”¨aplayeråŠ è½½éŸ³ä¹é¡µé¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº‘æœåŠ¡å™¨ä¸Šæ­å»ºkubernetesé›†ç¾¤</title>
      <link href="posts/8327.html"/>
      <url>posts/8327.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="äº‘æœåŠ¡å™¨ä¸Šæ­å»ºkubernetesé›†ç¾¤"><a href="#äº‘æœåŠ¡å™¨ä¸Šæ­å»ºkubernetesé›†ç¾¤" class="headerlink" title="äº‘æœåŠ¡å™¨ä¸Šæ­å»ºkubernetesé›†ç¾¤"></a>äº‘æœåŠ¡å™¨ä¸Šæ­å»ºkubernetesé›†ç¾¤</h1><h3 id="ä½¿ç”¨çš„è™šæœºç™¾åº¦äº‘BCCï¼Œcentos7-5-ï¼Œ2æ ¸4G"><a href="#ä½¿ç”¨çš„è™šæœºç™¾åº¦äº‘BCCï¼Œcentos7-5-ï¼Œ2æ ¸4G" class="headerlink" title="ä½¿ç”¨çš„è™šæœºç™¾åº¦äº‘BCCï¼Œcentos7.5 ï¼Œ2æ ¸4G"></a>ä½¿ç”¨çš„è™šæœºç™¾åº¦äº‘BCCï¼Œcentos7.5 ï¼Œ2æ ¸4G</h3><p>yumæºç™¾åº¦äº‘å®˜æ–¹è‡ªå¸¦yumæºï¼Œè…¾è®¯ï¼Œé˜¿é‡Œäº‘è‡ªå¸¦yumæºéƒ½å¯å‚è€ƒè¯¥æ–‡æ¡£</p><p>æ­å»ºk8ï¼Œä¸€å…±ä¸‰å°è™šæœºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master 192.168.0.8masterè·Ÿetcdå…±ç”¨ä¸€å°</span><br><span class="line">minion1 192.168.0.9</span><br><span class="line">minion2 192.168.0.10</span><br></pre></td></tr></table></figure><p>ç™¾åº¦äº‘è™šæœºè‡ªå¸¦yumæºå°±å¯ä»¥ä¸‹è½½<br>ä¸‰å°è™šæœºéƒ½éœ€è¦å®‰è£…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install kubernetes etcd flannel ntp</span><br><span class="line">[root@minion1 ~]# yum -y install kubernetes etcd flannel ntp</span><br><span class="line">[root@minion2 ~]# yum -y install kubernetes etcd flannel ntp</span><br></pre></td></tr></table></figure><p>å…³é—­é˜²ç«å¢™ ä¸‰å°åŒæ ·éœ€è¦å…³é—­     æ³¨ï¼šè‹¥æ˜¯ç”Ÿäº§ç¯å¢ƒä¸å¿…å…³é—­ï¼Œå†™firewalld rule</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl stop firewalld &amp;&amp; systemctl disable firewalld &amp;&amp; systemctl status firewalld</span><br><span class="line">[root@minion1~]# systemctl stop firewalld &amp;&amp; systemctl disable firewalld &amp;&amp; systemctl status firewalld</span><br><span class="line">[root@minion2~]# systemctl stop firewalld &amp;&amp; systemctl disable firewalld &amp;&amp; systemctl status firewalld</span><br></pre></td></tr></table></figure><p>åœ¨hostsæ–‡ä»¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œæ‰§è¡Œä¸€å°ï¼Œå‰©ä½™æ‹·è´å°±ok</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim &#x2F;etc&#x2F;hosts</span><br><span class="line">192.168.0.8 master</span><br><span class="line">192.168.0.8 etcd</span><br><span class="line">192.168.0.9 minion1</span><br><span class="line">192.168.0.10 minion2</span><br><span class="line">[root@master ~]# scp &#x2F;etc&#x2F;hosts 192.168.0.9:&#x2F;etc&#x2F;</span><br><span class="line">[root@master ~]# scp &#x2F;etc&#x2F;hosts 192.168.0.10:&#x2F;etc&#x2F;</span><br></pre></td></tr></table></figure><p>åœ¨masterä¸Šé…ç½®etcd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim &#x2F;etc&#x2F;etcd&#x2F;etcd.conf </span><br><span class="line">æ”¹ï¼š2 ETCD NAME&#x3D;default</span><br><span class="line">ä¸ºï¼š2ETCD_NAME&#x3D;&quot;etcd&quot;</span><br><span class="line">ETCD_DATA_DIR&#x3D;&quot;&#x2F;var&#x2F;lib&#x2F;etcd&#x2F;default.etcd&quot;</span><br><span class="line">æ”¹ï¼š9 ETCD_LISTEN_CLIENT_URLS&#x3D;&quot;http:&#x2F;&#x2F;localhost:2379&quot;</span><br><span class="line">ä¸ºï¼šETCD_LISTEN_CLIENT_URLS&#x3D;&quot;http:&#x2F;&#x2F;localhostï¼š2379,http:&#x2F;&#x2F;192.168.0.8:2379&quot;</span><br><span class="line">æ”¹ï¼š20 ETCD_ADVERTISE_CLIENT_URLS&#x3D;&quot;http:&#x2F;&#x2F;localhost:2379&quot;</span><br><span class="line">ä¸ºï¼šETCD_ADVERTISE_CLIENT_URLS&#x3D;&quot;http:&#x2F;&#x2F;192.168.0.8:2379&quot;</span><br><span class="line">æ³¨é‡Šï¼š    advertise [aedvetarz] åšå¹¿å‘Šï¼Œåšå®£ä¼ ï¼›é€šå‘Šï¼Œé€šçŸ¥</span><br><span class="line">&#x2F;etc&#x2F;etcd&#x2F;etcd.conf é…ç½®æ–‡ä»¶å«æ„å¦‚ä¸‹ï¼š</span><br><span class="line">ETCD_NAME&#x3D;&quot;etcd&quot;</span><br><span class="line">etcdèŠ‚ç‚¹åç§°ï¼Œå¦‚æœetcd é›†ç¾¤åªæœ‰ä¸€å°etcdï¼Œè¿™ä¸€é¡¹å¯ä»¥æ³¨é‡Šä¸ç”¨é…ç½®ï¼Œé»˜è®¤åç§°ä¸ºdefaultï¼Œè¿™</span><br><span class="line">ä¸ªåå®‡åé¢ä¼šç”¨åˆ°ã€‚</span><br><span class="line">ETCD_DATA_DIR&#x3D;&quot;&#x2F;var&#x2F;lib&#x2F;etcd&#x2F;default.etcd&quot;</span><br><span class="line">etcd å­˜å‚¨æ•°æ®çš„ç›®å½•</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS&#x3D;&quot;http:&#x2F;&#x2F;localhost:2379,http:&#x2F;&#x2F;192.168.1.63:2379&quot;</span><br><span class="line">etcd å¯¹å¤–æœåŠ¡ç›‘å¬åœ°å€ï¼Œä¸€èˆ¬æŒ‡å®š2379ç«¯å£ï¼Œå¦‚æœä¸º0.0.0.0å°†ä¼šç›‘å¬æ‰€æœ‰æ¥å£</span><br><span class="line">ETCD_ARGS&#x3D;&quot;&quot;</span><br></pre></td></tr></table></figure><p>éœ€è¦é¢å¤–æ·»åŠ çš„å‚æ•°ï¼Œå¯ä»¥è‡ªå·±æ·»åŠ ï¼Œetcd çš„æ‰€æœ‰å‚æ•°å¯ä»¥é€šè¿‡etcd-hæŸ¥çœ‹ã€‚<br><strong>å¯åŠ¨æœåŠ¡</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl start etcd</span><br><span class="line">[root@master ~]# systemctl status etcd</span><br><span class="line">[root@master ~]# systemctl enable etcd</span><br><span class="line">[root@master ~]# netstat -anptu | grep 2379</span><br><span class="line">tcp        0      0 127.0.0.1:2379          0.0.0.0:*               LISTEN      2963&#x2F;etcd           </span><br><span class="line">tcp        0      0 192.168.0.8:2379        0.0.0.0:*               LISTEN      2963&#x2F;etcd           </span><br><span class="line">tcp        0      0 192.168.0.8:38866       192.168.0.8:2379        ESTABLISHED 2963&#x2F;etcd           </span><br><span class="line">tcp        0      0 127.0.0.1:2379          127.0.0.1:45804         ESTABLISHED 2963&#x2F;etcd           </span><br><span class="line">tcp        0      0 192.168.0.8:2379        192.168.0.8:38866       ESTABLISHED 2963&#x2F;etcd           </span><br><span class="line">tcp        0      0 127.0.0.1:45804         127.0.0.1:2379          ESTABLISHED 2963&#x2F;etcd           </span><br></pre></td></tr></table></figure><p>æ£€æŸ¥etcdé›†ç¾¤åˆ—è¡¨ï¼Œè¿™é‡Œåªæœ‰ä¸€å°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# etcdctl member list</span><br><span class="line">8e9e05c52164694d: name&#x3D;etcd peerURLs&#x3D;http:&#x2F;&#x2F;localhost:2380 clientURLs&#x3D;http:&#x2F;&#x2F;192.168.0.8:2379 isLeader&#x3D;true</span><br></pre></td></tr></table></figure><p>åœ¨masteré…ç½®master<br>ä¿®æ”¹kubernetetsé…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim &#x2F;etc&#x2F;kubernetes&#x2F;config </span><br><span class="line">æ”¹ï¼šKUBE_MASTER&#x3D;&quot;--master&#x3D;http:&#x2F;&#x2F;127.0.0.1:8080&quot;</span><br><span class="line">ä¸ºï¼šKUBE_MASTER&#x3D;&quot;--master&#x3D;http:&#x2F;&#x2F;192.168.0.8:8080&quot;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹apiserveré…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim &#x2F;etc&#x2F;kubernetes&#x2F;apiserver</span><br><span class="line">[root@xuegod63 ~]# vim &#x2F;etc&#x2F;kubernetes&#x2F;apiserver</span><br><span class="line">æ”¹ï¼š8 KUBE_API_ADDRESS&#x3D;&quot;--insecure-bind-address&#x3D;127.0.0.1&quot;</span><br><span class="line">ä¸ºï¼š8 KUBE_API_ADDRESS&#x3D;&quot;--insecure-bind-address&#x3D;0.0.0.0</span><br><span class="line">æ”¹ï¼š17 KUBE_ETCD_SERVERS&#x3D;&quot;--etcd-servers&#x3D;http:&#x2F;&#x2F;127.0.0.1:2379&quot;</span><br><span class="line">ä¸ºï¼šKUBE_ETCD_SERVERS&#x3D;&quot;--etcd-servers&#x3D;http:&#x2F;&#x2F;192.168.0.8:2379&quot;</span><br><span class="line">æ”¹23è¡Œï¼š</span><br><span class="line">KUBE_ADMISSION_CONTROL&#x3D;&quot;--admission-control&#x3D;NamespaceLifecycle,NamespaceExist</span><br><span class="line">s,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota&quot;</span><br><span class="line">ä¸ºï¼šKUBE_ADMISSION_CONTROL&#x3D;&quot;--admission-control&#x3D;AlwaysAdmit&quot; #è¿™é‡Œå¿…é¡»é…ç½®</span><br><span class="line">æ­£ç¡®</span><br></pre></td></tr></table></figure><p>é…ç½®kube-controller-manageré…ç½®æ–‡ä»¶<br>é»˜è®¤ä¸éœ€è¦æ”¹åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat &#x2F;etc&#x2F;kubernetes&#x2F;controller-manager </span><br></pre></td></tr></table></figure><p>é…ç½®kube-scheduleré…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim &#x2F;etc&#x2F;kubernetes&#x2F;scheduler </span><br><span class="line">æ”¹ï¼šKUBE_SCHEDULER_ARGS&#x3D;&quot; &quot;</span><br><span class="line">ä¸ºï¼šKUBE_SCHEDULER_ARGS&#x3D;&quot;0.0.0.0&quot;</span><br></pre></td></tr></table></figure><p>è®¾ç½®etcdç½‘ç»œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# etcdctl set &#x2F;k8s&#x2F;network&#x2F;config &#39;&#123;&quot;Network&quot;:&quot;10.255.0.0&#x2F;16&quot;&#125;&#39;   &#x2F;&#x2F;ç”¨äºå­˜å‚¨flanneldç½‘ç»œä¿¡æ¯</span><br><span class="line">[root@master ~]# etcdctl get &#x2F;k8s&#x2F;network&#x2F;config      &#x2F;&#x2F;æŸ¥çœ‹</span><br><span class="line">&#123;&quot;Network&quot;:&quot;10.255.0.0&#x2F;16&quot;&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®flanneldæœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim &#x2F;etc&#x2F;sysconfig&#x2F;flanneld </span><br><span class="line">æ”¹ï¼š4FLANNEL_ETCD_ENDPOINTS&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:2379&quot;</span><br><span class="line">ä¸ºï¼š4FLANNEL_ETCD_ENDPOINTS&#x3D;&quot;http:&#x2F;&#x2F;192.168.0.8:2379&quot;</span><br><span class="line">æ”¹:8 FLANNEL_ETCD_PREFIX&#x3D;&quot;&#x2F;atomic.io&#x2F;network&quot;</span><br><span class="line">ä¸ºï¼š8 FLANNEL_ETCD_PREFIX&#x3D;&quot;&#x2F;k8s&#x2F;network&quot;</span><br><span class="line">#æ³¨å…¶ä¸­&#x2F;k8s&#x2F;network ä¸ä¸Šé¢ etcd ä¸­çš„ Network å¯¹åº”</span><br><span class="line">æ”¹ï¼š11 #FLANNEL_OPTIONS&#x3D;&quot;&quot;</span><br><span class="line">ä¸ºï¼š11 FLANNEL_OPTIONS&#x3D;&quot;--iface&#x3D;eth0&quot; #æŒ‡å®š é€šä¿¡çš„ç‰©ç†ç½‘å¡</span><br><span class="line">[root@master ~]# systemctl restart flanneld.service </span><br><span class="line">[root@master ~]# systemctl status flanneld.service </span><br><span class="line">[root@master ~]# cat &#x2F;run&#x2F;flannel&#x2F;subnet.env  &#x2F;&#x2F;æŸ¥çœ‹&#x2F;run&#x2F;flannel&#x2F;subnet.env å­ç½‘ä¿¡æ¯</span><br><span class="line">FLANNEL_NETWORK&#x3D;10.255.0.0&#x2F;16</span><br><span class="line">FLANNEL_SUBNET&#x3D;10.255.6.1&#x2F;24</span><br><span class="line">FLANNEL_MTU&#x3D;1472</span><br><span class="line">FLANNEL_IPMASQ&#x3D;false</span><br></pre></td></tr></table></figure><p>ä¹‹åä¼šæœ‰ä¸€ä¸ªè„šæœ¬å§œsubnet.envè½¬å†™ç¨‹ä¸€ä¸ªdockerçš„ç¯å¢ƒå˜é‡æ–‡ä»¶/run/flannel/docker<br>docker0çš„åœ°å€æ˜¯ç”± /run/flannel/subnet.env çš„FLANNEL_SUBENTå‚æ•°å†³å®šçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat &#x2F;run&#x2F;flannel&#x2F;docker </span><br><span class="line">DOCKER_OPT_BIP&#x3D;&quot;--bip&#x3D;10.255.6.1&#x2F;24&quot;</span><br><span class="line">DOCKER_OPT_IPMASQ&#x3D;&quot;--ip-masq&#x3D;true&quot;</span><br><span class="line">DOCKER_OPT_MTU&#x3D;&quot;--mtu&#x3D;1472&quot;</span><br><span class="line">DOCKER_NETWORK_OPTIONS&#x3D;&quot; --bip&#x3D;10.255.6.1&#x2F;24 --ip-masq&#x3D;true --mtu&#x3D;1472&quot;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨masterä¸Šçš„4ä¸ªæœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl restart kube-apiserver kube-controller-manager kube-scheduler flanneld</span><br><span class="line">[root@master ~]# systemctl status kube-apiserver kube-controller-manager kube-scheduler flanneld</span><br><span class="line">[root@master ~]# systemctl enable kube-apiserver kube-controller-manager kube-scheduler flanneld</span><br></pre></td></tr></table></figure><p><strong>åˆ°æ­¤masterå’ŒetcdèŠ‚ç‚¹é…ç½®æˆåŠŸ</strong></p><p>é…ç½®minion1,é‡‡ç”¨flannelæ–¹å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# vim &#x2F;etc&#x2F;sysconfig&#x2F;flanneld </span><br><span class="line">æ”¹ï¼š4FLANNEL_ETCD_ENDPOINTS&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:2379&quot;</span><br><span class="line">ä¸ºï¼š4FLANNEL_ETCD_ENDPOINTS&#x3D;&quot;http:&#x2F;&#x2F;192.168.0.8:2379&quot;</span><br><span class="line">æ”¹:8 FLANNEL_ETCD_PREFIX&#x3D;&quot;&#x2F;atomic.io&#x2F;network&quot;</span><br><span class="line">ä¸ºï¼š8 FLANNEL_ETCD_PREFIX&#x3D;&quot;&#x2F;k8s&#x2F;network&quot;</span><br><span class="line">#æ³¨å…¶ä¸­&#x2F;k8s&#x2F;network ä¸ä¸Šé¢ etcd ä¸­çš„ Network å¯¹åº”</span><br><span class="line">æ”¹ï¼š11 #FLANNEL_OPTIONS&#x3D;&quot;&quot;</span><br><span class="line">ä¸ºï¼š11 FLANNEL_OPTIONS&#x3D;&quot;--iface&#x3D;eth0&quot; #æŒ‡å®š é€šä¿¡çš„ç‰©ç†ç½‘å¡</span><br></pre></td></tr></table></figure><p>é…ç½®minion1ä¸Šçš„masteråœ°å€å’Œkube-proxy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# vim &#x2F;etc&#x2F;kubernetes&#x2F;config </span><br><span class="line">æ”¹ï¼šKUBE_MASTER&#x3D;&quot;--master&#x3D;http:&#x2F;&#x2F;127.0.01:8080&quot;</span><br><span class="line">ä¸ºï¼šKUBE_MASTER&#x3D;&quot;--master&#x3D;http:&#x2F;&#x2F;192.168.0.8:8080&quot;</span><br></pre></td></tr></table></figure><p>kube-proxyé»˜è®¤ä¸éœ€è¦æ”¹åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# grep -v &#39;^#&#39; &#x2F;etc&#x2F;kubernetes&#x2F;proxy </span><br><span class="line">KUBE_PROXY_ARGS&#x3D;&quot;&quot;</span><br></pre></td></tr></table></figure><p>é…ç½®minion1 kubelet</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# vim &#x2F;etc&#x2F;kubernetes&#x2F;kubelet </span><br><span class="line">æ”¹ï¼š5 KUBELET_ADDRESS&#x3D;&quot;--address&#x3D;127.0.0.1&quot;</span><br><span class="line">ä¸ºï¼š5KUBELET_ADDRESS&#x3D;&quot;--address&#x3D;0.0.0.0&quot; #é»˜è®¤åªç›‘å¬127.0.0.1ï¼Œè¦æ”¹æˆï¼š0.0.0.0ï¼Œ</span><br><span class="line">å› ä¸ºåæœŸè¦ä½¿ç”¨kubectl è¿œç¨‹è¿æ¥åˆ°kubelet æœåŠ¡ä¸Šï¼Œæ¥æŸ¥çœ‹ pod åŠ pod ä¸­å®¹å™¨çš„çŠ¶æ€ã€‚å¦‚æœæ˜¯ 127</span><br><span class="line">å°±æ— æ³•è¿œç¨‹è¿æ¥kubeletæœåŠ¡ã€‚</span><br><span class="line">æ”¹ï¼š11 KUBELET_HOSTNAME&#x3D;&quot;--hostname-override&#x3D;127.0.0.1&quot;</span><br><span class="line">ä¸ºï¼š11 KUBELET_HOSTNAME&#x3D;&quot;_-hostname-override&#x3D;minion1&quot; # minion çš„ä¸»æœºåï¼Œè®¾ç½®</span><br><span class="line">æˆå’Œæœ¬ä¸»æœºæœºåä¸€æ ·ï¼Œä¾¿äºè¯†åˆ«ã€‚</span><br><span class="line">æ”¹ï¼š14 KUBELET_API_SERVER&#x3D;&quot;--api-servers&#x3D;http:&#x2F;&#x2F;127.0.0.1:8080&quot;</span><br><span class="line">ä¸ºï¼š14 KUBELET_API_SERVER&#x3D;&quot;--api-servers&#x3D;http:&#x2F;&#x2F;192.168.0.8:8080&quot; #æ‰¹å®š apiserver</span><br><span class="line">çš„åœ°å€</span><br></pre></td></tr></table></figure><p>å¯åŠ¨minion1æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# systemctl restart flanneld kube-proxy kubelet docker</span><br><span class="line">[root@minion1 ~]# systemctl enable flanneld kube-proxy kubelet docker</span><br><span class="line">[root@minion1 ~]# systemctl status flanneld kube-proxy kubelet docker</span><br><span class="line">æŸ¥çœ‹</span><br><span class="line">[root@minion1 ~]# ifconfig</span><br><span class="line">docker0: flags&#x3D;4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.255.90.1  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 02:42:0c:ce:9d:7d  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">flannel0: flags&#x3D;4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1472</span><br><span class="line">        inet 10.255.90.0  netmask 255.255.0.0  destination 10.255.90.0</span><br><span class="line">        inet6 fe80::6062:c456:9093:278b  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3  bytes 144 (144.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹kube-proxy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# netstat -antup | grep proxy</span><br><span class="line">tcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      3242&#x2F;kube-proxy     </span><br><span class="line">tcp        0      0 192.168.0.9:53976       192.168.0.8:8080        ESTABLISHED 3242&#x2F;kube-proxy     </span><br><span class="line">tcp        0      0 192.168.0.9:53974       192.168.0.8:8080        ESTABLISHED 3242&#x2F;kube-proxy  </span><br></pre></td></tr></table></figure><p>é…ç½®minion2,é‡‡ç”¨flannelæ–¹å¼ï¼Œå’Œminion1é…ç½®ä¸€æ ·<br>è¿™é‡Œ ç›´æ¥å°†minion1çš„çš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°minion2äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# scp &#x2F;etc&#x2F;sysconfig&#x2F;flanneld 189.168.0.10:&#x2F;etc&#x2F;sysconfig&#x2F;</span><br><span class="line">å†æ¬¡ç¡®è®¤æ‹·è´æ­£ç¡®</span><br><span class="line">[root@minion2 ~]# grep -v &#39;^#&#39; &#x2F;etc&#x2F;sysconfig&#x2F;flanneld </span><br><span class="line"></span><br><span class="line">FLANNEL_ETCD_ENDPOINTS&#x3D;&quot;http:&#x2F;&#x2F;192.168.0.8:2379&quot;</span><br><span class="line"></span><br><span class="line">FLANNEL_ETCD_PREFIX&#x3D;&quot;&#x2F;k8s&#x2F;network&quot;</span><br><span class="line"></span><br><span class="line">FLANNEL_OPTIONS&#x3D;&quot;--iface&#x3D;eth0&quot;</span><br><span class="line">[root@minion2 ~]# systemctl start flanneld.service </span><br><span class="line">[root@minion2 ~]# ifconfig </span><br><span class="line">flannel0: flags&#x3D;4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1472</span><br><span class="line">        inet 10.255.50.0  netmask 255.255.0.0  destination 10.255.50.0</span><br><span class="line">        inet6 fe80::435b:45bf:df6b:58c  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 2  bytes 96 (96.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><p>é…ç½®minion2ä¸Šçš„åœ°å€å’Œkube-proxy<br>è¿™é‡Œä¹Ÿç›´æ¥æ‹·è´minion1çš„é…ç½®æ–‡ä»¶äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# scp &#x2F;etc&#x2F;kubernetes&#x2F;config 192.168.0.10:&#x2F;etc&#x2F;kubernetes&#x2F;</span><br><span class="line">[root@minion1 ~]# scp &#x2F;etc&#x2F;kubernetes&#x2F;proxy 192.168.0.10:&#x2F;etc&#x2F;kubernetes&#x2F;</span><br><span class="line">[root@minion2 ~]# systemctl start kube-proxy</span><br><span class="line">[root@minion2 ~]# netstat -anptu | grep proxy</span><br><span class="line">tcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      29942&#x2F;kube-proxy    </span><br><span class="line">tcp        0      0 192.168.0.10:59170      192.168.0.8:8080        ESTABLISHED 29942&#x2F;kube-proxy    </span><br><span class="line">tcp        0      0 192.168.0.10:59168      192.168.0.8:8080        ESTABLISHED 29942&#x2F;kube-proxy    </span><br><span class="line">tcp        0      0 192.168.0.10:59166      192.168.0.8:8080        ESTABLISHED 29942&#x2F;kube-proxy    </span><br></pre></td></tr></table></figure><p>é…ç½®minion2 kubelet</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@minion1 ~]# scp &#x2F;etc&#x2F;kubernetes&#x2F;kubelet 192.168.0.10:&#x2F;etc&#x2F;kubernetes&#x2F;</span><br><span class="line">root@192.168.0.10 password: </span><br><span class="line">kubelet                                                                                               100%  613     1.6MB&#x2F;s   00:00  </span><br><span class="line">[root@minion2 ~]# vim &#x2F;etc&#x2F;kubernetes&#x2F;kubelet </span><br><span class="line">æ”¹ï¼šKUBELET_HOSTNAME&#x3D;&quot;--hostname-override&#x3D;minion1&quot;</span><br><span class="line">ä¸ºï¼šKUBELET_HOSTNAME&#x3D;&quot;--hostname-override&#x3D;minion2&quot;</span><br><span class="line">[root@minion2 ~]# systemctl start kubelet</span><br><span class="line">[root@minion2 ~]# netstat -antup | grep 8080    &#x2F;&#x2F;æŸ¥çœ‹ï¼šå·²å»ºç«‹è¿æ¥</span><br><span class="line">tcp        0      0 192.168.0.10:59216      192.168.0.8:8080        TIME_WAIT   -                   </span><br><span class="line">tcp        0      0 192.168.0.10:59168      192.168.0.8:8080        ESTABLISHED 29942&#x2F;kube-proxy    </span><br><span class="line">tcp        0      0 192.168.0.10:59212      192.168.0.8:8080        ESTABLISHED 32339&#x2F;kubelet       </span><br><span class="line">tcp        0      0 192.168.0.10:59214      192.168.0.8:8080        ESTABLISHED 32339&#x2F;kubelet       </span><br><span class="line">tcp        0      0 192.168.0.10:59218      192.168.0.8:8080        ESTABLISHED 32339&#x2F;kubelet       </span><br><span class="line">tcp        0      0 192.168.0.10:59166      192.168.0.8:8080        ESTABLISHED 29942&#x2F;kube-proxy    </span><br><span class="line">tcp        0      0 192.168.0.10:59210      192.168.0.8:8080        ESTABLISHED 32339&#x2F;kubelet       </span><br><span class="line">[root@minion2 ~]# systemctl restart flanneld kube-proxy kubelet docker</span><br><span class="line">[root@minion2 ~]# systemctl enable flanneld kube-proxy kubelet docker</span><br><span class="line">[root@minion2 ~]# systemctl status flanneld kube-proxy kubelet docker</span><br></pre></td></tr></table></figure><p>ifconfigæŸ¥çœ‹docker0 IP  minion1å’Œminion2æ˜¯ä¸ä¸€æ ·çš„</p><p>åˆ°masterä¸»æœºä¸ŠæŸ¥çœ‹é›†ç¾¤è¿è¡ŒçŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME      STATUS    AGE</span><br><span class="line">minion1   Ready     26m</span><br><span class="line">minion2   Ready     7m</span><br></pre></td></tr></table></figure><p><strong>åˆ°æ­¤æ•´ä¸ªé›†ç¾¤æ­å»ºå®Œæˆ</strong></p><blockquote><p>æ€»ç»“ï¼škubernetes æ¯ä¸ªèŠ‚ç‚¹éœ€è¦å¯åŠ¨çš„æœåŠ¡å’Œå¼€æ”¾ç«¯å£å·<br>åœ¨æœ¬å®éªŒä¸­kubernetes4ä¸ªç»“ç‚¹ä¸€å…±éœ€è¦å¯åŠ¨13ä¸ªæœåŠ¡ï¼Œå¼€6ä¸ªç«¯å£å·ã€‚<br>è¯¦æƒ…å¦‚ä¸‹ï¼š~<br>etcd:ä¸€å…±1ä¸ªæœåŠ¡ ï¼Œé€šè®¯ä½¿ç”¨ 2379 ç«¯å£<br>å¯åŠ¨æœåŠ¡<br>[root@masterï¼ˆetcdï¼‰~]#systemctl restart etcd<br>master:ä¸€å…±4ä¸ªæœåŠ¡ï¼Œé€šè®¯ä½¿ç”¨ 8080ç«¯å£<br>[root@masterï¼ˆetcdï¼‰â€“]# systemctl restart kube-apiserver kube-controller-manager<br>kube-scheduler flanneld<br>minion1:ä¸€å…±4ä¸ªæœåŠ¡<br>kubeproxy ç›‘æ§å¬ç«¯å£å·æ˜¯ 10249 , kubelet ç›‘å¬ç«¯å£ 10248ã€10250ã€10255 ä¸‰ä¸ªç«¯å£<br>[root@minion1 â€“]# systemctl restart flanneld kube-proxy kubelet docker<br>minion2:ä¸€å…±4ä¸ªæœåŠ¡<br>[root@minion2 ~]# systemctl restart flanneld kube-proxy kubelet docker</p></blockquote><h3 id="ç‚¹å‡»å‰å¾€ä½œè€…CSDNåšå®¢"><a href="#ç‚¹å‡»å‰å¾€ä½œè€…CSDNåšå®¢" class="headerlink" title="ç‚¹å‡»å‰å¾€ä½œè€…CSDNåšå®¢"></a><a href="https://me.csdn.net/weixin_45509582">ç‚¹å‡»å‰å¾€ä½œè€…CSDNåšå®¢</a></h3>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetesé›†ç¾¤æ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxåå‘ä»£ç†+nginxæ€§èƒ½ä¼˜åŒ–é…ç½®è¯¦è§£</title>
      <link href="posts/3546.html"/>
      <url>posts/3546.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€:"></a>å‰è¨€:</h1><p>ä»£ç†æœåŠ¡å¯ç®€å•çš„åˆ†ä¸ºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†:</p><p>æ­£å‘ä»£ç†: ç”¨äºä»£ç†å†…éƒ¨ç½‘ç»œå¯¹Internetçš„è¿æ¥è¯·æ±‚(å¦‚VPN/NAT),å®¢æˆ·ç«¯æŒ‡å®šä»£ç†æœåŠ¡å™¨,å¹¶å°†æœ¬æ¥è¦ç›´æ¥å‘é€ç»™ç›®æ ‡WebæœåŠ¡å™¨çš„HTTPè¯·æ±‚å…ˆå‘é€åˆ°ä»£ç†æœåŠ¡å™¨ä¸Š,ç„¶åç”±ä»£ç†æœåŠ¡å™¨å»è®¿é—®WebæœåŠ¡å™¨<a id="more"></a>, å¹¶å°†WebæœåŠ¡å™¨çš„Responseå›ä¼ ç»™å®¢æˆ·ç«¯: </p><p>åå‘ä»£ç†: ä¸æ­£å‘ä»£ç†ç›¸å,å¦‚æœå±€åŸŸç½‘å‘Internetæä¾›èµ„æº,å¹¶è®©Internetä¸Šçš„å…¶ä»–ç”¨æˆ·å¯ä»¥è®¿é—®å±€åŸŸç½‘å†…èµ„æº, ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨, å®ƒæä¾›çš„æœåŠ¡å°±æ˜¯åå‘ä»£ç†. åå‘ä»£ç†æœåŠ¡å™¨æ¥å—æ¥è‡ªInternetçš„è¿æ¥,ç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨,å¹¶å°†Responseå›ä¼ ç»™Internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯: </p><h2 id="ä¸€ã€Nginxåå‘ä»£ç†-WebæœåŠ¡å™¨çš„è°ƒåº¦å™¨ï¼š"><a href="#ä¸€ã€Nginxåå‘ä»£ç†-WebæœåŠ¡å™¨çš„è°ƒåº¦å™¨ï¼š" class="headerlink" title="ä¸€ã€Nginxåå‘ä»£ç†=WebæœåŠ¡å™¨çš„è°ƒåº¦å™¨ï¼š"></a>ä¸€ã€Nginxåå‘ä»£ç†=WebæœåŠ¡å™¨çš„è°ƒåº¦å™¨ï¼š</h2><p>ï¼ˆ1.ï¼‰åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™ç½‘ç»œä¸Šçš„webæœåŠ¡å™¨ï¼ˆå¯èƒ½æ˜¯apacheã€nginxã€tomcatã€iisç­‰ï¼‰ï¼Œå¹¶å°†ä»webæœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™è¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šåå‘ä»£ç†æœåŠ¡å™¨ä»£ç†ç½‘ç«™WebæœåŠ¡å™¨æ¥æ”¶Httpè¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œè½¬å‘ã€‚è€Œä¸”nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„å†…å®¹æŠŠè¯·æ±‚è½¬å‘ç»™åç«¯ä¸åŒçš„webæœåŠ¡å™¨ï¼Œä¾‹å¦‚é™åŠ¨åˆ†ç¦»ï¼Œå†ä¾‹å¦‚åœ¨nginxä¸Šåˆ›å»ºå¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œè¿™æ ·å°±æˆåŠŸçš„åšåˆ°äº†åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸åŒåŸŸåï¼ˆurlï¼‰çš„æ—¶å€™è®¿é—®åç«¯çš„ä¸åŒwebæœåŠ¡å™¨æˆ–webç¾¤é›†ã€‚</p><p>ï¼ˆ2.ï¼‰åå‘ä»£ç†çš„ä½œç”¨</p><ul><li>ä¿æŠ¤ç½‘ç«™å®‰å…¨ï¼šä»»ä½•æ¥è‡ªInternetçš„è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡ä»£ç†æœåŠ¡å™¨ï¼›</li><li>é€šè¿‡é…ç½®ç¼“å­˜åŠŸèƒ½åŠ é€ŸWebè¯·æ±‚ï¼šå¯ä»¥ç¼“å­˜çœŸå®WebæœåŠ¡å™¨ä¸Šçš„æŸäº›é™æ€èµ„æºï¼Œå‡è½»çœŸå®WebæœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ï¼›</li><li>å®ç°è´Ÿè½½å‡è¡¡ï¼šå……å½“è´Ÿè½½å‡è¡¡æœåŠ¡å™¨å‡è¡¡åœ°åˆ†å‘è¯·æ±‚ï¼Œå¹³è¡¡é›†ç¾¤ä¸­å„ä¸ªæœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ï¼›</li></ul><h2 id="äºŒã€ä»€ä¹ˆæ˜¯nginx"><a href="#äºŒã€ä»€ä¹ˆæ˜¯nginx" class="headerlink" title="äºŒã€ä»€ä¹ˆæ˜¯nginx"></a>äºŒã€ä»€ä¹ˆæ˜¯nginx</h2><h3 id="nginxç®€ä»‹"><a href="#nginxç®€ä»‹" class="headerlink" title="nginxç®€ä»‹"></a>nginxç®€ä»‹</h3><p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„ç½‘é¡µæœåŠ¡å™¨ã€åå‘ä»£ç†å™¨ä»¥åŠç”µå­é‚®ä»¶ä»£ç†æœåŠ¡å™¨ã€‚å› å®ƒçš„ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç¤ºä¾‹é…ç½®æ–‡ä»¶å’Œä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—è€Œé—»åã€‚Nginxï¼ˆå‘éŸ³åŒengine xï¼‰ï¼Œå®ƒæ˜¯ç”±ä¿„ç½—æ–¯ç¨‹åºå‘˜Igor Sysoevæ‰€å¼€å‘çš„ã€‚èµ·åˆæ˜¯ä¾›ä¿„å›½å¤§å‹çš„é—¨æˆ·ç½‘ç«™åŠæœç´¢å¼•æ“Ramblerï¼ˆä¿„è¯­ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰ä½¿ç”¨ã€‚æ­¤è½¯ä»¶BSD-likeåè®®ä¸‹å‘è¡Œï¼Œå¯ä»¥åœ¨UNIXã€GNU/Linuxã€BSDã€Mac OS Xã€Solarisï¼Œä»¥åŠMicrosoft Windowsç­‰æ“ä½œç³»ç»Ÿä¸­è¿è¡Œã€‚</p><p>Nginxçš„åº”ç”¨ç°çŠ¶ï¼š</p><p>Nginx å·²ç»åœ¨ä¿„ç½—æ–¯æœ€å¤§çš„é—¨æˆ·ç½‘ç«™â”€â”€ Rambler Mediaï¼ˆ<a href="http://www.rambler.ruï¼‰ä¸Šè¿è¡Œï¼ŒåŒæ—¶ä¿„ç½—æ–¯è¶…è¿‡20%çš„è™šæ‹Ÿä¸»æœºå¹³å°é‡‡ç”¨Nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ã€‚">www.rambler.ruï¼‰ä¸Šè¿è¡Œï¼ŒåŒæ—¶ä¿„ç½—æ–¯è¶…è¿‡20%çš„è™šæ‹Ÿä¸»æœºå¹³å°é‡‡ç”¨Nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ã€‚</a></p><p>åœ¨å›½å†…ï¼Œå·²ç»æœ‰æ·˜å®ã€æ–°æµªåšå®¢ã€æ–°æµªæ’­å®¢ã€ç½‘æ˜“æ–°é—»ã€å…­é—´æˆ¿ã€56.comã€Discuz!ã€æ°´æœ¨ç¤¾åŒºã€è±†ç“£ã€YUPOOã€æµ·å†…ã€è¿…é›·åœ¨çº¿ç­‰å¤šå®¶ç½‘ç«™ä½¿ç”¨ Nginx ä½œä¸ºWebæœåŠ¡å™¨æˆ–åå‘ä»£ç†æœåŠ¡å™¨ã€‚</p><h3 id="Nginxçš„æ ¸å¿ƒç‰¹ç‚¹"><a href="#Nginxçš„æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="Nginxçš„æ ¸å¿ƒç‰¹ç‚¹"></a>Nginxçš„æ ¸å¿ƒç‰¹ç‚¹</h3><ul><li><p>è·¨å¹³å°ï¼šNginx å¯ä»¥åœ¨å¤§å¤šæ•°OSç¼–è¯‘è¿è¡Œï¼Œè€Œä¸”ä¹Ÿæœ‰Windowsçš„ç‰ˆæœ¬ï¼›</p></li><li><p>é…ç½®å¼‚å¸¸ç®€å•ï¼šéå¸¸å®¹æ˜“ä¸Šæ‰‹ã€‚</p></li><li><p>éé˜»å¡ã€é«˜å¹¶å‘è¿æ¥ï¼šå®˜æ–¹æµ‹è¯•èƒ½å¤Ÿæ”¯æ’‘5ä¸‡å¹¶å‘è¿æ¥ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­è·‘åˆ°2ï½3ä¸‡å¹¶å‘è¿æ¥æ•°ã€‚ï¼ˆè¿™å¾—ç›ŠäºNginxä½¿ç”¨äº†æœ€æ–°çš„epollæ¨¡å‹ï¼‰ï¼›</p></li></ul><p>æ³¨æ„ï¼š</p><p>å¯¹äºä¸€ä¸ªWebæœåŠ¡å™¨æ¥è¯´ï¼Œé¦–å…ˆçœ‹ä¸€ä¸ªè¯·æ±‚çš„åŸºæœ¬è¿‡ç¨‹ï¼šå»ºç«‹è¿æ¥â€”æ¥æ”¶æ•°æ®â€”å‘é€æ•°æ®ï¼Œåœ¨ç³»ç»Ÿåº•å±‚çœ‹æ¥ï¼šä¸Šè¿°è¿‡ç¨‹ï¼ˆå»ºç«‹è¿æ¥â€”æ¥æ”¶æ•°æ®â€”å‘é€æ•°æ®ï¼‰åœ¨ç³»ç»Ÿåº•å±‚å°±æ˜¯è¯»å†™äº‹ä»¶ã€‚</p><p>å¦‚æœé‡‡ç”¨é˜»å¡è°ƒç”¨çš„æ–¹å¼ï¼Œå½“è¯»å†™äº‹ä»¶æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œé‚£ä¹ˆå°±åªèƒ½ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œç­‰äº‹ä»¶å‡†å¤‡å¥½äº†ï¼Œæ‰èƒ½è¿›è¡Œè¯»å†™äº‹ä»¶ã€‚</p><p>å¦‚æœé‡‡ç”¨éé˜»å¡è°ƒç”¨çš„æ–¹å¼ï¼šäº‹ä»¶é©¬ä¸Šè¿”å›ï¼Œå‘Šè¯‰ä½ äº‹ä»¶è¿˜æ²¡å‡†å¤‡å¥½å‘¢ï¼Œè¿‡ä¼šå†æ¥å§ã€‚è¿‡ä¸€ä¼šï¼Œå†æ¥æ£€æŸ¥ä¸€ä¸‹äº‹ä»¶ï¼Œç›´åˆ°äº‹ä»¶å‡†å¤‡å¥½äº†ä¸ºæ­¢ï¼Œåœ¨è¿™æœŸé—´ï¼Œä½ å°±å¯ä»¥å…ˆå»åšå…¶å®ƒäº‹æƒ…ï¼Œç„¶åå†æ¥çœ‹çœ‹äº‹ä»¶å¥½äº†æ²¡ã€‚è™½ç„¶ä¸é˜»å¡äº†ï¼Œä½†ä½ å¾—ä¸æ—¶åœ°è¿‡æ¥æ£€æŸ¥ä¸€ä¸‹äº‹ä»¶çš„çŠ¶æ€ï¼Œä½ å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…äº†ï¼Œä½†å¸¦æ¥çš„å¼€é”€ä¹Ÿæ˜¯ä¸å°çš„ã€‚éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹</p><ul><li>äº‹ä»¶é©±åŠ¨ï¼šé€šä¿¡æœºåˆ¶é‡‡ç”¨epollæ¨¡å‹ï¼Œæ”¯æŒæ›´å¤§çš„å¹¶å‘è¿æ¥ã€‚</li></ul><p>éé˜»å¡é€šè¿‡ä¸æ–­æ£€æŸ¥äº‹ä»¶çš„çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦è¿›è¡Œè¯»å†™æ“ä½œï¼Œè¿™æ ·å¸¦æ¥çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤å°±æœ‰äº†å¼‚æ­¥éé˜»å¡çš„äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚è¿™ç§æœºåˆ¶è®©ä½ å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªäº‹ä»¶ï¼Œè°ƒç”¨ä»–ä»¬æ˜¯éé˜»å¡çš„ï¼Œä½†å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œåœ¨è¶…æ—¶æ—¶é—´ä¹‹å†…ï¼Œå¦‚æœæœ‰äº‹ä»¶å‡†å¤‡å¥½äº†ï¼Œå°±è¿”å›ã€‚è¿™ç§æœºåˆ¶è§£å†³äº†ä¸Šé¢é˜»å¡è°ƒç”¨ä¸éé˜»å¡è°ƒç”¨çš„ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>ä»¥epollæ¨¡å‹ä¸ºä¾‹ï¼šå½“äº‹ä»¶æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œå°±æ”¾å…¥epoll(é˜Ÿåˆ—)é‡Œé¢ã€‚å¦‚æœæœ‰äº‹ä»¶å‡†å¤‡å¥½äº†ï¼Œé‚£ä¹ˆå°±å»å¤„ç†ï¼›å½“äº‹ä»¶æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œæ‰åœ¨ epollé‡Œé¢ç­‰ç€ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¹¶å‘å¤„ç†å¤§é‡çš„å¹¶å‘äº†ï¼Œå½“ç„¶ï¼Œè¿™é‡Œçš„å¹¶å‘è¯·æ±‚ï¼Œæ˜¯æŒ‡æœªå¤„ç†å®Œçš„è¯·æ±‚ã€‚çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥åŒæ—¶èƒ½å¤„ç†çš„è¯·æ±‚å½“ç„¶åªæœ‰ä¸€ä¸ªäº†ï¼Œåªæ˜¯åœ¨è¯·æ±‚ä¹‹é—´è¿›è¡Œä¸æ–­åœ°åˆ‡æ¢è€Œå·²ï¼Œåˆ‡æ¢ä¹Ÿæ˜¯å› ä¸ºå¼‚æ­¥äº‹ä»¶æœªå‡†å¤‡å¥½ï¼Œè€Œä¸»åŠ¨è®©å‡ºçš„ã€‚è¿™é‡Œçš„åˆ‡æ¢æ˜¯æ²¡æœ‰ä»»ä½•ä»£ä»·ï¼Œä½ å¯ä»¥ç†è§£ä¸ºå¾ªç¯å¤„ç†å¤šä¸ªå‡†å¤‡å¥½çš„äº‹ä»¶ã€‚</p><p>å¤šçº¿ç¨‹æ–¹å¼ç›¸æ¯”ï¼Œè¿™ç§äº‹ä»¶å¤„ç†æ–¹å¼æ˜¯æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿çš„ï¼Œä¸éœ€è¦åˆ›å»ºçº¿ç¨‹ï¼Œæ¯ä¸ªè¯·æ±‚å ç”¨çš„å†…å­˜ä¹Ÿå¾ˆå°‘ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œäº‹ä»¶å¤„ç†éå¸¸çš„è½»é‡çº§ï¼Œå¹¶å‘æ•°å†å¤šä¹Ÿä¸ä¼šå¯¼è‡´æ— è°“çš„èµ„æºæµªè´¹ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ã€‚å¯¹äºapacheæœåŠ¡å™¨ï¼Œæ¯ä¸ªè¯·æ±‚ä¼šç‹¬å ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå½“å¹¶å‘æ•°ä¸Šåˆ°å‡ åƒæ—¶ï¼Œå°±åŒæ—¶æœ‰å‡ åƒçš„çº¿ç¨‹åœ¨å¤„ç†è¯·æ±‚äº†ã€‚è¿™å¯¹æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œæ˜¯ä¸ªä¸å°çš„æŒ‘æˆ˜ï¼šå› ä¸ºçº¿ç¨‹å¸¦æ¥çš„å†…å­˜å ç”¨éå¸¸å¤§ï¼Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„cpuå¼€é”€å¾ˆå¤§ï¼Œè‡ªç„¶æ€§èƒ½å°±ä¸Šä¸å»ï¼Œä»è€Œå¯¼è‡´åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½ä¸‹é™ä¸¥é‡ã€‚</p><p>æ€»ç»“ï¼šé€šè¿‡å¼‚æ­¥éé˜»å¡çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼ŒNginxå®ç°ç”±è¿›ç¨‹å¾ªç¯å¤„ç†å¤šä¸ªå‡†å¤‡å¥½çš„äº‹ä»¶ï¼Œä»è€Œå®ç°é«˜å¹¶å‘å’Œè½»é‡çº§ã€‚</p><ul><li>Master/Workerç»“æ„ï¼šä¸€ä¸ªmasterè¿›ç¨‹ï¼Œç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªworkerè¿›ç¨‹ã€‚æ³¨æ„ï¼š<br>Master-Workerè®¾è®¡æ¨¡å¼ä¸»è¦åŒ…å«ä¸¤ä¸ªä¸»è¦ç»„ä»¶Masterå’ŒWorkerï¼ŒMasterç»´æŠ¤ç€Workeré˜Ÿåˆ—ï¼Œå°†è¯·æ±‚ä¸‹å‘åˆ°å¤šä¸ªWorkerå¹¶è¡Œæ‰§è¡Œï¼ŒWorkerä¸»è¦è¿›è¡Œå®é™…é€»è¾‘è®¡ç®—ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™Masterã€‚</li></ul><p>nginxé‡‡ç”¨è¿™ç§è¿›ç¨‹æ¨¡å‹æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿé‡‡ç”¨ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå¯ä»¥è®©äº’ç›¸ä¹‹é—´ä¸ä¼šå½±å“ï¼Œä¸€ä¸ªè¿›ç¨‹é€€å‡ºåï¼Œå…¶å®ƒè¿›ç¨‹è¿˜åœ¨å·¥ä½œï¼ŒæœåŠ¡ä¸ä¼šä¸­æ–­ï¼ŒMaster è¿›ç¨‹åˆ™å¾ˆå¿«é‡æ–°å¯åŠ¨æ–°çš„Workerè¿›ç¨‹ã€‚å½“ç„¶ï¼ŒWorkerè¿›ç¨‹çš„å¼‚å¸¸é€€å‡ºï¼Œè‚¯å®šæ˜¯ç¨‹åºæœ‰bugäº†ï¼Œå¼‚å¸¸é€€å‡ºï¼Œä¼šå¯¼è‡´å½“å‰Workerä¸Šçš„æ‰€æœ‰è¯·æ±‚å¤±è´¥ï¼Œä¸è¿‡ä¸ä¼šå½±å“åˆ°æ‰€æœ‰workè¯·æ±‚ï¼Œæ‰€ä»¥é™ä½äº†é£é™©ã€‚</p><ul><li><p>å†…å­˜æ¶ˆè€—å°ï¼šå¤„ç†å¤§å¹¶å‘çš„è¯·æ±‚å†…å­˜æ¶ˆè€—éå¸¸å°ã€‚åœ¨3ä¸‡å¹¶å‘è¿æ¥ä¸‹ï¼Œå¼€å¯çš„10ä¸ªNginx è¿›ç¨‹æ‰æ¶ˆè€—150Må†…å­˜ï¼ˆ15M*10=150Mï¼‰ã€‚</p></li><li><p>å†…ç½®çš„å¥åº·æ£€æŸ¥åŠŸèƒ½ï¼šå¦‚æœ Nginx ä»£ç†çš„åç«¯çš„æŸå° Web æœåŠ¡å™¨å®•æœºäº†ï¼Œä¸ä¼šå½±å“å‰ç«¯è®¿é—®ã€‚</p></li><li><p>èŠ‚çœå¸¦å®½ï¼šæ”¯æŒ GZIP å‹ç¼©ï¼Œå¯ä»¥æ·»åŠ æµè§ˆå™¨æœ¬åœ°ç¼“å­˜çš„ Header å¤´ã€‚</p></li><li><p>ç¨³å®šæ€§é«˜ï¼šç”¨äºåå‘ä»£ç†ï¼Œå®•æœºçš„æ¦‚ç‡å¾®ä¹å…¶å¾®ã€‚</p></li></ul><h2 id="ä¸‰ã€Nginxï¼ˆåå‘ä»£ç†ï¼‰-apacheæ„å»ºWebæœåŠ¡å™¨é›†ç¾¤çš„è´Ÿè½½å‡è¡¡"><a href="#ä¸‰ã€Nginxï¼ˆåå‘ä»£ç†ï¼‰-apacheæ„å»ºWebæœåŠ¡å™¨é›†ç¾¤çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="ä¸‰ã€Nginxï¼ˆåå‘ä»£ç†ï¼‰+apacheæ„å»ºWebæœåŠ¡å™¨é›†ç¾¤çš„è´Ÿè½½å‡è¡¡"></a>ä¸‰ã€Nginxï¼ˆåå‘ä»£ç†ï¼‰+apacheæ„å»ºWebæœåŠ¡å™¨é›†ç¾¤çš„è´Ÿè½½å‡è¡¡</h2><p>nginxé…ç½®åå‘ä»£ç†</p><p>é…ç½®nginxä½œä¸ºåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼ŒåŒæ—¶åˆ©ç”¨å…¶ç¼“å­˜åŠŸèƒ½ï¼Œå°†é™æ€é¡µé¢æ”¾åœ¨nginxä¸Šç¼“å­˜ï¼Œä»¥è¾¾åˆ°é™ä½åç«¯æœåŠ¡å™¨è¿æ¥æ•°çš„ç›®çš„å¹¶æ£€æŸ¥åç«¯webæœåŠ¡å™¨çš„å¥åº·çŠ¶å†µã€‚</p><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>ç¯å¢ƒï¼š</p><p>OS:centos7.2</p><p>nginxï¼š192.168.197.169</p><p>apache1:192.168.197.167</p><p>apache2:192.168.197.168</p><p>ï¼ˆ1.ï¼‰å®‰è£…zlib-develã€pcre-develç­‰Nginxç›¸å…³ä¾èµ–åŒ…ä»¥åŠgccç¼–è¯‘ç¯å¢ƒ</p><p>yum -y install gcc gcc-c++ make libtool zlib zlib-devel pcre pcre-devel openssl openssl-devel</p><p>æ³¨æ„ï¼š</p><p>ç»“åˆproxyå’Œupstreamæ¨¡å—å®ç°åç«¯webè´Ÿè½½å‡è¡¡</p><p>ä½¿ç”¨proxyæ¨¡å—å®ç°é™æ€æ–‡ä»¶ç¼“å­˜</p><p>ç»“åˆnginxé»˜è®¤è‡ªå¸¦çš„ ngx_http_proxy_module æ¨¡å— å’Œngx_http_upstream_moduleæ¨¡å—å®ç°åç«¯æœåŠ¡å™¨çš„å¥åº·æ£€æŸ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—nginx_upstream_check_module</p><p>ä½¿ç”¨nginx-sticky-moduleæ‰©å±•æ¨¡å—å®ç°Cookieä¼šè¯é»è´´ï¼ˆä¿æŒä¼šè¯ï¼‰</p><p>ä½¿ç”¨ngx_cache_purgeå®ç°æ›´å¼ºå¤§çš„ç¼“å­˜æ¸…é™¤åŠŸèƒ½</p><p>ä¸Šé¢æåˆ°çš„2ä¸ªæ¨¡å—éƒ½å±äºç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—ï¼Œéœ€è¦æå‰ä¸‹å¥½æºç ï¼Œç„¶åç¼–è¯‘æ—¶é€šè¿‡â€“add-moudle=src_pathä¸€èµ·å®‰è£…ã€‚</p><p>ï¼ˆ2.ï¼‰åˆ›å»ºNginxç”¨æˆ·å’Œç»„ï¼Œå¹¶ä¸”æŠŠç”¨æˆ·åŠ å…¥åˆ°ç»„é‡Œä¸è®©ç”¨æˆ·åœ¨æ§åˆ¶å°ç™»å½•</p><p>[root@kang ~]# groupadd www<br>[root@kang ~]# useradd -g www www -s /sbin/nologin<br>ï¼ˆ3.ï¼‰ç¼–è¯‘å®‰è£…Nginx<br>å¯ä»¥åˆ°å®˜ç½‘å»ä¸‹è½½æœ€æ–°ç‰ˆæœ¬Nginxï¼š<a href="http://nginx.org/download/nginx-1.13.8.tar.gz">http://nginx.org/download/nginx-1.13.8.tar.gz</a></p><p>æœ¬ç« ä½¿ç”¨çš„æ˜¯nginx-1.10.2.tar.gzç‰ˆæœ¬æ¥æ¼”ç¤ºï¼š</p><p>#tar zxf nginx-1.10.2.tar.gz</p><p>#tar zxf ngx_cache_purge-2.3.tar.gz</p><p> #tar zxf master.tar.gz</p><p>[root@kang ~]# tar zxf nginx-1.10.2.tar.gz<br>[root@kang ~]# tar zxf ngx_cache_purge-2.3.tar.gz<br>[root@kang ~]# tar zxf master.tar.gz<br>[root@kang ~]# cd nginx-1.10.2/<br>[root@kang nginx-1.10.2]# </p><p>æ³¨æ„ï¼šnginxçš„æ‰€æœ‰æ¨¡å—å¿…é¡»åœ¨ç¼–è¯‘çš„æ—¶å€™æ·»åŠ ï¼Œä¸èƒ½å†è¿è¡Œçš„æ—¶å€™åŠ¨æ€åŠ è½½ã€‚<br>[root@kang nginx-1.10.2]#  ./configure â€“prefix=/usr/local/nginx1.10 â€“user=www â€“group=www â€“with-http_stub_status_module â€“with-http_realip_module â€“with-http_ssl_module â€“with-http_gzip_static_module â€“http-client-body-temp-path=/var/tmp/nginx/client â€“http-proxy-temp-path=/var/tmp/nginx/proxy â€“http-fastcgi-temp-path=/var/tmp/nginx/fcgi â€“with-pcre â€“add-module=../ngx_cache_purge-2.3 â€“with-http_flv_module  â€“add-module=../nginx-goodies-nginx-sticky-module-ng-08a395c66e42</p><p>[root@kang nginx-1.10.2]# make &amp;&amp; make install</p><p>æ³¨æ„ï¼šnginxçš„æ‰€æœ‰æ¨¡å—å¿…é¡»åœ¨ç¼–è¯‘çš„æ—¶å€™æ·»åŠ ï¼Œä¸èƒ½å†è¿è¡Œçš„æ—¶å€™åŠ¨æ€åŠ è½½ã€‚</p><p>ï¼ˆ4.ï¼‰ä¼˜åŒ–nginxç¨‹åºçš„æ‰§è¡Œè·¯å¾„</p><p>[root@kang nginx-1.10.2]# ln -s /usr/local/nginx1.10/sbin/nginx /usr/local/sbin/<br>ï¼ˆ5.ï¼‰æ£€æµ‹NginxæœåŠ¡æ˜¯å¦æœ‰é”™è¯¯<br>[root@kang nginx-1.10.2]# nginx -t<br>å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p><p>ï¼ˆ6.ï¼‰é‚£æ˜¯å› ä¸ºæ²¡æœ‰é‚£ä¸ªæŒ‡å®šçš„ç›®å½•ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥åˆ›å»ºæŒ‡å®šçš„ç›®å½•ï¼Œå¹¶è®¾ç½®ç›¸å…³æ“ä½œæƒé™</p><p>[root@kang nginx-1.10.2]# mkdir -p /var/tmp/nginx/client<br>[root@kang nginx-1.10.2]# chown -R www:www /var/tmp/nginx/<br>ï¼ˆ7.ï¼‰å†æ¬¡æµ‹è¯•æ‰§è¡Œ<br>nginx -t</p><p>2.ç¼–å†™NginxæœåŠ¡è„šæœ¬</p><h3 id="ç¼–å†™NginxæœåŠ¡è„šæœ¬"><a href="#ç¼–å†™NginxæœåŠ¡è„šæœ¬" class="headerlink" title="ç¼–å†™NginxæœåŠ¡è„šæœ¬"></a>ç¼–å†™NginxæœåŠ¡è„šæœ¬</h3><p>[root@kang ~]# vi /etc/init.d/nginx<br> å†…å®¹å¦‚ä¸‹ï¼š<br>#!/bin/bash<br>#chkconfig: 2345 99 20<br>#description: Nginx Service Control Script<br>PROG=â€/usr/local/nginx1.10/sbin/nginxâ€<br>PIDF=â€/usr/local/nginx1.10/logs/nginx.pidâ€<br>case â€œ$1â€ in<br>  start)<br>   netstat -anplt |grep â€œ:80â€ &amp;&gt; /dev/null &amp;&amp; pgrep â€œnginxâ€ &amp;&gt; /dev/null<br>   if [ $? -eq 0 ]<br>   then<br>     echo â€œNginx service already running.â€<br>   else<br>     $PROG -t &amp;&gt; /dev/null<br>     if [ $? -eq 0 ] ; then<br>       $PROG<br>       echo â€œNginx service start success.â€<br>     else<br>     $PROG -t<br>     fi<br>   fi<br>   ;;<br>  stop)<br>   netstat -anplt |grep â€œ:80â€ &amp;&gt; /dev/null &amp;&amp; pgrep â€œnginxâ€ &amp;&gt; /dev/null<br>   if [ $? -eq 0 ]<br>   then<br>    kill -s QUIT $(cat $PIDF)<br>    echo â€œNginx service stop success.â€<br>   else<br>    echo â€œNginx service already stopâ€<br>   fi<br>   ;;<br>  restart)<br>    $0 stop<br>    $0 start<br>    ;;<br>  status)<br>   netstat -anplt |grep â€œ:80â€ &amp;&gt; /dev/null &amp;&amp; pgrep â€œnginxâ€ &amp;&gt; /dev/null<br>   if [ $? -eq 0 ]<br>   then<br>     echo â€œNginx service is running.â€<br>   else<br>     echo â€œNginx is stop.â€<br>   fi<br>  ;;<br>  reload)<br>   netstat -anplt |grep â€œ:80â€ &amp;&gt; /dev/null &amp;&amp; pgrep â€œnginxâ€ &amp;&gt; /dev/null<br>   if [ $? -eq 0 ]<br>   then<br>    $PROG -t &amp;&gt; /dev/null<br>    if [ $? -eq 0 ] ; then<br>      kill -s HUP $(cat $PIDF)<br>      echo â€œreload Nginx config success.â€<br>    else<br>      $PROG -t<br>    fi<br>   else<br>    echo â€œNginx service is not run.â€<br>   fi<br>    ;;<br>  *)<br>   echo â€œUsage: $0 {start|stop|restart|reload}â€<br>   exit 1<br>esac</p><p>ï¼ˆ2.ï¼‰ç»™è„šæœ¬æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼Œä»¥åŠè®¾ç½®æœåŠ¡å¼€æœºè‡ªå¯åŠ¨</p><p>[root@kang ~]# chmod +x /etc/init.d/nginx<br>[root@kang ~]# chkconfig â€“add nginx<br>[root@kang ~]# chkconfig nginx on<br>ï¼ˆ3.ï¼‰å¯åŠ¨NginxæœåŠ¡ï¼ŒæŸ¥çœ‹ç«¯å£</p><p>ï¼ˆ4.ï¼‰è®¿é—®Nginxç½‘ç«™æµ‹è¯•</p><p>æ³¨æ„ï¼šå…³é—­é˜²ç«å¢™æˆ–è€…æ”¾è¡Œ80ç«¯å£ï¼š</p><p>[root@kang ~]# firewall-cmd â€“permanent â€“add-port=80/tcp<br>success<br>[root@kang ~]# firewall-cmd  â€“reload<br>success<br>[root@kang ~]# </p><p>æ³¨æ„ï¼šå¦‚æœä½ æƒ³åœ¨å·²å®‰è£…å¥½çš„nginxä¸Šæ·»åŠ ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œä¾ç„¶éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œä½†ä¸ºäº†ä¸è¦†ç›–ä½ åŸæœ‰çš„é…ç½®ï¼Œè¯·ä¸è¦make installï¼Œè€Œæ˜¯ç›´æ¥æ‹·è´å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><p>[root@kang ~]# nginx -V</p><p>[root@www nginx-1.10.2]#./configure  â€“add-module=â€¦â€¦   #ä½ çš„ç¬¬ä¸‰æ–¹æ¨¡å—<br>[root@www nginx-1.10.2] #makeåä¸è¦make install,æ”¹ä¸ºæ‰‹åŠ¨æ‹·è´ï¼Œå…ˆå¤‡ä»½<br>[root@www nginx-1.10.2] #cp /usr/local/nginx1.10/sbin/nginx /usr/local/nginx1.10/sbin/nginx.bak<br>[root@www nginx-1.10.2] #cp objs/nginx /usr/local/nginx1.10/sbin/nginx</p><h2 id="ç›¸å…³æ¨¡å—åŠŸèƒ½è¯¦è§£"><a href="#ç›¸å…³æ¨¡å—åŠŸèƒ½è¯¦è§£" class="headerlink" title="ç›¸å…³æ¨¡å—åŠŸèƒ½è¯¦è§£"></a>ç›¸å…³æ¨¡å—åŠŸèƒ½è¯¦è§£</h2><p>ï¼ˆ1.ï¼‰æŸ¥çœ‹NginxåŠ è½½çš„æ¨¡å—</p><p>æ³¨æ„ï¼šnginxçš„æ‰€æœ‰æ¨¡å—å¿…é¡»åœ¨ç¼–è¯‘çš„æ—¶å€™æ·»åŠ ï¼Œä¸èƒ½å†è¿è¡Œçš„æ—¶å€™åŠ¨æ€åŠ è½½ã€‚</p><p>ï¼ˆ2.ï¼‰nginx-sticky-moduleæ¨¡å—ï¼š<br>åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ä¸Šå¤„ç†ï¼Œè¿™æ ·ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è§£å†³å¤šä¸ªbackend serversçš„sessionåŒæ­¥çš„é—®é¢˜ â€”â€” å› ä¸ºä¸å†éœ€è¦åŒæ­¥ï¼Œè€ŒRRè½®è¯¢æ¨¡å¼å¿…é¡»è¦è¿ç»´äººå‘˜è‡ªå·±è€ƒè™‘sessionåŒæ­¥çš„å®ç°ã€‚<br>è¿™ä¸ªæ¨¡å—çš„ä½œç”¨æ˜¯é€šè¿‡cookieé»è´´çš„æ–¹å¼å°†æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„è¯·æ±‚å‘é€</p><p>å¦å¤–å†…ç½®çš„ ip_hash ä¹Ÿå¯ä»¥å®ç°æ ¹æ®å®¢æˆ·ç«¯IPæ¥åˆ†å‘è¯·æ±‚ï¼Œä½†å®ƒå¾ˆå®¹æ˜“é€ æˆè´Ÿè½½ä¸å‡è¡¡çš„æƒ…å†µï¼Œè€Œå¦‚æœnginxå‰é¢æœ‰CDNç½‘ç»œæˆ–è€…æ¥è‡ªåŒä¸€å±€åŸŸç½‘çš„è®¿é—®ï¼Œå®ƒæ¥æ”¶çš„å®¢æˆ·ç«¯IPæ˜¯ä¸€æ ·çš„ï¼Œå®¹æ˜“é€ æˆè´Ÿè½½ä¸å‡è¡¡ç°è±¡ã€‚nginx-sticky-moduleçš„cookieè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æµè§ˆå™¨å…³é—­å°±è¿‡æœŸã€‚</p><p>è¿™ä¸ªæ¨¡å—å¹¶ä¸åˆé€‚ä¸æ”¯æŒ Cookie æˆ–æ‰‹åŠ¨ç¦ç”¨äº†cookieçš„æµè§ˆå™¨ï¼Œæ­¤æ—¶é»˜è®¤stickyå°±ä¼šåˆ‡æ¢æˆRRã€‚å®ƒä¸èƒ½ä¸ip_hashåŒæ—¶ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼š<br>upstream backend {<br>        server 192.168.31.141:80 weight=1;<br>        server 192.168.31.250:80 weight=1;<br>        sticky; é‡ç‚¹æ¨¡å—<br>}<br>é…ç½®èµ·æ¥è¶…çº§ç®€å•ï¼Œä¸€èˆ¬æ¥è¯´ä¸€ä¸ªstickyæŒ‡ä»¤å°±å¤Ÿäº†ã€‚</p><p>ç›¸å…³ä¿¡æ¯å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£<a href="https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng">https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng</a></p><p> ï¼ˆ3.ï¼‰load-balanceå…¶å®ƒè°ƒåº¦æ–¹æ¡ˆï¼š</p><p>è¿™é‡Œé¡ºå¸¦ä»‹ç»ä¸€ä¸‹nginxçš„è´Ÿè½½å‡è¡¡æ¨¡å—æ”¯æŒçš„å…¶å®ƒè°ƒåº¦ç®—æ³•ï¼š</p><p>è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æŸå°æœåŠ¡å™¨å®•æœºï¼Œæ•…éšœç³»ç»Ÿè¢«è‡ªåŠ¨å‰”é™¤ï¼Œä½¿ç”¨æˆ·è®¿é—®ä¸å—å½±å“ã€‚Weight æŒ‡å®šè½®è¯¢æƒå€¼ï¼ŒWeightå€¼è¶Šå¤§ï¼Œåˆ†é…åˆ°çš„è®¿é—®æœºç‡è¶Šé«˜ï¼Œä¸»è¦ç”¨äºåç«¯æ¯ä¸ªæœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µä¸‹ã€‚</p><p>ip_hash ï¼š æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¥è‡ªåŒä¸€ä¸ªIPçš„è®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œæœ‰æ•ˆè§£å†³äº†åŠ¨æ€ç½‘é¡µå­˜åœ¨çš„sessionå…±äº«é—®é¢˜ã€‚å½“ç„¶å¦‚æœè¿™ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨äº†ï¼Œä¼šå‘åˆ°ä¸‹ä¸ªèŠ‚ç‚¹ï¼Œè€Œæ­¤æ—¶æ²¡æœ‰sessionåŒæ­¥çš„è¯å°±æ³¨é”€æ‰äº†ã€‚</p><p>least_conn ï¼šè¯·æ±‚è¢«å‘é€åˆ°å½“å‰æ´»è·ƒè¿æ¥æœ€å°‘çš„realserverä¸Šã€‚ä¼šè€ƒè™‘weightçš„å€¼ã€‚</p><p>url_hash ï¼š æ­¤æ–¹æ³•æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜åç«¯ç¼“å­˜æœåŠ¡å™¨çš„æ•ˆç‡ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒurl_hashçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»å®‰è£…Nginx çš„hashè½¯ä»¶åŒ… nginx_upstream_hash ã€‚</p><p>fair ï¼šè¿™æ˜¯æ¯”ä¸Šé¢ä¸¤ä¸ªæ›´åŠ æ™ºèƒ½çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚æ­¤ç§ç®—æ³•å¯ä»¥ä¾æ®é¡µé¢å¤§å°å’ŒåŠ è½½æ—¶é—´é•¿çŸ­æ™ºèƒ½åœ°è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒfairçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»ä¸‹è½½Nginxçš„ upstream_fair æ¨¡å—ã€‚</p><p>ï¼ˆ4.ï¼‰è´Ÿè½½å‡è¡¡ä¸å¥åº·æ£€æŸ¥ï¼š</p><p>ä¸¥æ ¼æ¥è¯´ï¼Œnginxè‡ªå¸¦æ˜¯æ²¡æœ‰é’ˆå¯¹è´Ÿè½½å‡è¡¡åç«¯èŠ‚ç‚¹çš„å¥åº·æ£€æŸ¥çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡é»˜è®¤è‡ªå¸¦çš„ ngx_http_proxy_module æ¨¡å—å’Œngx_http_upstream_module æ¨¡å—ä¸­çš„ç›¸å…³æŒ‡ä»¤æ¥å®Œæˆå½“åç«¯èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ¥æä¾›è®¿é—®ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>upstream backend {<br>        sticky;<br>        server 192.168.31.141:80 weight=1 max_fails=2 fail_timeout=10s;<br>        server 192.168.31.250:80 weight=1 max_fails=2 fail_timeout=10s;<br>}<br>server {<br>   â€¦â€¦<br>location / {<br>            proxy_pass <a href="http://backend/">http://backend</a>;<br>}<br>â€¦â€¦<br>}<br>weight ï¼š è½®è¯¢æƒå€¼ä¹Ÿæ˜¯å¯ä»¥ç”¨åœ¨ip_hashçš„ï¼Œé»˜è®¤å€¼ä¸º1</p><p>max_fails ï¼š å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstreamæ¨¡å—å®šä¹‰çš„é”™è¯¯ã€‚</p><p>fail_timeout ï¼š æœ‰ä¸¤å±‚å«ä¹‰ï¼Œä¸€æ˜¯åœ¨10s æ—¶é—´å†…æœ€å¤šå®¹è®¸2 æ¬¡å¤±è´¥ï¼›äºŒæ˜¯åœ¨ç»å†äº† 2 æ¬¡å¤±è´¥ä»¥åï¼Œ10sæ—¶é—´å†…ä¸åˆ†é…è¯·æ±‚åˆ°è¿™å°æœåŠ¡å™¨ã€‚</p><p>ï¼ˆ5.ï¼‰nginxçš„proxyç¼“å­˜ä½¿ç”¨ï¼š</p><p>ç¼“å­˜ä¹Ÿå°±æ˜¯å°†jsã€cssã€imageç­‰é™æ€æ–‡ä»¶ä»åç«¯æœåŠ¡å™¨ç¼“å­˜åˆ°nginxæŒ‡å®šçš„ç¼“å­˜ç›®å½•ä¸‹ï¼Œæ—¢å¯ä»¥å‡è½»åç«¯æœåŠ¡å™¨è´Ÿæ‹…ï¼Œä¹Ÿå¯ä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œä½†è¿™æ ·ç¼“å­˜åŠæ—¶æ¸…ç†æˆä¸ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ ngx_cache_purge è¿™ä¸ªæ¨¡å—æ¥åœ¨è¿‡æœŸæ—¶é—´æœªåˆ°ä¹‹å‰ï¼Œæ‰‹åŠ¨æ¸…ç†ç¼“å­˜ã€‚</p><p>proxyæ¨¡å—ä¸­å¸¸ç”¨çš„æŒ‡ä»¤æ—¶proxy_passå’Œproxy_cache.</p><p>nginxçš„webç¼“å­˜åŠŸèƒ½çš„ä¸»è¦æ˜¯ç”±proxy_cacheã€fastcgi_cacheæŒ‡ä»¤é›†å’Œç›¸å…³æŒ‡ä»¤é›†å®Œæˆï¼Œproxy_cacheæŒ‡ä»¤è´Ÿè´£åå‘ä»£ç†ç¼“å­˜åç«¯æœåŠ¡å™¨çš„é™æ€å†…å®¹ï¼Œfastcgi_cacheä¸»è¦ç”¨æ¥å¤„ç†FastCGIåŠ¨æ€è¿›ç¨‹ç¼“å­˜ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>http {<br>    #$upstream_cache_statusè®°å½•ç¼“å­˜å‘½ä¸­ç‡<br>log_format  main  â€˜$remote_addr - $remote_user [$time_local] â€œ$requestâ€ â€˜<br>                      â€˜$status $body_bytes_sent â€œ$http_refererâ€ â€˜<br>                      â€˜â€œ$http_user_agentâ€ â€œ$http_x_forwarded_forâ€â€˜<br>                      â€˜â€œ$upstream_cache_statusâ€â€˜;<br>access_log  logs/access.log  main;<br>proxy_buffering on;   #ä»£ç†çš„æ—¶å€™ï¼Œå¼€å¯æˆ–å…³é—­ç¼“å†²åç«¯æœåŠ¡å™¨çš„å“åº”<br>proxy_temp_path /usr/local/nginx1.10/proxy_temp;<br>   proxy_cache_path /usr/local/nginx1.10/proxy_cache levels=1:2 keys_zone=my-cache:100m  inactive=600m max_size=2g;<br>    server {<br>        listen       80;<br>        server_name  localhost;<br>        root   html;<br>        index  index.php index.html index.htm;<br>        #ngx_cache_purgeå®ç°ç¼“å­˜æ¸…é™¤<br>        location  ~/purge(/.*) {<br>           allow 127.0.0.1;<br>           allow 192.168.31.0/24;<br>           deny all;<br>           proxy_cache_purge my-cache $host$1$is_args$args;<br>        }<br>      location ~ .<em>.(gif|jpg|png|html|htm|css|js|ico|swf|pdf)(.</em>) {<br>           proxy_pass  <a href="http://backend/">http://backend</a>;<br>           proxy_redirect off;<br>           proxy_set_header Host $host;<br>           proxy_set_header X-Real-IP $remote_addr;<br>           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>           proxy_ignore_headers Set-Cookie;<br>proxy_hide_header Set-Cookie;<br>           proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;<br>           proxy_cache my-cache;<br>           add_header Nginx-Cache $upstream_cache_status;<br>           proxy_cache_valid 200 304 301 302 8h;<br>           proxy_cache_valid 404 1m;<br>           proxy_cache_valid any 1d;<br>           proxy_cache_key $host$uri$is_args$args;<br>           expires 30d;<br>       }<br>ç›¸å…³é€‰é¡¹è¯´æ˜ï¼š</p><p>proxy_buffering on; ä»£ç†çš„æ—¶å€™ï¼Œå¼€å¯æˆ–å…³é—­ç¼“å†²åç«¯æœåŠ¡å™¨çš„å“åº”ã€‚</p><p>å½“å¼€å¯ç¼“å†²æ—¶ï¼Œnginxå°½å¯èƒ½å¿«åœ°ä»è¢«ä»£ç†çš„æœåŠ¡å™¨æ¥æ”¶å“åº”ï¼Œå†å°†å®ƒå­˜å…¥ç¼“å†²åŒºä¸­ã€‚</p><p>proxy_temp_path ï¼š ç¼“å­˜ä¸´æ—¶ç›®å½•ã€‚åç«¯çš„å“åº”å¹¶ä¸ç›´æ¥è¿”å›å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯å…ˆå†™åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œç„¶åè¢«renameä¸€ä¸‹å½“åšç¼“å­˜æ”¾åœ¨ proxy_cache_path ã€‚0.8.9ç‰ˆæœ¬ä»¥åå…è®¸tempå’Œcacheä¸¤ä¸ªç›®å½•åœ¨ä¸åŒæ–‡ä»¶ç³»ç»Ÿä¸Šï¼ˆåˆ†åŒºï¼‰ï¼Œç„¶è€Œä¸ºäº†å‡å°‘æ€§èƒ½æŸå¤±è¿˜æ˜¯å»ºè®®æŠŠå®ƒä»¬è®¾æˆä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸Šã€‚</p><p>proxy_cache_pathï¼š è®¾ç½®ç¼“å­˜ç›®å½•ï¼Œç›®å½•é‡Œçš„æ–‡ä»¶åæ˜¯cache_key çš„MD5å€¼ã€‚</p><p>levels=1:2 keys_zone=my-cache:100mè¡¨ç¤ºé‡‡ç”¨2çº§ç›®å½•ç»“æ„ï¼Œç¬¬ä¸€å±‚ç›®å½•åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œæ˜¯ç”±levels=1:2è®¾ç½®ï¼Œæ€»å…±äºŒå±‚ç›®å½•ï¼Œå­ç›®å½•åå­—ç”±äºŒä¸ªå­—ç¬¦ç»„æˆã€‚Webç¼“å­˜åŒºåç§°ä¸ºmy-cacheï¼Œå†…å­˜ç¼“å­˜ç©ºé—´å¤§å°ä¸º100MBï¼Œè¿™ä¸ªç¼“å†²zoneå¯ä»¥è¢«å¤šæ¬¡ä½¿ç”¨ã€‚æ–‡ä»¶ç³»ç»Ÿä¸Šçœ‹åˆ°çš„ç¼“å­˜æ–‡ä»¶åç±»ä¼¼äº /usr/local/nginx1.10/proxy_cache/c/29/b7f54b2df7773722d382f4809d65029cã€‚</p><p>inactive=600 max_size=2gè¡¨ç¤º600åˆ†é’Ÿæ²¡æœ‰è¢«è®¿é—®çš„å†…å®¹è‡ªåŠ¨æ¸…é™¤ï¼Œç¡¬ç›˜æœ€å¤§ç¼“å­˜ç©ºé—´ä¸º2GBï¼Œè¶…è¿‡è¿™ä¸ªå¤§å­¦å°†æ¸…é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚</p><p>éœ€è¦åœ¨é»˜è®¤æƒ…å†µï¼Œnginxä¸ç¼“å­˜ä»åç«¯å“åº”çš„httpå¤´ä¸­å¸¦æœ‰Set-Cookieçš„å¯¹è±¡ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¸¦æœ‰Cookie headerï¼Œvarnishå°†å¿½ç•¥ç¼“å­˜ï¼Œç›´æ¥å°†è¯·æ±‚ä¼ é€’åˆ°åç«¯ã€‚nginxä¸­é€šè¿‡proxy_ignore_headersè®¾ç½®å¿½ç•¥å®ƒä»¬ï¼Œè®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>è§£å†³åŠæ³•ï¼š  </p><p>proxy_ignore_headers Set-Cookie;</p><p>proxy_hide_header Set-Cookie;<br>proxy_cache ï¼š å¼•ç”¨å‰é¢å®šä¹‰çš„ç¼“å­˜åŒº my-cache</p><p>proxy_cache_key ï¼šå®šä¹‰å¦‚ä½•ç”Ÿæˆç¼“å­˜çš„é”®ï¼Œè®¾ç½®webç¼“å­˜çš„keyå€¼ï¼Œnginxæ ¹æ®keyå€¼md5å“ˆå¸Œå­˜å‚¨ç¼“å­˜</p><p>proxy_cache_valid ï¼š ä¸ºä¸åŒçš„å“åº”çŠ¶æ€ç è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ï¼Œæ¯”å¦‚200ã€302ç­‰æ­£å¸¸ç»“æœå¯ä»¥ç¼“å­˜çš„æ—¶é—´é•¿ç‚¹ï¼Œè€Œ404ã€500ç­‰ç¼“å­˜æ—¶é—´è®¾ç½®çŸ­ä¸€äº›ï¼Œè¿™ä¸ªæ—¶é—´åˆ°äº†æ–‡ä»¶å°±ä¼šè¿‡æœŸï¼Œè€Œä¸è®ºæ˜¯å¦åˆšè¢«è®¿é—®è¿‡ã€‚</p><p>add_headeræŒ‡ä»¤æ¥è®¾ç½®response header,è¯­æ³•: add_header name value;</p><p>$upstream_cache_statusè¿™ä¸ªå˜é‡æ¥æ˜¾ç¤ºç¼“å­˜çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªhttpå¤´æ¥æ˜¾ç¤ºè¿™ä¸€çŠ¶æ€ï¼Œ</p><p>$upstream_cache_statusåŒ…å«ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š </p><p>Â·MISS æœªå‘½ä¸­ï¼Œè¯·æ±‚è¢«ä¼ é€åˆ°åç«¯<br>Â·HIT ç¼“å­˜å‘½ä¸­<br>Â·EXPIRED ç¼“å­˜å·²ç»è¿‡æœŸè¯·æ±‚è¢«ä¼ é€åˆ°åç«¯<br>Â·UPDATING æ­£åœ¨æ›´æ–°ç¼“å­˜ï¼Œå°†ä½¿ç”¨æ—§çš„åº”ç­”<br>Â·STALE åç«¯å°†å¾—åˆ°è¿‡æœŸçš„åº”ç­”</p><p> expires ï¼š åœ¨å“åº”å¤´é‡Œè®¾ç½®Expires:æˆ–Cache-Control:max-ageï¼Œè¿”å›ç»™å®¢æˆ·ç«¯çš„æµè§ˆå™¨ç¼“å­˜å¤±æ•ˆæ—¶é—´ã€‚</p><h2 id="å››ã€é…ç½®nginxåå‘ä»£ç†ï¼šåå‘ä»£ç†-è´Ÿè½½å‡è¡¡-å¥åº·æ¢æµ‹"><a href="#å››ã€é…ç½®nginxåå‘ä»£ç†ï¼šåå‘ä»£ç†-è´Ÿè½½å‡è¡¡-å¥åº·æ¢æµ‹" class="headerlink" title="å››ã€é…ç½®nginxåå‘ä»£ç†ï¼šåå‘ä»£ç†+è´Ÿè½½å‡è¡¡+å¥åº·æ¢æµ‹"></a>å››ã€é…ç½®nginxåå‘ä»£ç†ï¼šåå‘ä»£ç†+è´Ÿè½½å‡è¡¡+å¥åº·æ¢æµ‹</h2><p>ï¼ˆ1.ï¼‰ä¸‹é¢çš„Nginx.confå®ç°nginxåœ¨å‰ç«¯åšåå‘ä»£ç†æœåŠ¡å™¨çš„å®Œæ•´é…ç½®æ–‡ä»¶çš„ä¾‹å­ï¼Œå¤„ç†jsã€pngç­‰é™æ€æ–‡ä»¶ï¼Œjsp/phpç­‰åŠ¨æ€è¯·æ±‚è½¬å‘åˆ°å…¶å®ƒæœåŠ¡å™¨tomcat/apache</p><p>ä¾‹å¦‚ï¼š<br>user  www www;<br>worker_processes  4;<br>worker_cpu_affinity 0001 0010 0100 1000;<br>error_log  logs/error.log;<br>#error_log  logs/error.log  notice;<br>#error_log  logs/error.log  info;<br>worker_rlimit_nofile 10240;<br>pid        logs/nginx.pid;<br>events {<br>    use epoll;<br>    worker_connections  4096;<br>}<br>http {<br>    include       mime.types;<br>    default_type  application/octet-stream;<br>    log_format  main  â€˜$remote_addr - $remote_user [$time_local] â€œ$requestâ€ â€˜<br>                      â€˜$status $body_bytes_sent â€œ$http_refererâ€ â€˜<br>                      â€˜â€œ$http_user_agentâ€ â€œ$http_x_forwarded_forâ€â€˜<br>                      â€˜â€œ$upstream_cache_statusâ€â€˜;<br>access_log  logs/access.log  main;<br>server_tokens off;<br>    sendfile        on;<br>    #tcp_nopush     on;<br>    #keepalive_timeout  0;<br>    keepalive_timeout  65;<br>    #Compression Settings<br>    gzip on;<br>    gzip_comp_level 6;<br>    gzip_http_version 1.1;<br>    gzip_proxied any;<br>    gzip_min_length 1k;<br>    gzip_buffers 16 8k;<br>    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;<br>    gzip_vary on;<br>    #end gzip<br>    # http_proxy Settings<br>    client_max_body_size   10m;<br>    client_body_buffer_size   128k;<br>    proxy_connect_timeout   75;<br>    proxy_send_timeout   75;<br>    proxy_read_timeout   75;<br>    proxy_buffer_size   4k;<br>    proxy_buffers   4 32k;<br>    proxy_busy_buffers_size   64k;<br>proxy_temp_file_write_size  64k;<br>proxy_buffering on;<br>    proxy_temp_path /usr/local/nginx1.10/proxy_temp;<br>    proxy_cache_path /usr/local/nginx1.10/proxy_cache levels=1:2 keys_zone=my-cache:100m max_size=1000m inactive=600m max_size=2g;<br>    #load balance Settings<br>    upstream backend {<br>        sticky;<br>        server 192.168.31.141:80 weight=1 max_fails=2 fail_timeout=10s;<br>        server 192.168.31.250:80 weight=1 max_fails=2 fail_timeout=10s;<br>    }<br>    #virtual host Settings<br>    server {<br>        listen       80;<br>        server_name  localhost;<br>        charset utf-8;<br>        location  ~/purge(/.*) {<br>           allow 127.0.0.1;<br>           allow 192.168.31.0/24;<br>           deny all;<br>           proxy_cache_purge my-cache $host$1$is_args$args;<br>        }<br>        location / {<br>            index  index.php index.html index.htm;<br>            proxy_pass        <a href="http://backend/">http://backend</a>;<br>            proxy_redirect off;<br>            proxy_set_header  Host  $host;<br>            proxy_set_header  X-Real-IP  $remote_addr;<br>            proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;<br>            proxy_ignore_headers Set-Cookie;<br>proxy_hide_header Set-Cookie;<br>            proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;<br>        }<br>        location ~ .<em>.(gif|jpg|png|html|htm|css|js|ico|swf|pdf)(.</em>) {<br>           proxy_pass  <a href="http://backend/">http://backend</a>;<br>           proxy_redirect off;<br>           proxy_set_header Host $host;<br>           proxy_set_header X-Real-IP $remote_addr;<br>           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>           proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;<br>           proxy_cache my-cache;<br>           add_header Nginx-Cache $upstream_cache_status;<br>           proxy_cache_valid 200 304 301 302 8h;<br>           proxy_cache_valid 404 1m;<br>           proxy_cache_valid any 1d;<br>           proxy_cache_key $host$uri$is_args$args;<br>           expires 30d;<br>        }<br>        location /nginx_status {<br>            stub_status on;<br>            access_log off;<br>            allow 192.168.31.0/24;<br>            deny all;<br>        }<br>    }<br>}</p><p>ï¼ˆ2.ï¼‰é…ç½®Nginx<br>[root@kang ~]# vim  /usr/local/nginx1.10/conf/nginx.conf</p><h3 id="å¸¸ç”¨æŒ‡ä»¤è¯´æ˜"><a href="#å¸¸ç”¨æŒ‡ä»¤è¯´æ˜" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤è¯´æ˜:"></a>å¸¸ç”¨æŒ‡ä»¤è¯´æ˜:</h3><p>mainå…¨å±€é…ç½®:</p><p>woker_processes 4<br>åœ¨é…ç½®æ–‡ä»¶çš„é¡¶çº§mainéƒ¨åˆ†ï¼Œworkerè§’è‰²çš„å·¥ä½œè¿›ç¨‹çš„ä¸ªæ•°ï¼Œmasterè¿›ç¨‹æ˜¯æ¥æ”¶å¹¶åˆ†é…è¯·æ±‚ç»™workerå¤„ç†ã€‚è¿™ä¸ªæ•°å€¼ç®€å•ä¸€ç‚¹å¯ä»¥è®¾ç½®ä¸ºcpuçš„æ ¸æ•°grep ^processor /proc/cpuinfo | wc -lï¼Œä¹Ÿæ˜¯ auto å€¼ï¼Œå¦‚æœå¼€å¯äº†sslå’Œgzipæ›´åº”è¯¥è®¾ç½®æˆä¸é€»è¾‘CPUæ•°é‡ä¸€æ ·ç”šè‡³ä¸º2å€ï¼Œå¯ä»¥å‡å°‘I/Oæ“ä½œã€‚å¦‚æœnginxæœåŠ¡å™¨è¿˜æœ‰å…¶å®ƒæœåŠ¡ï¼Œå¯ä»¥è€ƒè™‘é€‚å½“å‡å°‘ã€‚</p><p>worker_cpu_affinity<br>ä¹Ÿæ˜¯å†™åœ¨mainéƒ¨åˆ†ã€‚åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œé€šè¿‡è®¾ç½®cpuç²˜æ€§æ¥é™ä½ç”±äºå¤šCPUæ ¸åˆ‡æ¢é€ æˆçš„å¯„å­˜å™¨ç­‰ç°åœºé‡å»ºå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚å¦‚worker_cpu_affinity 0001 0010 0100 1000; ï¼ˆå››æ ¸ï¼‰ã€‚</p><p>é™„ï¼š</p><p>CPUå·¥ä½œçŠ¶å†µï¼šï¼ˆè¾“å…¥ top åï¼ŒæŒ‰1 æŸ¥çœ‹ï¼‰</p><p>â€˜<br>ä¸Šé¢çš„é…ç½®è¡¨ç¤ºï¼š1æ ¸CPUï¼Œå¼€å¯1ä¸ªè¿›ç¨‹ã€‚0001è¡¨ç¤ºå¼€å¯ç¬¬ä¸€ä¸ªcpuå†…æ ¸ï¼Œ 0010è¡¨ç¤ºå¼€å¯ç¬¬äºŒä¸ªcpuå†…æ ¸ï¼Œä¾æ¬¡ç±»æ¨ï¼›æœ‰å¤šå°‘ä¸ªæ ¸ï¼Œå°±æœ‰å‡ ä½æ•°ï¼Œ1è¡¨ç¤ºè¯¥å†…æ ¸å¼€å¯ï¼Œ0è¡¨ç¤ºè¯¥å†…æ ¸å…³é—­ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>2æ ¸CPUï¼Œå¼€å¯2ä¸ªè¿›ç¨‹</p><p>worker_processes  2;</p><p>worker_cpu_affinity 01 10;<br>2æ ¸CPUï¼Œå¼€å¯4è¿›ç¨‹</p><p>worker_processes 4;<br>worker_cpu_affinity 01 10 01 10;<br>2æ ¸CPUï¼Œå¼€å¯8è¿›ç¨‹</p><p>worker_processes  8;<br>worker_cpu_affinity 01 10 01 10 01 10 01 10;<br>8æ ¸CPUï¼Œå¼€å¯2è¿›ç¨‹</p><p>worker_processes  2;<br>worker_cpu_affinity 10101010  01010101;<br>è¯´æ˜ï¼š10101010è¡¨ç¤ºå¼€å¯äº†ç¬¬2,4,6,8å†…æ ¸ï¼Œ01010101è¡¨ç¤ºå¼€å§‹äº†1,3,5,7å†…æ ¸</p><p>é€šè¿‡ apache çš„abæµ‹è¯•æŸ¥çœ‹nginxå¯¹CPUçš„ä½¿ç”¨çŠ¶å†µï¼š</p><p>å¦‚æœå¤šä¸ªCPUå†…æ ¸çš„åˆ©ç”¨ç‡éƒ½ç›¸å·®ä¸å¤šï¼Œè¯æ˜nginxå·±ç»æˆåŠŸçš„åˆ©ç”¨äº†å¤šæ ¸CPUã€‚æµ‹è¯•ç»“æŸåï¼ŒCPUå†…æ ¸çš„è´Ÿè½½åº”è¯¥éƒ½åŒæ—¶é™ä½ã€‚</p><p>worker_connections 4096<br>å†™åœ¨eventséƒ¨åˆ†ã€‚æ¯ä¸€ä¸ªworkerè¿›ç¨‹èƒ½å¹¶å‘å¤„ç†ï¼ˆå‘èµ·ï¼‰çš„æœ€å¤§è¿æ¥æ•°ï¼ˆåŒ…å«ä¸å®¢æˆ·ç«¯æˆ–åç«¯è¢«ä»£ç†æœåŠ¡å™¨é—´ç­‰æ‰€æœ‰è¿æ¥æ•°ï¼‰ã€‚<br>worker_rlimit_nofile 10240<br>å†™åœ¨mainéƒ¨åˆ†ã€‚workerè¿›ç¨‹çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ã€‚é»˜è®¤æ˜¯æ²¡æœ‰è®¾ç½®ï¼Œå¦‚æœæ²¡è®¾ç½®çš„è¯ï¼Œè¿™ä¸ªå€¼ä¸ºæ“ä½œç³»ç»Ÿçš„é™åˆ¶(ulimit -n)ã€‚å¯ä»¥é™åˆ¶ä¸ºæ“ä½œç³»ç»Ÿæœ€å¤§çš„é™åˆ¶65535ã€‚æŠŠè¿™ä¸ªå€¼è®¾é«˜ï¼Œè¿™æ ·nginxå°±ä¸ä¼šæœ‰â€œtoo many open filesâ€é—®é¢˜äº†ã€‚</p><p>use epoll</p><p>å†™åœ¨eventséƒ¨åˆ†ã€‚åœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹ï¼Œnginxé»˜è®¤ä½¿ç”¨epolläº‹ä»¶æ¨¡å‹ï¼Œå¾—ç›Šäºæ­¤ï¼Œnginxåœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹æ•ˆç‡ç›¸å½“é«˜ã€‚åŒæ—¶Nginxåœ¨OpenBSDæˆ–FreeBSDæ“ä½œç³»ç»Ÿä¸Šé‡‡ç”¨ç±»ä¼¼äºepollçš„é«˜æ•ˆäº‹ä»¶æ¨¡å‹kqueueã€‚</p><p>httpæœåŠ¡å™¨:<br>ä¸æä¾›httpæœåŠ¡ç›¸å…³çš„ä¸€äº›é…ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼šæ˜¯å¦ä½¿ç”¨keepaliveå•Šï¼Œæ˜¯å¦ä½¿ç”¨gzipè¿›è¡Œå‹ç¼©ç­‰ã€‚</p><p>sendfile on<br>å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ã€‚</p><p>keepalive_timeout 65 : </p><p>é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œé•¿è¿æ¥è¯·æ±‚å¤§é‡å°æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘é‡å»ºè¿æ¥çš„å¼€é”€ï¼Œå¦‚æœè®¾ç½®æ—¶é—´è¿‡é•¿ï¼Œç”¨æˆ·åˆå¤šï¼Œé•¿æ—¶é—´ä¿æŒè¿æ¥ä¼šå ç”¨å¤§é‡èµ„æºã€‚</p><p>client_max_body_size 10m<br>å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°ã€‚å¦‚æœæœ‰ä¸Šä¼ è¾ƒå¤§æ–‡ä»¶ï¼Œè¯·è®¾ç½®å®ƒçš„é™åˆ¶å€¼</p><p>client_body_buffer_size 128k<br>ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</p><p>server_tokens off;<br>éšè—nginxçš„ç‰ˆæœ¬å·</p><p>æ¨¡å—http_proxyï¼š<br>è¿™ä¸ªæ¨¡å—å®ç°çš„æ˜¯nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¼“å­˜åŠŸèƒ½</p><p>proxy_connect_timeout 60<br>nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</p><p>proxy_read_timeout 60</p><p>å®šä¹‰ä»åç«¯æœåŠ¡å™¨è¯»å–å“åº”çš„è¶…æ—¶ã€‚æ­¤è¶…æ—¶æ˜¯æŒ‡ç›¸é‚»ä¸¤æ¬¡è¯»æ“ä½œä¹‹é—´çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå“åº”ä¼ è¾“å®Œæˆçš„æœ€é•¿æ—¶é—´ã€‚å¦‚æœåç«¯æœåŠ¡å™¨åœ¨è¶…æ—¶æ—¶é—´æ®µå†…æ²¡æœ‰ä¼ è¾“ä»»ä½•æ•°æ®ï¼Œè¿æ¥å°†è¢«å…³é—­ã€‚</p><p>å®šä¹‰å‘åç«¯æœåŠ¡å™¨ä¼ è¾“è¯·æ±‚çš„è¶…æ—¶ã€‚æ­¤è¶…æ—¶æ˜¯æŒ‡ç›¸é‚»ä¸¤æ¬¡å†™æ“ä½œä¹‹é—´çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¯·æ±‚ä¼ è¾“å®Œæˆçš„æœ€é•¿æ—¶é—´ã€‚å¦‚æœåç«¯æœåŠ¡å™¨åœ¨è¶…æ—¶æ—¶é—´æ®µå†…æ²¡æœ‰æ¥æ”¶åˆ°ä»»ä½•æ•°æ®ï¼Œè¿æ¥å°†è¢«å…³é—­ã€‚</p><p>proxy_buffer_size 4k<br>è®¾ç½®ç¼“å†²åŒºçš„å¤§å°ä¸ºsizeã€‚nginxä»è¢«ä»£ç†çš„æœåŠ¡å™¨è¯»å–å“åº”æ—¶ï¼Œä½¿ç”¨è¯¥ç¼“å†²åŒºä¿å­˜å“åº”çš„å¼€å§‹éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†é€šå¸¸åŒ…å«ç€ä¸€ä¸ªå°å°çš„å“åº”å¤´ã€‚è¯¥ç¼“å†²åŒºå¤§å°é»˜è®¤ç­‰äºproxy_buffersæŒ‡ä»¤è®¾ç½®çš„ä¸€å—ç¼“å†²åŒºçš„å¤§å°ï¼Œä½†å®ƒä¹Ÿå¯ä»¥è¢«è®¾ç½®å¾—æ›´å°ã€‚</p><p>proxy_buffers 8 4k<br>è¯­æ³•: proxy_buffers the_number is_size;<br>ä¸ºæ¯ä¸ªè¿æ¥è®¾ç½®ç¼“å†²åŒºçš„æ•°é‡ä¸ºnumberï¼Œæ¯å—ç¼“å†²åŒºçš„å¤§å°ä¸ºsizeã€‚è¿™äº›ç¼“å†²åŒºç”¨äºä¿å­˜ä»è¢«ä»£ç†çš„æœåŠ¡å™¨è¯»å–çš„å“åº”ã€‚æ¯å—ç¼“å†²åŒºé»˜è®¤ç­‰äºä¸€ä¸ªå†…å­˜é¡µçš„å¤§å°ã€‚è¿™ä¸ªå€¼æ˜¯4Kè¿˜æ˜¯8Kï¼Œå–å†³äºå¹³å°ã€‚</p><p>é™„ï¼šæŸ¥çœ‹Linuxå†…å­˜é¡µå¤§å°</p><p>[root@kang ~]# getconf PAGESIZE<br>4096<br>[root@kang ~]# </p><p>æˆ–è€…<br> getconf PAGE_SIZE<br>proxy_busy_buffers_size 64k</p><p>é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆé»˜è®¤å¤§å°æ˜¯proxy_buffersæŒ‡ä»¤è®¾ç½®å•å—ç¼“å†²å¤§å°çš„2å€ï¼‰</p><p> proxy_max_temp_file_size</p><p>å½“ proxy_buffers æ”¾ä¸ä¸‹åç«¯æœåŠ¡å™¨çš„å“åº”å†…å®¹æ—¶ï¼Œä¼šå°†ä¸€éƒ¨åˆ†ä¿å­˜åˆ°ç¡¬ç›˜çš„ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå€¼ç”¨æ¥è®¾ç½®æœ€å¤§ä¸´æ—¶æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤1024Mã€‚</p><p> proxy_temp_file_write_size 64k</p><p>å½“ç¼“å­˜è¢«ä»£ç†çš„æœåŠ¡å™¨å“åº”åˆ°ä¸´æ—¶æ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹é™åˆ¶æ¯æ¬¡å†™ä¸´æ—¶æ–‡ä»¶çš„å¤§å°ã€‚</p><p>æ¨¡å—http_gzipï¼š</p><p>gzip on : å¼€å¯gzipå‹ç¼©è¾“å‡ºï¼Œå‡å°‘ç½‘ç»œä¼ è¾“ã€‚</p><p>gzip_min_length 1k ï¼š è®¾ç½®å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ï¼Œé¡µé¢å­—èŠ‚æ•°ä»headerå¤´å¾—content-lengthä¸­è¿›è¡Œè·å–ã€‚å»ºè®®è®¾ç½®æˆå¤§äº1kçš„å­—èŠ‚æ•°ï¼Œå°äº1kå¯èƒ½ä¼šè¶Šå‹è¶Šå¤§ã€‚</p><p>gzip_buffers 4 16k ï¼š è®¾ç½®ç³»ç»Ÿè·å–å‡ ä¸ªå•ä½çš„ç¼“å­˜ç”¨äºå­˜å‚¨gzipçš„å‹ç¼©ç»“æœæ•°æ®æµã€‚416kä»£è¡¨ä»¥16kä¸ºå•ä½ï¼ŒæŒ‰ç…§åŸå§‹æ•°æ®å¤§å°ä»¥16kä¸ºå•ä½çš„4å€ç”³è¯·å†…å­˜ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤å€¼æ˜¯ç”³è¯·è·ŸåŸå§‹æ•°æ®ç›¸åŒå¤§å°çš„å†…å­˜ç©ºé—´å»å­˜å‚¨gzipå‹ç¼©ç»“æœ</p><p>gzip_http_version 1.1 ï¼š ç”¨äºè¯†åˆ« http åè®®çš„ç‰ˆæœ¬ï¼Œæ—©æœŸçš„æµè§ˆå™¨ä¸æ”¯æŒ Gzip å‹ç¼©ï¼Œç”¨æˆ·å°±ä¼šçœ‹åˆ°ä¹±ç ï¼Œæ‰€ä»¥ä¸ºäº†æ”¯æŒå‰æœŸç‰ˆæœ¬åŠ ä¸Šäº†è¿™ä¸ªé€‰é¡¹ï¼Œå¦‚æœä½ ç”¨äº† Nginx çš„åå‘ä»£ç†å¹¶æœŸæœ›ä¹Ÿå¯ç”¨ Gzip å‹ç¼©çš„è¯ï¼Œç”±äºæœ«ç«¯é€šä¿¡æ˜¯ http/1.1ï¼Œæ•…è¯·è®¾ç½®ä¸º 1.1ã€‚</p><p>gzip_comp_level 6 ï¼š gzipå‹ç¼©æ¯”ï¼Œ1å‹ç¼©æ¯”æœ€å°å¤„ç†é€Ÿåº¦æœ€å¿«ï¼Œ9å‹ç¼©æ¯”æœ€å¤§ä½†å¤„ç†é€Ÿåº¦æœ€æ…¢(ä¼ è¾“å¿«ä½†æ¯”è¾ƒæ¶ˆè€—cpu)</p><p>gzip_types ï¼šåŒ¹é…mimeç±»å‹è¿›è¡Œå‹ç¼©ï¼Œæ— è®ºæ˜¯å¦æŒ‡å®šâ€text/htmlâ€ç±»å‹æ€»æ˜¯ä¼šè¢«å‹ç¼©çš„ã€‚</p><p>é»˜è®¤å€¼: gzip_types text/html (é»˜è®¤ä¸å¯¹js/cssæ–‡ä»¶è¿›è¡Œå‹ç¼©)<br>#å‹ç¼©ç±»å‹ï¼ŒåŒ¹é…MIMEç±»å‹è¿›è¡Œå‹ç¼©<br>#ä¸èƒ½ç”¨é€šé…ç¬¦ text/*<br>#(æ— è®ºæ˜¯å¦æŒ‡å®š)text/htmlé»˜è®¤å·²ç»å‹ç¼©<br>#è®¾ç½®å“ªå‹ç¼©ç§æ–‡æœ¬æ–‡ä»¶å¯å‚è€ƒ conf/mime.types</p><p>gzip_proxied any ï¼š Nginxä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™å¯ç”¨ï¼Œæ ¹æ®æŸäº›è¯·æ±‚å’Œåº”ç­”æ¥å†³å®šæ˜¯å¦åœ¨å¯¹ä»£ç†è¯·æ±‚çš„åº”ç­”å¯ç”¨gzipå‹ç¼©ï¼Œæ˜¯å¦å‹ç¼©å–å†³äºè¯·æ±‚å¤´ä¸­çš„â€œViaâ€å­—æ®µï¼ŒæŒ‡ä»¤ä¸­å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªä¸åŒçš„å‚æ•°ï¼Œæ„ä¹‰å¦‚ä¸‹ï¼š</p><p>off â€“ å…³é—­æ‰€æœ‰çš„ä»£ç†ç»“æœæ•°æ®çš„å‹ç¼©<br>expired â€“ å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œExpiresâ€ å¤´ä¿¡æ¯<br>no-cache â€“ å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:no-cacheâ€ å¤´ä¿¡æ¯<br>no-store â€“ å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:no-storeâ€ å¤´ä¿¡æ¯<br>private â€“ å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:privateâ€ å¤´ä¿¡æ¯<br>no_last_modified â€“ å¯ç”¨å‹ç¼©,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« â€œLast-Modifiedâ€ å¤´ä¿¡æ¯<br>no_etag â€“ å¯ç”¨å‹ç¼© ,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« â€œETagâ€ å¤´ä¿¡æ¯<br>auth â€“ å¯ç”¨å‹ç¼© , å¦‚æœheaderå¤´ä¸­åŒ…å« â€œAuthorizationâ€ å¤´ä¿¡æ¯<br>any â€“ æ— æ¡ä»¶å¯ç”¨å‹ç¼©</p><p> gzip_vary on ï¼šå’Œhttpå¤´æœ‰å…³ç³»ï¼ŒåŠ ä¸ªvaryå¤´ï¼Œç»™ä»£ç†æœåŠ¡å™¨ç”¨çš„ï¼Œæœ‰çš„æµè§ˆå™¨æ”¯æŒå‹ç¼©ï¼Œæœ‰çš„ä¸æ”¯æŒï¼Œæ‰€ä»¥é¿å…æµªè´¹ä¸æ”¯æŒçš„ä¹Ÿå‹ç¼©ï¼Œæ‰€ä»¥æ ¹æ®å®¢æˆ·ç«¯çš„HTTPå¤´æ¥åˆ¤æ–­ï¼Œæ˜¯å¦éœ€è¦å‹ç¼©</p><p>æ¨¡å—http_streamï¼š<br>è¿™ä¸ªæ¨¡å—é€šè¿‡ä¸€ä¸ªç®€å•çš„è°ƒåº¦ç®—æ³•æ¥å®ç°å®¢æˆ·ç«¯IPåˆ°åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œupstreamåæ¥è´Ÿè½½å‡è¡¡å™¨çš„åå­—ï¼Œåç«¯realserverä»¥ host:port options; æ–¹å¼ç»„ç»‡åœ¨ {} ä¸­ã€‚å¦‚æœåç«¯è¢«ä»£ç†çš„åªæœ‰ä¸€å°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™åœ¨ proxy_pass ã€‚</p><p>Location:</p><p>root /var/www/html</p><p>å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®ã€‚å¦‚æœlocationURLåŒ¹é…çš„æ˜¯å­ç›®å½•æˆ–æ–‡ä»¶ï¼Œrootæ²¡ä»€ä¹ˆä½œç”¨ï¼Œä¸€èˆ¬æ”¾åœ¨serveræŒ‡ä»¤é‡Œé¢æˆ–/ä¸‹ã€‚</p><p>index index.jsp index.html index.htm</p><p>å®šä¹‰è·¯å¾„ä¸‹é»˜è®¤è®¿é—®çš„æ–‡ä»¶åï¼Œä¸€èˆ¬è·Ÿç€rootæ”¾</p><p>proxy_pass http:/backend</p><p>è¯·æ±‚è½¬å‘backendå®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ï¼Œå³åå‘ä»£ç†ï¼Œå¯¹åº”upstreamè´Ÿè½½å‡è¡¡å™¨ã€‚ä¹Ÿå¯ä»¥proxy_pass <a href="http://ip:portã€‚">http://ip:portã€‚</a></p><p>proxy_redirectoff;</p><p>æŒ‡å®šæ˜¯å¦ä¿®æ”¹è¢«ä»£ç†æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´ä¸­çš„locationå¤´åŸŸè·Ÿrefreshå¤´åŸŸæ•°å€¼</p><p>ä¾‹å¦‚ï¼š</p><p>è®¾ç½®åç«¯æœåŠ¡å™¨â€œLocationâ€å“åº”å¤´å’Œâ€œRefreshâ€å“åº”å¤´çš„æ›¿æ¢æ–‡æœ¬ã€‚å‡è®¾åç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´æ˜¯ â€œLocation: <a href="http://localhost:8000/two/some/uri/%E2%80%9D%EF%BC%8C%E9%82%A3%E4%B9%88%E6%8C%87%E4%BB%A4">http://localhost:8000/two/some/uri/â€ï¼Œé‚£ä¹ˆæŒ‡ä»¤</a></p><p>proxy_redirect<a href="http://localhost:8000/two/">http://localhost:8000/two/</a> <a href="http://frontend/one/">http://frontend/one/</a>;</p><p>å°†æŠŠå­—ç¬¦ä¸²æ”¹å†™ä¸º â€œLocation: <a href="http://frontend/one/some/uri/%E2%80%9D%E3%80%82">http://frontend/one/some/uri/â€ã€‚</a></p><p>proxy_set_header Host$host;</p><p>å…è®¸é‡æ–°å®šä¹‰æˆ–è€…æ·»åŠ å‘å¾€åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å¤´ã€‚</p><p>Hostçš„å«ä¹‰æ˜¯è¡¨æ˜è¯·æ±‚çš„ä¸»æœºåï¼Œnginxåå‘ä»£ç†æœåŠ¡å™¨ä¼šå‘åç«¯çœŸå®æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶ä¸”è¯·æ±‚å¤´ä¸­çš„hostå­—æ®µé‡å†™ä¸ºproxy_passæŒ‡ä»¤è®¾ç½®çš„æœåŠ¡å™¨ã€‚å› ä¸ºnginxä½œä¸ºåå‘ä»£ç†ä½¿ç”¨ï¼Œè€Œå¦‚æœåç«¯çœŸå®çš„æœåŠ¡å™¨è®¾ç½®æœ‰ç±»ä¼¼é˜²ç›—é“¾æˆ–è€…æ ¹æ®httpè¯·æ±‚å¤´ä¸­çš„hostå­—æ®µæ¥è¿›è¡Œè·¯ç”±æˆ–åˆ¤æ–­åŠŸèƒ½çš„è¯ï¼Œå¦‚æœåå‘ä»£ç†å±‚çš„nginxä¸é‡å†™è¯·æ±‚å¤´ä¸­çš„hostå­—æ®µï¼Œå°†ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚</p><p>proxy_set_headerX-Forwarded-For $proxy_add_x_forwarded_for;</p><p>åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</p><p>X_Forward_Forå­—æ®µè¡¨ç¤ºè¯¥æ¡httpè¯·æ±‚æ˜¯æœ‰è°å‘èµ·çš„ï¼Ÿå¦‚æœåå‘ä»£ç†æœåŠ¡å™¨ä¸é‡å†™è¯¥è¯·æ±‚å¤´çš„è¯ï¼Œé‚£ä¹ˆåç«¯çœŸå®æœåŠ¡å™¨åœ¨å¤„ç†æ—¶ä¼šè®¤ä¸ºæ‰€æœ‰çš„è¯·æ±‚éƒ½æ¥è‡ªåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœ‰é˜²æ”»å‡»ç­–ç•¥çš„è¯ï¼Œé‚£ä¹ˆæœºå™¨å°±è¢«å°æ‰äº†ã€‚å› æ­¤ï¼Œåœ¨é…ç½®ç”¨ä½œåå‘ä»£ç†çš„nginxä¸­ä¸€èˆ¬ä¼šå¢åŠ ä¸¤æ¡é…ç½®ï¼Œä¿®æ”¹httpçš„è¯·æ±‚å¤´ï¼š<br>proxy_set_header Host $host;<br>proxy_set_header X-Forward-For $remote_addr;</p><p>proxy_next_upstream error timeoutinvalid_header http_500 http_502 http_503 http_504;</p><p>å¢åŠ æ•…éšœè½¬ç§»ï¼Œå¦‚æœåç«¯çš„æœåŠ¡å™¨è¿”å›502ã€504ã€æ‰§è¡Œè¶…æ—¶ç­‰é”™è¯¯ï¼Œè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘åˆ°upstreamè´Ÿè½½å‡è¡¡æ± ä¸­çš„å¦ä¸€å°æœåŠ¡å™¨ï¼Œå®ç°æ•…éšœè½¬ç§»ã€‚</p><p>proxy_set_headerX-Real-IP $remote_addr;</p><p>webæœåŠ¡å™¨ç«¯è·å¾—ç”¨æˆ·çš„çœŸå®ipä½†æ˜¯ï¼Œå®é™…ä¸Šè¦è·å¾—ç”¨æˆ·çš„çœŸå®ipï¼Œä¹Ÿå¯ä»¥é€šè¿‡X-Forward-For</p><h2 id="äº”ã€éªŒè¯ï¼šnginxåå‘ä»£ç†çš„ç¼“å­˜åŠŸèƒ½ã€è´Ÿè½½å‡è¡¡åŠå¥åº·æ£€æŸ¥"><a href="#äº”ã€éªŒè¯ï¼šnginxåå‘ä»£ç†çš„ç¼“å­˜åŠŸèƒ½ã€è´Ÿè½½å‡è¡¡åŠå¥åº·æ£€æŸ¥" class="headerlink" title="äº”ã€éªŒè¯ï¼šnginxåå‘ä»£ç†çš„ç¼“å­˜åŠŸèƒ½ã€è´Ÿè½½å‡è¡¡åŠå¥åº·æ£€æŸ¥"></a>äº”ã€éªŒè¯ï¼šnginxåå‘ä»£ç†çš„ç¼“å­˜åŠŸèƒ½ã€è´Ÿè½½å‡è¡¡åŠå¥åº·æ£€æŸ¥</h2><p>ï¼ˆ1.ï¼‰ä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ç¼“å­˜åŠŸèƒ½</p><p>å¦‚æœåœ¨ç¼“å­˜æ—¶é—´ä¹‹å†…éœ€è¦æ›´æ–°è¢«ç¼“å­˜çš„é™æ€æ–‡ä»¶æ€ä¹ˆåŠå‘¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ‰‹åŠ¨æ¥æ¸…é™¤ç¼“å­˜äº†ã€‚</p><p>ngx_cache_pureæ¸…é™¤ç¼“å­˜æ¨¡å—ä½¿ç”¨è¯´æ˜</p><p>ç”¨è°·æ­Œæµè§ˆå™¨æµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‰F12è°ƒç”¨å¼€å‘å·¥å…·ï¼Œé€‰æ‹©Networké€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒResponse Headersï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¯·æ±‚çš„æ˜¯å¦ç¼“å­˜</p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è®¿é—®çš„æœåŠ¡å™¨æ˜¯192.168.197.169ï¼Œç¼“å­˜å‘½ä¸­ã€‚</p><p>ä¹Ÿå¯ä»¥æŸ¥çœ‹ç¼“å­˜ç›®å½•æˆ–nginxçš„è®¿é—®æ—¥å¿—</p><p>æ¸…é™¤ç¼“å­˜:</p><p>ä¸Šè¿°é…ç½®çš„proxy_cache_purgeæŒ‡ä»¤ç”¨äºæ–¹ä¾¿çš„æ¸…é™¤ç¼“å­˜ï¼Œä½†å¿…é¡»æŒ‰ç…§ç¬¬ä¸‰æ–¹çš„ ngx_cache_purge æ¨¡å—æ‰èƒ½ä½¿ç”¨</p><p>ä½¿ç”¨ ngx_cache_purge æ¨¡å—æ¸…é™¤ç¼“å­˜ï¼ˆç›´æ¥åˆ é™¤ç¼“å­˜ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿç®—ä¸€ç§åŠæ³•ï¼‰ï¼š<br>GETæ–¹å¼è¯·æ±‚URL</p><p>å³ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„location ~ /purge(/.*)</p><p>æµè§ˆå™¨è®¿é—®<a href="http://192.168.197.169/purge/your/may/path%E6%9D%A5%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98">http://192.168.197.169/purge/your/may/pathæ¥æ¸…é™¤ç¼“å­˜</a></p><p>ç¼“å­˜æ¸…é™¤æˆåŠŸã€‚</p><p>å¤‡æ³¨ï¼š<br>      ï¼ˆ1ï¼‰purgeæ˜¯ngx_cache_pure æ¨¡å—æŒ‡ä»¤<br>      ï¼ˆ2ï¼‰your/may/path æ˜¯è¦æ¸…é™¤çš„ç¼“å­˜æ–‡ä»¶URLè·¯å¾„</p><p>ï¼ˆ2.ï¼‰æµ‹è¯•è´Ÿè½½å‡è¡¡</p><p>è®¿é—®NginxæœåŠ¡å™¨çš„ipåœ°å€ï¼Œä¸åœåˆ·æ–°é¡µé¢æµè§ˆåˆ°åç«¯çš„ä¸¤å°Apacheç½‘ç«™ï¼Œè¯æ˜é€šè¿‡åå‘ä»£ç†å®ç°äº†è´Ÿè½½å‡è¡¡æµ‹è¯•æˆåŠŸï¼ï¼ï¼</p><h2 id="æ‰©å±•çŸ¥è¯†"><a href="#æ‰©å±•çŸ¥è¯†" class="headerlink" title="æ‰©å±•çŸ¥è¯†"></a>æ‰©å±•çŸ¥è¯†</h2><p>å¦‚ä½•ä¿®æ”¹Nginxç‰ˆæœ¬ç­‰ä¿¡æ¯</p><p>1ã€vi /usr/local/src/nginx-1.0.12/src/core/nginx.h   #ç¼–è¯‘å‰ç¼–è¾‘</p><p>#define nginx_version<br>#define NGINX_VERSION<br>#define NGINX_VER<br>#define NGINX_VAR<br>ä¿®æ”¹ä¸Šé¢çš„ä¿¡æ¯ï¼Œå³å¯æ›´æ”¹nginxæ˜¾ç¤ºç‰ˆæœ¬ã€‚<br>2ã€vi/usr/local/src/nginx-1.0.12/src/http/ngx_http_special_response.c   #ç¼–è¯‘å‰ç¼–è¾‘<br>static u_char ngx_http_error_full_tail[] =<br>static u_char ngx_http_error_tail[] =<br>ä¿®æ”¹ä¸Šé¢çš„ä¿¡æ¯ä¸ºä½ è‡ªå·±çš„ã€‚<br>3ã€vi/usr/local/src/nginx-1.0.12/src/http/ngx_http_header_filter_module.c   #ç¼–è¯‘å‰ç¼–è¾‘<br>static char ngx_http_server_string[]=<br>ä¿®æ”¹ä¸Šé¢çš„ä¿¡æ¯ä¸ºä½ è‡ªå·±çš„ã€‚<br>4ã€ç¼–è¯‘å®Œæˆä¹‹åï¼Œä¿®æ”¹/usr/local/nginx/confç›®å½•ä¸‹é¢<br>fastcgi.confã€fastcgi.conf.defaultã€fastcgi_paramsã€fastcgi_params.default<br>è¿™å››ä¸ªæ–‡ä»¶é‡Œé¢çš„ç‰ˆæœ¬åç§°<br>/usr/local/nginx/sbin/nginx -V  #æŸ¥çœ‹nginxç‰ˆæœ¬å·</p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>ï¼ˆ1.ï¼‰Nginxçš„æ¦‚å¿µã€ç‰¹ç‚¹ã€åŸç†ï¼ˆæ­£å‘ã€åå‘ä»£ç†ï¼‰ã€ä¸ºä»€ä¹ˆä½¿ç”¨Nginxï¼Ÿ</p><p>ï¼ˆ2.ï¼‰Nginxçš„å®‰è£…ã€</p><p>ï¼ˆ3.ï¼‰Nginxçš„ä¼˜åŒ–ã€ï¼ˆgzipã€cacheã€è´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥ã€CPUæ ¸æ•°ã€æœ€å¤§è¿æ¥æ•°ã€å¼€å¯epollæ¨¡å‹ã€ç¬¬ä¸‰æ–¹æ¨¡å—ã€æ¨¡å—ä¼˜åŒ–ï¼‰</p><p>ï¼ˆ4.ï¼‰éªŒè¯Nginxç½‘é¡µã€è´Ÿè½½å‡è¡¡ã€æ¸…é™¤ç¼“å­˜ã€æŸ¥çœ‹ç¼“å­˜ç­‰ã€</p><p>ï¼ˆ5.ï¼‰Nginxä¸èƒ½åŠ¨æ€åŠ è½½æ¨¡å—ï¼Œéœ€è¦æå‰ç¼–è¯‘æ—¶å®‰è£…ï¼ï¼ï¼</p><p><a href="https://me.csdn.net/weixin_45509582">åŸä½œè€…åšå®¢CSDN</a></p>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginxåå‘ä»£ç†+nginxæ€§èƒ½ä¼˜åŒ–é…ç½®è¯¦è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoè¿ç§»è‡³window+githubpush</title>
      <link href="posts/6666.html"/>
      <url>posts/6666.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h2 id="å‡†å¤‡ç¯å¢ƒ"><a href="#å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡ç¯å¢ƒ"></a>å‡†å¤‡ç¯å¢ƒ</h2><ul><li>åœ¨windowsä¸Šå®‰è£…Git bash</li><li>åœ¨windowsä¸Šå®‰è£…nodejs</li><li>ä¸‹è½½åœ°å€ï¼š<a href="https://www.git-scm.com/">Git bash</a> ,  <a href="https://nodejs.org/en/">nodejs</a><a id="more"></a></li><li>å°†å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼Œç›®å½•æ‹·è´è‡³æ–°çš„ç”µè„‘<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_config.yml</span><br><span class="line"> package.json</span><br><span class="line"> scaffolds/</span><br><span class="line"> source/</span><br><span class="line"> themes/</span><br></pre></td></tr></table></figure></li><li>è¿ç§»åˆ°linuxç¯å¢ƒï¼šæ­¥éª¤åŸºæœ¬ä¸€è‡´ï¼Œåªéœ€ä¿è¯å°†ä»¥ä¸Šå››ä¸ªç›®å½•æ‹·è´è‡³blogç›®å½•ï¼Œå†å‡†å¤‡ç¯å¢ƒï¼Œå®‰è£…hexoå³å¯ã€‚<h2 id="Git-bashå®‰è£…"><a href="#Git-bashå®‰è£…" class="headerlink" title="Git bashå®‰è£…"></a>Git bashå®‰è£…</h2>å®‰è£…Windowsç‰ˆçš„Gitå®‰è£…ç¨‹åº</li></ul><p><img src="https://img-blog.csdnimg.cn/20200930150734139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å®‰è£…ç»„ä»¶ï¼šè¿™é‡Œå¯ä»¥ä½¿ç”¨é»˜è®¤é€‰é¡¹ï¼Œç‚¹å‡»ã€Next &gt;ã€‘</p><ul><li>å›¾æ ‡ç»„ä»¶ï¼ˆAdditional iconsï¼‰ï¼šé€‰æ‹©æ˜¯å¦åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹</li><li>æ¡Œé¢æµè§ˆï¼ˆWindows Explorer integrationï¼‰<ul><li>ä½¿ç”¨Git Bashæ–¹å¼ï¼Œshellæ–¹å¼</li><li>å—ç”¨æ¡Œé¢ç¨‹åºæ–¹å¼</li></ul></li><li>å…³è”é…ç½®æ–‡ä»¶ï¼šæ˜¯å¦å…³è”gité…ç½®æ–‡ä»¶ï¼Œè¯¥é…ç½®æ–‡ä»¶ä¸»è¦æ˜¾ç¤ºæ–‡æœ¬ç¼–è¾‘å™¨æ ·å¼</li><li>å…³è”shellè„šæœ¬æ–‡ä»¶ï¼šæ˜¯å¦å…³è”Bashå‘½ä»¤æ‰§è¡Œè„šæœ¬æ–‡ä»¶</li><li>ä½¿ç”¨TrueTypeç¼–ç ï¼šåœ¨å‘½ä»¤è¡Œä¸­æ˜¯å¦ä½¿ç”¨TrueTypeç¼–ç ï¼Œè¯¥ç¼–ç æ˜¯å¾®è½¯å’Œè‹¹æœå…¬å¸åˆ¶å®šçš„é€šç”¨ç¼–ç <br><img src="https://img-blog.csdnimg.cn/20200930151134715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li><li>Gitè‡ªå¸¦ï¼šä½¿ç”¨Gitè‡ªå¸¦çš„Git Bashå‘½ä»¤è¡Œå·¥å…·</li><li>ç³»ç»Ÿè‡ªå¸¦CMDï¼šä½¿ç”¨windowsç³»ç»Ÿçš„å‘½ä»¤è¡Œå·¥å…·</li><li>äºŒè€…éƒ½æœ‰ï¼šä¸Šé¢äºŒè€…åŒæ—¶é…ç½®ï¼Œä½†æ˜¯æ³¨æ„ï¼Œè¿™æ ·ä¼šå°†windowsä¸­çš„find.exeå’Œsort.exeå·¥å…·è¦†ç›–ï¼Œå¦‚æœä¸æ‡‚è¿™äº›å°½é‡ä¸è¦é€‰æ‹©<br><img src="https://img-blog.csdnimg.cn/20200930151232313.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶ä½™é»˜è®¤ä¸‹ä¸€æ­¥å³å¯å®Œæˆå®‰è£…ã€‚</li></ul><h2 id="å®‰è£…nodejs"><a href="#å®‰è£…nodejs" class="headerlink" title="å®‰è£…nodejs"></a>å®‰è£…nodejs</h2><p>å› ä¸ºHexoåŸºäºNode.jså¼€å‘ï¼Œæ‰€ä»¥ä¸ç®¡æˆ‘ä»¬æ˜¯Windwosç¯å¢ƒè¿˜æ˜¯Linuxç¯å¢ƒéƒ½éœ€è¦å®‰è£…Node.jsæ‰èƒ½å®ŒæˆHexoçš„æ­å»ºï¼Œå®‰è£…è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ã€‚<br>å®‰è£…è¿‡ç¨‹ä¸­è¿™ä¸ªAdd to PATHè¦è®°å¾—å‹¾é€‰ï¼Œä¸ç„¶è‡ªå·±é…ç½®ç¯å¢ƒå˜é‡å¾ˆéº»çƒ¦<br><img src="https://img-blog.csdnimg.cn/20200930151338956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="å®‰è£…hexoå¹¶æ¨é€è‡³github"><a href="#å®‰è£…hexoå¹¶æ¨é€è‡³github" class="headerlink" title="å®‰è£…hexoå¹¶æ¨é€è‡³github"></a>å®‰è£…hexoå¹¶æ¨é€è‡³github</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">##å®‰è£…hexo-cli</span><br><span class="line">npm install -g hexo-cli</span><br><span class="line">##æŸ¥çœ‹ç‰ˆæœ¬</span><br><span class="line">hexo -v</span><br><span class="line">##å®‰è£…æ‰€éœ€æ¨¡å—</span><br><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">npm install hexo-generator-feed --save</span><br><span class="line">npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure><p>å®‰è£…æ¨¡å—è‹¥å‡ºç°æŠ¥é”™è¯·æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf node_modules &amp;&amp; npm install --force</span><br></pre></td></tr></table></figure><p>æ„å»ºå¹¶å‘å¸ƒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure><p>è‹¥å‡ºç°æ­¤ç±»æŠ¥é”™å¦‚å›¾ï¼š<br><img src="https://img-blog.csdnimg.cn/20200930152314309.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##æ‰§è¡Œè¿™æ¡å‘½ä»¤åæ­£å¸¸</span><br><span class="line">git config --<span class="built_in">global</span> core.autocrlf <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="å…å¯†éƒ¨ç½²"><a href="#å…å¯†éƒ¨ç½²" class="headerlink" title="å…å¯†éƒ¨ç½²"></a>å…å¯†éƒ¨ç½²</h2><p>å…¬é’¥çš„è¯è·Ÿlinuxç³»ç»Ÿç”Ÿæˆä¸€æ ·</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C example@<span class="number">163.</span>com</span><br></pre></td></tr></table></figure><p>ç„¶åå…¬é’¥æ·»åŠ è‡³<br><img src="https://img-blog.csdnimg.cn/20200930153334819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„ä¿®æ”¹_config.ymlæ–‡ä»¶ä¸­çš„repoåœ°å€ï¼Œæ”¹ä¸ºsshæ–¹å¼</p><p>åˆ°è¿™é‡Œè¿ç§»å°±å®Œæˆäº†ï¼Œ<a href="https://alexcld.com/">ä½œè€…åšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexoè¿ç§»è‡³window+githubpush </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoæ’å…¥èƒŒæ™¯éŸ³ä¹</title>
      <link href="posts/6658.html"/>
      <url>posts/6658.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h1 id="hexoæ’å…¥éŸ³ä¹"><a href="#hexoæ’å…¥éŸ³ä¹" class="headerlink" title="hexoæ’å…¥éŸ³ä¹"></a>hexoæ’å…¥éŸ³ä¹</h1><p><a href="https://alexcld.com/">å¯ä»¥åˆ°æˆ‘çš„åšå®¢å‚è€ƒä¸€ä¸‹æ ·å¼</a></p><p>ä¸¤ç§æ–¹å¼ï¼š</p><a id="more"></a><ul><li>å•ä¸ªéŸ³ä¹</li><li>æ­Œå•<h3 id="ç¬¬ä¸€ç§ï¼š"><a href="#ç¬¬ä¸€ç§ï¼š" class="headerlink" title="ç¬¬ä¸€ç§ï¼š"></a>ç¬¬ä¸€ç§ï¼š</h3>è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œç›´æ¥åˆ°ç½‘æ˜“äº‘æœç´¢éœ€è¦æ·»åŠ çš„èƒŒæ™¯éŸ³ä¹ç„¶åç”Ÿæˆå¤–é“¾ï¼Œå°†å¤–é“¾ç²˜è´´åˆ°sidebar.swigé‡Œè¾¹ï¼Œå¯ä»¥åˆ‡æ¢ç²˜è´´ä½ç½®ä»¥è¾¾åˆ°è‡ªå·±éœ€è¦çš„æ•ˆæœã€‚<br>è¿™é‡Œéšä¾¿æ‰¾äº†é¦–æ­Œçš„å¤–é“¾ç²˜äº†è¿›å»<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /blog/themes/next/layout/_macro/sidebar.swig</span><br><span class="line"></span><br><span class="line">&lt;iframe frameborder=<span class="string">&quot;no&quot;</span> border=<span class="string">&quot;0&quot;</span> marginwidth=<span class="string">&quot;0&quot;</span> marginheight=<span class="string">&quot;0&quot;</span> width=<span class="number">330</span> height=<span class="number">86</span> src=<span class="string">&quot;//music.163.com/outchain/player?type=3&amp;id=2069329741&amp;auto=1&amp;height=66&quot;</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒç§ï¼š"><a href="#ç¬¬äºŒç§ï¼š" class="headerlink" title="ç¬¬äºŒç§ï¼š"></a>ç¬¬äºŒç§ï¼š</h3>ä»¥æ­Œå•çš„å½¢å¼æ’å…¥èƒŒæ™¯éŸ³ä¹ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">vim /blog/themes/next/layout/_macro/sidebar.swig</span><br><span class="line"></span><br><span class="line">&lt;!-- <span class="built_in">require</span> APlayer --&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;!-- <span class="built_in">require</span> MetingJS--&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;!--ç½‘æ˜“äº‘--&gt;</span><br><span class="line">    &lt;meting-js</span><br><span class="line">      server=<span class="string">&quot;netease&quot;</span></span><br><span class="line">      id=<span class="string">&quot;3129764102&quot;</span></span><br><span class="line">          type=<span class="string">&quot;playlist&quot;</span></span><br><span class="line">          mini=<span class="string">&quot;false&quot;</span></span><br><span class="line">      fixed=<span class="string">&quot;false&quot;</span></span><br><span class="line">      list-folded=<span class="string">&quot;true&quot;</span></span><br><span class="line">      autoplay=<span class="string">&quot;true&quot;</span></span><br><span class="line">      volume=<span class="string">&quot;0.4&quot;</span></span><br><span class="line">      theme=<span class="string">&quot;#FADFA3&quot;</span></span><br><span class="line">      order=<span class="string">&quot;random&quot;</span></span><br><span class="line">          loop=<span class="string">&quot;all&quot;</span></span><br><span class="line">      preload=<span class="string">&quot;auto&quot;</span></span><br><span class="line">      mutex=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">    &lt;/meting-js&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/aside&gt;</span><br><span class="line">  &lt;div id=<span class="string">&quot;sidebar-dimmer&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&#123;% endmacro %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><a href="https://github.com/metowolf/MetingJS">å¯å‚è€ƒå±æ€§</a><br><img src="https://img-blog.csdnimg.cn/20200925165345366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTUwOTU4Mg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><a href="https://alexcld.com/">æ•ˆæœ</a><br><img src="https://img-blog.csdnimg.cn/20200925165548731.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexoæ’å…¥èƒŒæ™¯éŸ³ä¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoæ’å…¥å›¾ç‰‡åŠæ§åˆ¶å¤§å°</title>
      <link href="posts/7854.html"/>
      <url>posts/7854.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é¦–å…ˆè¯´ä¸‹hexoæ’å…¥å›¾ç‰‡çš„æ–¹å¼æœ‰å“ªäº›ï¼Œhexoé»˜è®¤é›†æˆäº†markdownè¯­æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬å°±markdowné‡Œæ˜¾ç¤ºå›¾ç‰‡çš„æ–¹å¼å¼•å…¥htmlæ–¹æ³•,ä¸‰ç§æ–¹æ³•æœ‰ä¼˜æœ‰åŠ£ï¼Œå…³é”®çœ‹è‡ªå·±çš„ä¹ æƒ¯äº†</p><ul><li>ç¬¬ä¸€ç§æ˜¯ç›´æ¥å¼•ç”¨markdownæ’å…¥</li><li>ç¬¬äºŒç§æ˜¯ä½¿ç”¨htmlæ¥å¼•ç”¨æ’å…¥<a id="more"></a></li><li>ç¬¬ä¸‰ç§æ˜¯ä¹‹å‰æœ‰è®²åˆ°è¿‡æ’ä»¶å¼•ç”¨</li></ul><h2 id="ç›´æ¥å¼•ç”¨markdownæ’å…¥"><a href="#ç›´æ¥å¼•ç”¨markdownæ’å…¥" class="headerlink" title="ç›´æ¥å¼•ç”¨markdownæ’å…¥"></a>ç›´æ¥å¼•ç”¨markdownæ’å…¥</h2><ul><li>é¦–å…ˆæ˜¯ç›´æ¥å¼•ç”¨çš„æ–¹æ³•éœ€è¦åœ¨imagesç›®å½•é‡Œæ”¾å…¥éœ€è¦å¼•å…¥çš„å›¾ç‰‡<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![lena](https:<span class="comment">//alexcld.com/images/pengyuyan.jpg)</span></span><br></pre></td></tr></table></figure></li><li>æˆ‘è¿™é‡Œå°±ç›´æ¥å¼•ç”¨ä¹‹å‰çš„å›¾ç‰‡äº†ï¼Œå›¾ç‰‡é“¾æ¥è‡ªå·±å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾ï¼Œ</li><li>æœ¬åœ°å›¾ç‰‡çš„è¯å¯ä»¥ç›´æ¥ä½¿ç”¨è·¯å¾„æ¥å¼•ç”¨</li><li>è¿™ç§æ–¹æ³•å¯ä»¥æ˜¯å¯ä»¥ï¼Œæœ‰ç‚¹å°ç¼ºç‚¹ï¼šå›¾ç‰‡å°±ä¼šé åœ¨å·¦ä¾§ï¼Œå¤§å°ä¹Ÿä¸ç”±è‡ªå·±å†³å®š</li></ul><h2 id="ä½¿ç”¨htmlæ–¹æ³•å¼•å…¥"><a href="#ä½¿ç”¨htmlæ–¹æ³•å¼•å…¥" class="headerlink" title="ä½¿ç”¨htmlæ–¹æ³•å¼•å…¥"></a>ä½¿ç”¨htmlæ–¹æ³•å¼•å…¥</h2><ul><li>ç¬¬äºŒç§å°±æ˜¯ä½¿ç”¨htmlæ¥å¼•ç”¨æ’å…¥çš„å›¾ç‰‡<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;https://alexcld.com/images/pengyuyan.jpg&quot;</span> width=<span class="number">256</span> height=<span class="number">256</span> /&gt;</span><br></pre></td></tr></table></figure></li><li>å›ºå®šå›¾ç‰‡å¤§å°ï¼šwidth=256,height=256è®¾ç½®çš„æ˜¯æ˜¾ç¤ºå›¾åƒçš„å°ºå¯¸ï¼Œsrcåé¢æ¥çš„å°±æ˜¯å›¾åƒå¯¹è±¡</li><li>è¿˜å¯ä»¥ä½¿ç”¨ç™¾åˆ†æ¯”çš„æ–¹å¼æ¥ç»™width,heightä¼ å‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;https://alexcld.com/images/pengyuyan.jpg&quot;</span> width=<span class="string">&quot;50%&quot;</span> height=<span class="string">&quot;50%&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li><li>å…¶ä¸­widthå’Œheightåé¢çš„50%å°±æ˜¯æ ¹æ®çª—å£çš„å¤§å°ä»¥ä¸€å®šçš„æ¯”ä¾‹æ˜¾ç¤ºå›¾ç‰‡ã€‚å€¼å¾—ä¸€è¯´çš„æ˜¯ï¼Œè¿™ç§æŒ‰ç…§ç™¾åˆ†æ¯”æ˜¾ç¤ºæ–¹æ³•ï¼Œæ˜¯ä»¥widthæ–¹å‘ä¸ºå‡†ï¼Œå¹¶ä¿æŒçºµæ¨ªæ¯”çš„ï¼Œæ¢å¥è¯è¯´ï¼ŒæŠŠè®¾ç½®widthçš„éƒ¨åˆ†å»æ‰ï¼Œheightçš„å€¼æ”¹ä¸ºä»»æ„ç™¾åˆ†æ¯”ï¼Œæ˜¾ç¤ºçš„å›¾åƒéƒ½æ˜¯åŸå›¾å¤§å°ï¼ˆä¸ªäººè§‰å¾—è¿™æ ¹åšå®¢çª—å£æœ‰å…³ï¼Œæ¯•ç«Ÿç°å®æˆªé¢çš„å®½åº¦ç›¸å¯¹æ˜¯å›ºå®šçš„ï¼Œè€Œé«˜åº¦/é•¿åº¦å´æ˜¯å˜åŒ–ç€çš„ï¼‰ã€‚å› æ­¤ç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠheightè®¾ç½®ç¼ºçœ</li><li>å¦‚ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;https://alexcld.com/images/pengyuyan.jpg&quot;</span> height=<span class="string">&quot;5%&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li><li>å¦‚æœæƒ³ç»™å›¾åƒåŠ ä¸ªæ ‡æ³¨ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">&lt;img src=<span class="string">&quot;https://alexcld.com/images/pengyuyan.jpg&quot;</span> width=<span class="string">&quot;25%&quot;</span> height=<span class="string">&quot;25%&quot;</span> /&gt;</span><br><span class="line">Figure <span class="number">1.</span> xx</span><br><span class="line">&lt;/center&gt;</span><br></pre></td></tr></table></figure></li><li>å¦‚æœæƒ³è®©å›¾å’Œæ ‡æ³¨é—´è·ç¦»å¢å¤§ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">&lt;img src=<span class="string">&quot;https://alexcld.com/images/pengyuyan.jpg&quot;</span> width=<span class="string">&quot;25%&quot;</span> height=<span class="string">&quot;25%&quot;</span> /&gt;</span><br><span class="line">$ $</span><br><span class="line">Figure <span class="number">1.</span> xx</span><br><span class="line">&lt;/center&gt;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰ç§å°±æ˜¯æ˜¯ç”¨æ’ä»¶çš„æ–¹å¼æ¥è¿›è¡Œå¼•ç”¨å›¾ç‰‡"><a href="#ç¬¬ä¸‰ç§å°±æ˜¯æ˜¯ç”¨æ’ä»¶çš„æ–¹å¼æ¥è¿›è¡Œå¼•ç”¨å›¾ç‰‡" class="headerlink" title="ç¬¬ä¸‰ç§å°±æ˜¯æ˜¯ç”¨æ’ä»¶çš„æ–¹å¼æ¥è¿›è¡Œå¼•ç”¨å›¾ç‰‡"></a>ç¬¬ä¸‰ç§å°±æ˜¯æ˜¯ç”¨æ’ä»¶çš„æ–¹å¼æ¥è¿›è¡Œå¼•ç”¨å›¾ç‰‡</h2>å…·ä½“çš„ç»†èŠ‚æˆ‘è¿™é‡Œå°±ä¸å†å¤šè®²äº†ï¼Œå¯ä»¥çœ‹ä¸‹ä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://alexcld.com/2020/08/14/%E8%A7%A3%E5%86%B3Hexo%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/">æ’ä»¶çš„æ–¹å¼å¼•å…¥å›¾ç‰‡</a><br>æ•ˆæœå›¾çš„è¯å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://alexcld.com/2020/09/14/phototest/">æ•ˆæœå›¾</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexoæ’å…¥å›¾ç‰‡åŠæ§åˆ¶å¤§å° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šè‹¥èƒ½ä¸ä½ å…±ä¹˜æµ·æµªä¹‹ä¸Šã€‹</title>
      <link href="posts/5563.html"/>
      <url>posts/5563.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p>å‰§æƒ…å¤§éƒ¨åˆ†æ˜¯å¿«è¿›çœ‹å®Œçš„<br>ä½•å¿…ä¸ºäº†ä¸€å¥æ‰¿è¯º<br>å¥³ä¸»ç²¾ç¥å¤±å¸¸ ç”·ä¸»å¤±å»ç”Ÿå‘½<br>è‹¥èƒ½ä¸ä½ å…±ä¹˜æµ·æµªä¹‹ä¸Š</p><a id="more"></a><img src="https://china-img.soulapp.cn/image/2020-09-14/f10bb896-7c9e-4e7e-8559-9e3f99bfc757-1600046808195.png?x-oss-process=image/resize,m_lfit,w_750," width="70%" />]]></content>
      
      
      <categories>
          
          <category> å¥½å‰§æ¨è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¥½å‰§æ¨è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ’å…¥å›¾ç‰‡</title>
      <link href="posts/1513.html"/>
      <url>posts/1513.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/css/APlayer.min.css"><script src="/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p>ç‰ˆæœ¬ï¼šHexo5.0.2ï¼ˆHexo3ä»¥ä¸Šå³å¯ï¼‰</p><p>è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><a id="more"></a></li><li><p>åœ¨æ ¹ç›®å½•ä¸‹é…ç½®æ–‡ä»¶_config.yml ä¸­æœ‰ post_asset_folder:falseæ”¹ä¸ºtrueã€‚</p></li><li><p>è¿™æ ·åœ¨å»ºç«‹æ–‡ä»¶æ—¶ï¼ŒHexoä¼šè‡ªåŠ¨å»ºç«‹ä¸€ä¸ªä¸æ–‡ç« åŒåçš„æ–‡ä»¶å¤¹ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠä¸è¯¥æ–‡ç« ç›¸å…³çš„æ‰€æœ‰èµ„æºï¼ˆå›¾ç‰‡ï¼‰éƒ½æ”¾åˆ°é‚£ä¸ªæ–‡ä»¶å¤¹é‡Œæ–¹ä¾¿åé¢å¼•ç”¨</p></li><li><p>æˆ‘è¿™é‡Œæ”¾çš„å›¾ç‰‡æ˜¯ï¼šsky2.jpg</p></li><li><p>å®‰è£…æ’ä»¶ï¼šhexo-asset-image(æ’ä»¶ç»æµ‹è¯•æ— é—®é¢˜)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install https:<span class="comment">//github.com/7ym0n/hexo-asset-image --saveï¼ˆä½¿ç”¨cnpmé€Ÿåº¦ç›¸å½“ä¼šå¿«ç‚¹ï¼Œå½“ç„¶npmä¹Ÿå¯ä»¥æ»´ï¼‰</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨è¿™ä¸ªæ’ä»¶æ¥å¼•å…¥å›¾ç‰‡ï¼Œè€Œä¸æ˜¯ç½‘ä¸Šé‚£äº›æ–¹æ³•é‡Œè¯´çš„ç”¨ä¼ ç»Ÿmdè¯­æ³•ç›¸å¯¹è·¯å¾„çš„æ–¹æ³•ã€‚</p></li><li><p>æ’å…¥å›¾ç‰‡æ—¶ç”¨è¿™ç§æ–¹å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% asset_img sky2.jpg This is an test image %&#125;</span><br></pre></td></tr></table></figure></li><li><p>å…¶ä¸­sky2.jpgå°±æ˜¯ä½ è¦å¼•ç”¨çš„å›¾ç‰‡ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯sky2.jpgï¼Œåé¢çš„This is an test imageæ˜¯å›¾ç‰‡æè¿°ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹ã€‚</p></li></ul><p>å…·ä½“ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: A sunny day</span><br><span class="line">date: <span class="number">2020</span>-<span class="number">0</span>8-<span class="number">14</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">30</span></span><br><span class="line">tags:</span><br><span class="line">        - weather</span><br><span class="line">categories:</span><br><span class="line">        - daily</span><br><span class="line">---</span><br><span class="line">æ™´ã‚ŒãŸæ—¥ã‚ˆã‚Š?èœãŒå¿…è¦ã§ã™ã€‚</span><br><span class="line">&#123;% asset_img sky2.jpg This is an test image %&#125;</span><br><span class="line">&#123;% asset_img sky3.jpg This is an test image %&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·å°±èƒ½æˆåŠŸæ˜¾ç¤ºäº†ï¼Œæµ‹è¯•ä¸‹å§ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo cl &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure></li></ul><p><a href="http://alexcld.com/" title="ä½œè€…åšå®¢">Alexåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexoæ’å…¥å›¾ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
